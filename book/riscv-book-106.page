<div id="pf6a" class="pf w0 h0" data-page-no="6a"><div class="pc pc6a w0 h0"><img class="bi x15 y11e2 w2 ha8" alt="" src="bg6a.png"/><div class="t m0 x15 h7 y147 ff3 fs4 fc0 sc0 ls0 ws0">8.5.<span class="_ _19"> </span>V<span class="_ _23"></span>ALUE<span class="_ _2"> </span>AND<span class="_ _2"> </span>REFERENCE<span class="_ _2"> </span>P<span class="_ _7"></span>ARAMETERS</div><div class="t m0 x11d h8 y1e ff24 fs12 fc0 sc0 ls0 ws0">12<span class="_ _78"> </span><span class="ff5 fs4">li<span class="_ _31"> </span>t1,<span class="_ _31"> </span>100<span class="_ _c4"> </span>#<span class="_ _31"> </span>Push<span class="_ _9"> </span>the<span class="_ _31"> </span>10th<span class="_ _31"> </span>parameter</span></div><div class="t m0 x11d h8 yd4 ff24 fs12 fc0 sc0 ls0 ws0">13<span class="_ _78"> </span><span class="ff5 fs4">sw<span class="_ _31"> </span>t1,<span class="_ _31"> </span>4(sp)</span></div><div class="t m0 x11d h8 yd5 ff24 fs12 fc0 sc0 ls0 ws0">14<span class="_ _78"> </span><span class="ff5 fs4">li<span class="_ _31"> </span>t1,<span class="_ _31"> </span>90<span class="_ _85"> </span>#<span class="_ _31"> </span>Push<span class="_ _9"> </span>the<span class="_ _31"> </span>9th<span class="_ _31"> </span>parameter</span></div><div class="t m0 x11d h8 yfd ff24 fs12 fc0 sc0 ls0 ws0">15<span class="_ _78"> </span><span class="ff5 fs4">sw<span class="_ _31"> </span>t1,<span class="_ _31"> </span>0(sp)</span></div><div class="t m0 x11d h8 y28a ff24 fs12 fc0 sc0 ls0 ws0">16<span class="_ _78"> </span><span class="ff5 fs4">jal<span class="_ _31"> </span>sum10<span class="_ _85"> </span>#<span class="_ _31"> </span>Invoke<span class="_ _31"> </span>sum10</span></div><div class="t m0 x11d h8 y48a ff24 fs12 fc0 sc0 ls0 ws0">17<span class="_ _78"> </span><span class="ff5 fs4">addi<span class="_ _31"> </span>sp,<span class="_ _31"> </span>sp,<span class="_ _31"> </span>8<span class="_ _3b"> </span>#<span class="_ _9"> </span>Deallocate<span class="_ _31"> </span>the<span class="_ _31"> </span>parameters<span class="_ _31"> </span>from<span class="_ _31"> </span>stack</span></div><div class="t m0 x11d h8 y22 ff24 fs12 fc0 sc0 ls0 ws0">18<span class="_ _78"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xd h7 y11e3 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _30"> </span>routine that<span class="_ _30"> </span>w<span class="_ _8"></span>as in<span class="_ _8"></span>vok<span class="_ _8"></span>ed<span class="_ _2f"> </span>(<span class="ff5">sum10<span class="_ _30"> </span></span>in<span class="_ _2f"> </span>this<span class="_ _30"> </span>example)<span class="_ _2f"> </span>m<span class="_ _1"></span>ust<span class="_ _30"> </span>retrieve<span class="_ _30"> </span>the<span class="_ _2f"> </span>parameters</div><div class="t m0 x15 h7 y11e4 ff3 fs4 fc0 sc0 ls0 ws0">from<span class="_ _2"> </span>the<span class="_ _2"> </span>registers<span class="_ _2"> </span>and<span class="_ _2"> </span>the<span class="_ _b"> </span>stac<span class="_ _8"></span>k<span class="_ _2"> </span>accordingly<span class="_ _2"> </span>to<span class="_ _2"> </span>the<span class="_ _b"> </span>ABI.<span class="_ _5"> </span>The<span class="_ _2"> </span>following<span class="_ _5"> </span>co<span class="_ _4"></span>de<span class="_ _2"> </span>shows<span class="_ _5"> </span>a</div><div class="t m0 x15 h7 y11e5 ff3 fs4 fc0 sc0 ls0 ws0">p<span class="_ _4"></span>ossible<span class="_ _b"> </span>implemen<span class="_ _8"></span>tation<span class="_ _b"> </span>for<span class="_ _3"> </span>the<span class="_ _b"> </span><span class="ff5">sum10<span class="_ _b"> </span></span>routine<span class="_ _b"> </span>and<span class="_ _b"> </span>illustrates<span class="_ _b"> </span>this<span class="_ _b"> </span>pro<span class="_ _4"></span>cess.<span class="_ _12"> </span>It<span class="_ _b"> </span>loads</div><div class="t m0 x15 h7 y11e6 ff3 fs4 fc0 sc0 ls0 ws0">the v<span class="_ _8"></span>alues<span class="_ _5"> </span>of<span class="_ _5"> </span>the<span class="_ _5"> </span>9</div><div class="t m0 x4f hb y11e7 ffa fs7 fc0 sc0 ls0 ws0">th</div><div class="t m0 x46 h7 y11e6 ff3 fs4 fc0 sc0 ls0 ws0">and the<span class="_ _5"> </span>10</div><div class="t m0 x82 hb y11e7 ffa fs7 fc0 sc0 ls0 ws0">th</div><div class="t m0 x8d h7 y11e6 ff3 fs4 fc0 sc0 ls0 ws0">parameters from<span class="_ _5"> </span>the<span class="_ _5"> </span>stack into registers<span class="_ _5"> </span><span class="ff5">t1<span class="_ _5"> </span></span>and<span class="_ _5"> </span><span class="ff5">t2</span>.</div><div class="t m0 x15 h7 y11e8 ff3 fs4 fc0 sc0 ls0 ws0">Notice<span class="_ _b"> </span>that,<span class="_ _3"> </span>even<span class="_ _b"> </span>though<span class="_ _3"> </span>it<span class="_ _b"> </span>loads<span class="_ _3"> </span>these<span class="_ _b"> </span>v<span class="_ _8"></span>alues<span class="_ _3"> </span>from<span class="_ _b"> </span>the<span class="_ _3"> </span>program<span class="_ _b"> </span>stack,<span class="_ _3"> </span>it<span class="_ _b"> </span>do<span class="_ _4"></span>es<span class="_ _b"> </span>not</div><div class="t m0 x15 h7 y11e9 ff3 fs4 fc0 sc0 ls0 ws0">p<span class="_ _4"></span>op<span class="_ _b"> </span>(deallocate)<span class="_ _b"> </span>the<span class="_ _b"> </span>v<span class="_ _8"></span>alues<span class="_ _b"> </span>from<span class="_ _3"> </span>the<span class="_ _b"> </span>program<span class="_ _b"> </span>stac<span class="_ _8"></span>k<span class="_ _3"> </span>-<span class="_ _b"> </span>this<span class="_ _b"> </span>cleaning<span class="_ _b"> </span>pro<span class="_ _4"></span>cess<span class="_ _b"> </span>m<span class="_ _8"></span>ust<span class="_ _b"> </span>b<span class="_ _4"></span>e</div><div class="t m0 x15 h7 y11ea ff3 fs4 fc0 sc0 ls0 ws0">p<span class="_ _4"></span>erformed<span class="_ _5"> </span>by<span class="_ _5"> </span>the<span class="_ _2"> </span>caller<span class="_ _2"> </span>routine,<span class="_ _2"> </span><span class="ff8">i.e.</span>,<span class="_ _2"> </span>the<span class="_ _2"> </span>routine<span class="_ _2"> </span>that<span class="_ _2"> </span>inv<span class="_ _8"></span>oked<span class="_ _5"> </span>the<span class="_ _2"> </span><span class="ff5">sum10<span class="_ _2"> </span></span>routine.</div><div class="t m0 x111 h8 y11eb ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">sum10:</span></div><div class="t m0 x111 h8 y11ec ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _78"> </span><span class="ff5 fs4">lw<span class="_ _82"> </span>t1,<span class="_ _31"> </span>0(sp)<span class="_ _3b"> </span>#<span class="_ _31"> </span>Loads<span class="_ _9"> </span>the<span class="_ _31"> </span>9th<span class="_ _31"> </span>parameter<span class="_ _31"> </span>into<span class="_ _31"> </span>t1</span></div><div class="t m0 x111 h8 y11ed ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _78"> </span><span class="ff5 fs4">lw<span class="_ _82"> </span>t2,<span class="_ _31"> </span>4(sp)<span class="_ _3b"> </span>#<span class="_ _31"> </span>Loads<span class="_ _9"> </span>the<span class="_ _31"> </span>10th<span class="_ _31"> </span>parameter<span class="_ _31"> </span>into<span class="_ _31"> </span>t2</span></div><div class="t m0 x111 h8 y11ee ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a1<span class="_ _11"> </span>#<span class="_ _31"> </span>Sums<span class="_ _31"> </span>all<span class="_ _31"> </span>parameters</span></div><div class="t m0 x111 h8 y11ef ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a2</span></div><div class="t m0 x111 h8 y11f0 ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a3</span></div><div class="t m0 x111 h8 y11f1 ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a4</span></div><div class="t m0 x111 h8 y11f2 ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a5</span></div><div class="t m0 x111 h8 y11f3 ff24 fs12 fc0 sc0 ls0 ws0">9<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a6</span></div><div class="t m0 x11d h8 y11f4 ff24 fs12 fc0 sc0 ls0 ws0">10<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a7</span></div><div class="t m0 x11d h8 y11f5 ff24 fs12 fc0 sc0 ls0 ws0">11<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>t1</span></div><div class="t m0 x11d h8 y11f6 ff24 fs12 fc0 sc0 ls0 ws0">12<span class="_ _78"> </span><span class="ff5 fs4">add<span class="_ _31"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>t2<span class="_ _11"> </span>#<span class="_ _31"> </span>Place<span class="_ _31"> </span>return<span class="_ _31"> </span>value<span class="_ _31"> </span>on<span class="_ _9"> </span>a0</span></div><div class="t m0 x11d h8 y11f7 ff24 fs12 fc0 sc0 ls0 ws0">13<span class="_ _78"> </span><span class="ff5 fs4">ret<span class="_ _91"> </span>#<span class="_ _31"> </span>Returns</span></div><div class="t m0 x15 ha y11f8 ff7 fs6 fc0 sc0 ls0 ws0">8.4.2<span class="_ _e"> </span>Returning<span class="_ _a"> </span>v<span class="_ _7"></span>alues<span class="_ _a"> </span>from<span class="_ _a"> </span>routines</div><div class="t m0 x15 h7 y11f9 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _3"> </span>RISC-V<span class="_ _a"> </span><span class="ff5">ilp32<span class="_ _a"> </span></span>ABI<span class="_ _3"> </span>deﬁnes<span class="_ _a"> </span>that<span class="_ _a"> </span>v<span class="_ _8"></span>alues<span class="_ _3"> </span>should<span class="_ _a"> </span>b<span class="_ _4"></span>e<span class="_ _3"> </span>returned<span class="_ _3"> </span>in<span class="_ _a"> </span>register<span class="_ _a"> </span><span class="ff5">a0</span>.<span class="_ _0"> </span>In</div><div class="t m0 x15 h7 y11fa ff3 fs4 fc0 sc0 ls0 ws0">case<span class="_ _5"> </span>the<span class="_ _5"> </span>v<span class="_ _8"></span>alue<span class="_ _5"> </span>b<span class="_ _4"></span>eing returned<span class="_ _5"> </span>is<span class="_ _5"> </span>64-bit<span class="_ _5"> </span>long,<span class="_ _2"> </span>then<span class="_ _5"> </span>the<span class="_ _5"> </span>least<span class="_ _5"> </span>signiﬁcant 32<span class="_ _5"> </span>bits<span class="_ _5"> </span>must b<span class="_ _4"></span>e</div><div class="t m0 x15 h7 y11fb ff3 fs4 fc0 sc0 ls0 ws0">returned<span class="_ _b"> </span>in<span class="_ _2"> </span>register<span class="_ _b"> </span><span class="ff5">a0<span class="_ _2"> </span></span>and<span class="_ _b"> </span>the<span class="_ _2"> </span>most<span class="_ _b"> </span>signiﬁcan<span class="_ _8"></span>t<span class="_ _b"> </span>32<span class="_ _2"> </span>bits<span class="_ _b"> </span>m<span class="_ _8"></span>ust<span class="_ _b"> </span>be<span class="_ _b"> </span>returned<span class="_ _2"> </span>in<span class="_ _b"> </span>register</div><div class="t m0 x15 h7 y11fc ff5 fs4 fc0 sc0 ls0 ws0">a1<span class="ff3">.</span></div><div class="t m0 x15 hd y11fd ff7 fs3 fc0 sc0 ls0 ws0">8.5<span class="_ _32"> </span>V<span class="_ _23"></span>alue<span class="_ _31"> </span>and<span class="_ _31"> </span>reference<span class="_ _31"> </span>parameters</div><div class="t m0 x15 h7 y11fe ff3 fs4 fc0 sc0 ls0 ws0">P<span class="_ _1"></span>arameters ma<span class="_ _8"></span>y be passed as v<span class="_ _7"></span>alues or<span class="_ _2f"> </span>as references<span class="_ _2f"> </span>to<span class="_ _2f"> </span>v<span class="_ _8"></span>ariables.<span class="_ _3"> </span><span class="ff6">V<span class="_ _7"></span>alue<span class="_ _37"> </span>parameters</span></div><div class="t m0 x15 h7 y11ff ff6 fs4 fc0 sc0 ls0 ws0">are<span class="_ _37"> </span>parameters<span class="_ _37"> </span>that<span class="_ _37"> </span>con<span class="_ _1"></span>tain<span class="_ _37"> </span>the<span class="_ _37"> </span>v<span class="_ _7"></span>alue itself<span class="ff3">,<span class="_ _2f"> </span><span class="ff8">i.e.</span>, the<span class="_ _30"> </span>v<span class="_ _8"></span>alue<span class="_ _2f"> </span>is<span class="_ _30"> </span>placed directly<span class="_ _30"> </span>into</span></div><div class="t m0 x15 h7 y1200 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2f"> </span>registers<span class="_ _2f"> </span>or<span class="_ _2f"> </span>the<span class="_ _30"> </span>program stac<span class="_ _8"></span>k.<span class="_ _3"> </span>The follo<span class="_ _8"></span>wing code sho<span class="_ _8"></span>ws a<span class="_ _30"> </span>routine that<span class="_ _30"> </span>exp<span class="_ _4"></span>ects its</div><div class="t m0 x15 h7 y1201 ff3 fs4 fc0 sc0 ls0 ws0">parameter to be passed b<span class="_ _8"></span>y v<span class="_ _8"></span>alue.<span class="_ _3"> </span>This routine tak<span class="_ _8"></span>es a v<span class="_ _7"></span>alue as a parameter, computes</div><div class="t m0 x15 h7 y1202 ff3 fs4 fc0 sc0 ls0 ws0">its<span class="_ _2"> </span>p<span class="_ _4"></span>o<span class="_ _8"></span>wer<span class="_ _5"> </span>of<span class="_ _2"> </span>tw<span class="_ _8"></span>o,<span class="_ _2"> </span>and<span class="_ _2"> </span>returns<span class="_ _2"> </span>the<span class="_ _2"> </span>result.</div><div class="t m0 x111 h8 y1203 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">int<span class="_ _31"> </span>pow2(int<span class="_ _31"> </span>v)</span></div><div class="t m0 x111 h8 y1204 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">{</span></div><div class="t m0 x111 h8 y1205 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _7a"> </span><span class="ff5 fs4">return<span class="_ _31"> </span>v*v;</span></div><div class="t m0 x111 h8 y855 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _16"> </span><span class="ff5 fs4">}</span></div><div class="t m0 xd h7 y1206 ff3 fs4 fc0 sc0 ls0 ws0">Accordingly<span class="_ _5"> </span>to<span class="_ _5"> </span>the<span class="_ _5"> </span>RISC-V<span class="_ _5"> </span><span class="ff5">ilp32<span class="_ _5"> </span></span>ABI,<span class="_ _5"> </span>this<span class="_ _5"> </span>parameter<span class="_ _5"> </span>must b<span class="_ _4"></span>e passed<span class="_ _5"> </span>in<span class="_ _5"> </span>register</div><div class="t m0 x15 h7 y1207 ff5 fs4 fc0 sc0 ls0 ws0">a0<span class="ff3">.<span class="_ _3"> </span>Since<span class="_ _2"> </span>it<span class="_ _2"> </span>is<span class="_ _2"> </span>passed<span class="_ _5"> </span>as<span class="_ _2"> </span>v<span class="_ _8"></span>alue,<span class="_ _2"> </span>register<span class="_ _2"> </span><span class="ff5">a0<span class="_ _2"> </span></span>will<span class="_ _5"> </span>contain<span class="_ _5"> </span>the<span class="_ _2"> </span>v<span class="_ _8"></span>alue<span class="_ _2"> </span>itself.<span class="_ _3"> </span>The<span class="_ _2"> </span>following</span></div><div class="t m0 x15 h7 y1208 ff3 fs4 fc0 sc0 ls0 ws0">co<span class="_ _4"></span>de<span class="_ _30"> </span>shows<span class="_ _30"> </span>the<span class="_ _2f"> </span>implemen<span class="_ _1"></span>tation<span class="_ _2f"> </span>of<span class="_ _30"> </span>the previous<span class="_ _30"> </span>“C” code<span class="_ _2f"> </span>in<span class="_ _2f"> </span>assem<span class="_ _8"></span>bly language.<span class="_ _b"> </span>Notice</div><div class="t m0 x15 h7 y1209 ff3 fs4 fc0 sc0 ls0 ws0">that<span class="_ _2"> </span>the<span class="_ _2"> </span>co<span class="_ _4"></span>de<span class="_ _5"> </span>multiplies<span class="_ _5"> </span>the<span class="_ _2"> </span>conten<span class="_ _8"></span>ts<span class="_ _2"> </span>of<span class="_ _2"> </span>register<span class="_ _2"> </span><span class="ff5">a0<span class="_ _2"> </span></span>by<span class="_ _5"> </span>itself.</div><div class="t m0 x1f h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _a"> </span>Marc<span class="_ _8"></span>h<span class="_ _2"> </span>29,<span class="_ _2"> </span>2021)<span class="_ _4e"> </span>93</span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,636.39,null]'><div class="d m1" style="border-style:none;position:absolute;left:314.627000px;bottom:646.716000px;width:20.119000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,636.39,null]'><div class="d m1" style="border-style:none;position:absolute;left:180.598000px;bottom:357.982000px;width:20.119000px;height:11.124000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,636.39,null]'><div class="d m1" style="border-style:none;position:absolute;left:255.183000px;bottom:120.717000px;width:20.119000px;height:11.125000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:141.766000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

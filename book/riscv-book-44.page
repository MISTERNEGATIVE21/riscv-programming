<div id="pf2c" class="pf w0 h0" data-page-no="2c"><div class="pc pc2c w0 h0"><img class="bi x15 y85a w2 h6b" alt="" src="bg2c.png"/><div class="t m0 x15 h7 y147 ff3 fs4 fc0 sc0 ls0 ws0">3.2.<span class="_ _19"> </span>LABELS,<span class="_ _2"> </span>SYMBOLS,<span class="_ _2"> </span>REFERENCES,<span class="_ _2"> </span>AND<span class="_ _2"> </span>RELOCA<span class="_ _7"></span>TION</div><div class="t m0 x15 h8 y1e ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-objdump<span class="_ _31"> </span>-r<span class="_ _31"> </span>main.o</div><div class="t m0 x15 h8 yd5 ff5 fs4 fc0 sc0 ls0 ws0">main.o:<span class="_ _86"> </span>file<span class="_ _9"> </span>format<span class="_ _31"> </span>elf32-littleriscv</div><div class="t m0 x15 h8 y28a ff5 fs4 fc0 sc0 ls0 ws0">RELOCATION<span class="_ _9"> </span>RECORDS<span class="_ _31"> </span>FOR<span class="_ _31"> </span>[.text]:</div><div class="t m0 x15 h8 y48a ff5 fs4 fc0 sc0 ls0 ws0">OFFSET<span class="_ _3b"> </span>TYPE<span class="_ _4c"> </span>VALUE</div><div class="t m0 x15 h8 y22 ff5 fs4 fc0 sc0 ls0 ws0">00000008<span class="_ _9"> </span>R_RISCV_JAL<span class="_ _64"> </span>exit</div><div class="t m0 xd h7 y85b ff3 fs4 fc0 sc0 ls0 ws0">When<span class="_ _5"> </span>linking<span class="_ _2"> </span>the<span class="_ _2"> </span>ob<span class="_ _4"></span>ject<span class="_ _2"> </span>ﬁles,<span class="_ _2"> </span>the<span class="_ _2"> </span>linker<span class="_ _5"> </span>m<span class="_ _1"></span>ust<span class="_ _2"> </span>resolv<span class="_ _8"></span>e<span class="_ _2"> </span>the<span class="_ _2"> </span>undeﬁned<span class="_ _2"> </span>symbols,<span class="_ _2"> </span><span class="ff8">i.e.</span>,</div><div class="t m0 x15 h7 y85c ff3 fs4 fc0 sc0 ls0 ws0">it<span class="_ _3"> </span>must<span class="_ _3"> </span>ﬁnd<span class="_ _3"> </span>the<span class="_ _3"> </span>symbol<span class="_ _a"> </span>deﬁnition<span class="_ _3"> </span>and<span class="_ _a"> </span>adjust<span class="_ _3"> </span>the<span class="_ _3"> </span>symbol<span class="_ _a"> </span>table<span class="_ _3"> </span>and<span class="_ _a"> </span>the<span class="_ _3"> </span>co<span class="_ _4"></span>de<span class="_ _3"> </span>with</div><div class="t m0 x15 h7 y85d ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span>symbol<span class="_ _b"> </span>v<span class="_ _8"></span>alue.<span class="_ _9"> </span>In<span class="_ _b"> </span>the<span class="_ _2"> </span>previous<span class="_ _b"> </span>example,<span class="_ _2"> </span>the<span class="_ _b"> </span>link<span class="_ _8"></span>er<span class="_ _b"> </span>will<span class="_ _2"> </span>lo<span class="_ _4"></span>ok<span class="_ _2"> </span>for<span class="_ _b"> </span>the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _b"> </span></span>sym<span class="_ _8"></span>b<span class="_ _4"></span>ol</div><div class="t m0 x15 h7 y85e ff3 fs4 fc0 sc0 ls0 ws0">so<span class="_ _b"> </span>that<span class="_ _3"> </span>it<span class="_ _b"> </span>can<span class="_ _3"> </span>adjust<span class="_ _b"> </span>the<span class="_ _3"> </span><span class="ff5">jal<span class="_ _b"> </span></span>instruction<span class="_ _3"> </span>to<span class="_ _b"> </span>refer<span class="_ _3"> </span>to<span class="_ _b"> </span>the<span class="_ _3"> </span>correct<span class="_ _b"> </span>address.<span class="_ _26"> </span>In<span class="_ _b"> </span>case<span class="_ _3"> </span>it</div><div class="t m0 x15 h7 y85f ff3 fs4 fc0 sc0 ls0 ws0">cannot<span class="_ _3"> </span>ﬁnd<span class="_ _3"> </span>the<span class="_ _3"> </span>deﬁnition<span class="_ _3"> </span>of<span class="_ _3"> </span>the<span class="_ _3"> </span>sym<span class="_ _8"></span>b<span class="_ _4"></span>ol,<span class="_ _3"> </span>it<span class="_ _3"> </span>stops<span class="_ _3"> </span>the<span class="_ _3"> </span>linking<span class="_ _3"> </span>pro<span class="_ _4"></span>cess<span class="_ _3"> </span>and<span class="_ _3"> </span>emits<span class="_ _3"> </span>an</div><div class="t m0 x15 h7 y860 ff3 fs4 fc0 sc0 ls0 ws0">error<span class="_ _b"> </span>message.<span class="_ _31"> </span>The<span class="_ _b"> </span>follo<span class="_ _8"></span>wing<span class="_ _b"> </span>example<span class="_ _b"> </span>illustrates<span class="_ _2"> </span>this<span class="_ _b"> </span>situation.<span class="_ _16"> </span>In<span class="_ _b"> </span>this<span class="_ _2"> </span>case,<span class="_ _b"> </span>we<span class="_ _2"> </span>are</div><div class="t m0 x15 h7 y861 ff3 fs4 fc0 sc0 ls0 ws0">trying<span class="_ _b"> </span>to<span class="_ _3"> </span>link<span class="_ _3"> </span>the<span class="_ _b"> </span><span class="ff5">main.o<span class="_ _3"> </span></span>ﬁle<span class="_ _b"> </span>without<span class="_ _3"> </span>providing<span class="_ _b"> </span>another<span class="_ _b"> </span>ob<span class="_ _1d"></span>ject<span class="_ _3"> </span>ﬁle<span class="_ _b"> </span>that<span class="_ _3"> </span>con<span class="_ _8"></span>tains<span class="_ _3"> </span>a</div><div class="t m0 x15 h7 y862 ff3 fs4 fc0 sc0 ls0 ws0">deﬁnition of the <span class="ff5">exit<span class="_ _2f"> </span></span>label.<span class="_ _3"> </span>Notice that the link<span class="_ _1"></span>er emits the error<span class="_ _2f"> </span>message <span class="ff5">undefined</span></div><div class="t m0 x15 h7 y863 ff5 fs4 fc0 sc0 ls0 ws0">reference<span class="_ _9"> </span>to<span class="_ _31"> </span>‘exit’<span class="ff3">.</span></div><div class="t m0 x15 h8 y864 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-ld<span class="_ _31"> </span>-m<span class="_ _31"> </span>elf32lriscv<span class="_ _31"> </span>main.o<span class="_ _31"> </span>-o<span class="_ _31"> </span>main.x</div><div class="t m0 x15 h8 y865 ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _9"> </span>warning:<span class="_ _31"> </span>cannot<span class="_ _31"> </span>find<span class="_ _31"> </span>entry<span class="_ _31"> </span>symbol<span class="_ _31"> </span>_start;<span class="_ _9"> </span>...</div><div class="t m0 x15 h8 y866 ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _9"> </span>main.o:<span class="_ _31"> </span>in<span class="_ _31"> </span>function<span class="_ _31"> </span>‘_start’:</div><div class="t m0 x15 h8 y867 ff5 fs4 fc0 sc0 ls0 ws0">(.text+0x8):<span class="_ _9"> </span>undefined<span class="_ _31"> </span>reference<span class="_ _31"> </span>to<span class="_ _31"> </span>‘exit’</div><div class="t m0 x15 ha y868 ff7 fs6 fc0 sc0 ls0 ws0">3.2.4<span class="_ _e"> </span>Global<span class="_ _a"> </span>vs<span class="_ _a"> </span>lo<span class="_ _4"></span>cal<span class="_ _3"> </span>symbols</div><div class="t m0 x15 h7 y869 ff3 fs4 fc0 sc0 ls0 ws0">Sym<span class="_ _1"></span>b<span class="_ _4"></span>ols<span class="_ _30"> </span>are classiﬁed<span class="_ _2f"> </span>as<span class="_ _2f"> </span>lo<span class="_ _4"></span>cal<span class="_ _30"> </span>or global<span class="_ _2f"> </span>sym<span class="_ _8"></span>b<span class="_ _4"></span>ols.<span class="_ _3"> </span>Lo<span class="_ _4"></span>cal<span class="_ _30"> </span>symbols are<span class="_ _2f"> </span>only<span class="_ _2f"> </span>visible<span class="_ _2f"> </span>on<span class="_ _2f"> </span>the</div><div class="t m0 x15 h7 y86a ff3 fs4 fc0 sc0 ls0 ws0">same<span class="_ _b"> </span>ﬁle,<span class="_ _2"> </span><span class="ff8">i.e.</span>,<span class="_ _b"> </span>the<span class="_ _b"> </span>link<span class="_ _8"></span>er<span class="_ _b"> </span>do<span class="_ _4"></span>es<span class="_ _2"> </span>not<span class="_ _b"> </span>use<span class="_ _b"> </span>them<span class="_ _2"> </span>to<span class="_ _b"> </span>resolv<span class="_ _8"></span>e<span class="_ _b"> </span>undeﬁned<span class="_ _b"> </span>references<span class="_ _2"> </span>on<span class="_ _b"> </span>other</div><div class="t m0 x15 h7 y86b ff3 fs4 fc0 sc0 ls0 ws0">ﬁles.<span class="_ _25"> </span>Global<span class="_ _2"> </span>symbols,<span class="_ _b"> </span>on<span class="_ _5"> </span>the<span class="_ _b"> </span>other<span class="_ _2"> </span>hand,<span class="_ _2"> </span>are<span class="_ _2"> </span>used<span class="_ _b"> </span>b<span class="_ _8"></span>y<span class="_ _2"> </span>the<span class="_ _b"> </span>link<span class="_ _8"></span>er<span class="_ _b"> </span>to<span class="_ _5"> </span>resolve<span class="_ _2"> </span>undeﬁned</div><div class="t m0 x15 h7 y86c ff3 fs4 fc0 sc0 ls0 ws0">reference<span class="_ _2"> </span>on<span class="_ _2"> </span>other<span class="_ _2"> </span>ﬁles.</div><div class="t m0 xd h7 y86d ff3 fs4 fc0 sc0 ls0 ws0">By<span class="_ _2"> </span>default,<span class="_ _b"> </span>the<span class="_ _2"> </span>assem<span class="_ _8"></span>bler<span class="_ _b"> </span>registers<span class="_ _2"> </span>lab<span class="_ _4"></span>els<span class="_ _2"> </span>as<span class="_ _2"> </span>lo<span class="_ _4"></span>cal<span class="_ _2"> </span>symbols.<span class="_ _25"> </span>The<span class="_ _b"> </span><span class="ff5">.globl<span class="_ _5"> </span></span>directive</div><div class="t m0 x15 h7 y86e ff3 fs4 fc0 sc0 ls0 ws0">is<span class="_ _b"> </span>an<span class="_ _3"> </span>assembly<span class="_ _b"> </span>directive<span class="_ _b"> </span>that<span class="_ _3"> </span>instructs<span class="_ _b"> </span>the<span class="_ _3"> </span>assem<span class="_ _1"></span>bler<span class="_ _3"> </span>to<span class="_ _b"> </span>register<span class="_ _3"> </span>a<span class="_ _b"> </span>lab<span class="_ _4"></span>el<span class="_ _3"> </span>as<span class="_ _b"> </span>a<span class="_ _3"> </span>global</div><div class="t m0 x15 h7 y86f ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _4"></span>ol.<span class="_ _19"> </span>The<span class="_ _a"> </span>following<span class="_ _a"> </span>example<span class="_ _a"> </span>shows<span class="_ _3"> </span>an<span class="_ _a"> </span>assembly<span class="_ _a"> </span>program<span class="_ _a"> </span>in<span class="_ _a"> </span>which<span class="_ _3"> </span>the<span class="_ _25"> </span><span class="ff5">.globl</span></div><div class="t m0 x15 h7 y870 ff3 fs4 fc0 sc0 ls0 ws0">directiv<span class="_ _1"></span>e is<span class="_ _2f"> </span>used to<span class="_ _2f"> </span>instruct the<span class="_ _2f"> </span>assem<span class="_ _8"></span>bler to register the<span class="_ _2f"> </span><span class="ff5">exit<span class="_ _2f"> </span></span>lab<span class="_ _4"></span>el as<span class="_ _30"> </span>a global sym<span class="_ _1"></span>b<span class="_ _4"></span>ol</div><div class="t m0 x15 h7 y871 ff3 fs4 fc0 sc0 ls0 ws0">on<span class="_ _2"> </span>the<span class="_ _2"> </span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ol<span class="_ _5"> </span>table.</div><div class="t m0 x111 h8 y872 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">#<span class="_ _31"> </span>Contents<span class="_ _31"> </span>of<span class="_ _9"> </span>the<span class="_ _31"> </span>exit.s<span class="_ _31"> </span>file</span></div><div class="t m0 x111 h8 y873 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">.globl<span class="_ _31"> </span>exit</span></div><div class="t m0 x111 h8 y874 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _16"> </span><span class="ff5 fs4">exit:</span></div><div class="t m0 x111 h8 y875 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _32"> </span><span class="ff5 fs4">li<span class="_ _9"> </span>a0,<span class="_ _31"> </span>0</span></div><div class="t m0 x111 h8 y876 ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _32"> </span><span class="ff5 fs4">li<span class="_ _9"> </span>a7,<span class="_ _31"> </span>93</span></div><div class="t m0 x111 h8 y877 ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _32"> </span><span class="ff5 fs4">ecall</span></div><div class="t m0 xd h7 y878 ff3 fs4 fc0 sc0 ls0 ws0">Assuming<span class="_ _2f"> </span>the<span class="_ _2f"> </span>co<span class="_ _4"></span>de<span class="_ _30"> </span>that in<span class="_ _8"></span>vok<span class="_ _8"></span>es the<span class="_ _30"> </span><span class="ff5">exit<span class="_ _2f"> </span></span>function is<span class="_ _2f"> </span>located on<span class="_ _2f"> </span>the<span class="_ _2f"> </span><span class="ff5">main.s<span class="_ _2f"> </span></span>ﬁle<span class="_ _2f"> </span>and</div><div class="t m0 x15 h7 y879 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _2"> </span></span>function<span class="_ _b"> </span>is<span class="_ _5"> </span>lo<span class="_ _4"></span>cated<span class="_ _2"> </span>on<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">exit.s<span class="_ _b"> </span></span>ﬁle,<span class="_ _5"> </span>the<span class="_ _b"> </span>follo<span class="_ _8"></span>wing<span class="_ _2"> </span>sequence<span class="_ _2"> </span>of<span class="_ _b"> </span>commands</div><div class="t m0 x15 h7 y87a ff3 fs4 fc0 sc0 ls0 ws0">sho<span class="_ _1"></span>ws<span class="_ _2"> </span>ho<span class="_ _1"></span>w<span class="_ _2"> </span>to<span class="_ _2"> </span>assem<span class="_ _1"></span>ble<span class="_ _2"> </span>b<span class="_ _4"></span>oth<span class="_ _5"> </span>ﬁles<span class="_ _2"> </span>and<span class="_ _2"> </span>link<span class="_ _2"> </span>them<span class="_ _2"> </span>together.</div><div class="t m0 x15 h8 y87b ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-as<span class="_ _31"> </span>-march=rv32im<span class="_ _31"> </span>main.s<span class="_ _31"> </span>-o<span class="_ _31"> </span>main.o</div><div class="t m0 x15 h8 y87c ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-as<span class="_ _31"> </span>-march=rv32im<span class="_ _31"> </span>exit.s<span class="_ _31"> </span>-o<span class="_ _31"> </span>exit.o</div><div class="t m0 x15 h8 y87d ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-ld<span class="_ _31"> </span>-m<span class="_ _31"> </span>elf32lriscv<span class="_ _31"> </span>main.o<span class="_ _31"> </span>exit.o<span class="_ _31"> </span>-o<span class="_ _9"> </span>main.x</div><div class="t m0 x15 h8 y87e ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _9"> </span>warning:<span class="_ _31"> </span>cannot<span class="_ _31"> </span>find<span class="_ _31"> </span>entry<span class="_ _31"> </span>symbol<span class="_ _31"> </span>_start;<span class="_ _9"> </span>...</div><div class="t m0 xd h7 yd1 ff3 fs4 fc0 sc0 ls0 ws0">Notice<span class="_ _25"> </span>that<span class="_ _9"> </span>the<span class="_ _25"> </span>linker<span class="_ _25"> </span>is<span class="_ _25"> </span>not<span class="_ _9"> </span>pro<span class="_ _4"></span>ducing<span class="_ _25"> </span>the<span class="_ _25"> </span><span class="ff5">undefined<span class="_ _31"> </span>reference<span class="_ _31"> </span>to<span class="_ _31"> </span>‘exit’</span></div><div class="t m0 x15 h7 yd2 ff3 fs4 fc0 sc0 ls0 ws0">an<span class="_ _1"></span>ymore.<span class="_ _a"> </span>It<span class="_ _b"> </span>is<span class="_ _5"> </span>worth<span class="_ _2"> </span>noting<span class="_ _2"> </span>that,<span class="_ _2"> </span>in<span class="_ _b"> </span>case<span class="_ _5"> </span>the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _b"> </span></span>label<span class="_ _2"> </span>is<span class="_ _b"> </span>not<span class="_ _5"> </span>registered<span class="_ _b"> </span>as<span class="_ _5"> </span>a<span class="_ _2"> </span>global</div><div class="t m0 x15 h7 yd3 ff3 fs4 fc0 sc0 ls0 ws0">lab<span class="_ _4"></span>el, the link<span class="_ _8"></span>er will not use<span class="_ _2f"> </span>it to resolv<span class="_ _8"></span>e the undeﬁned sym<span class="_ _8"></span>b<span class="_ _4"></span>ol and the<span class="_ _2f"> </span>linking process</div><div class="t m0 x15 h7 y48 ff3 fs4 fc0 sc0 ls0 ws0">will<span class="_ _2"> </span>fail.</div><div class="t m0 x1f h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _a"> </span>Marc<span class="_ _8"></span>h<span class="_ _2"> </span>29,<span class="_ _2"> </span>2021)<span class="_ _4e"> </span>31</span></div><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:141.766000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

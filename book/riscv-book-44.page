<div id="pf2c" class="pf w0 h0" data-page-no="2c"><div class="pc pc2c w0 h0"><img class="bi x13 y194 w2 h20" alt="" src="bg2c.png"/><div class="t m0 x13 h7 y15a ff3 fs4 fc0 sc0 ls0 ws0">CHAPTER<span class="_ _2"> </span>3.<span class="_ _22"> </span>ASSEMBL<span class="_ _7"></span>Y,<span class="_ _2"> </span>OBJECT,<span class="_ _2"> </span>AND<span class="_ _2"> </span>EXECUT<span class="_ _7"></span>ABLE<span class="_ _2"> </span>FILES</div><div class="t m0 x13 h8 y38 ff5 fs4 fc0 sc0 ls0 ws0">RELOCATION<span class="_ _11"> </span>RECORDS<span class="_ _e"> </span>FOR<span class="_ _e"> </span>[.text]:</div><div class="t m0 x13 h8 yed ff5 fs4 fc0 sc0 ls0 ws0">OFFSET<span class="_ _3f"> </span>TYPE<span class="_ _50"> </span>VALUE</div><div class="t m0 x13 h8 yee ff5 fs4 fc0 sc0 ls0 ws0">00000004<span class="_ _11"> </span>R_RISCV_BRANCH<span class="_ _86"> </span>done</div><div class="t m0 x14 h7 y844 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _3"> </span>following<span class="_ _a"> </span>example<span class="_ _3"> </span>shows<span class="_ _3"> </span>what<span class="_ _3"> </span>happ<span class="_ _4"></span>ens<span class="_ _a"> </span>to<span class="_ _c"> </span>the<span class="_ _3"> </span>previous<span class="_ _3"> </span>program<span class="_ _3"> </span>once<span class="_ _3"> </span>it<span class="_ _c"> </span>is</div><div class="t m0 x13 h7 y845 ff3 fs4 fc0 sc0 ls0 ws0">link<span class="_ _1"></span>ed.<span class="_ _e"> </span>First,<span class="_ _a"> </span>w<span class="_ _1"></span>e<span class="_ _d"> </span>pro<span class="_ _4"></span>duce<span class="_ _2"> </span>the<span class="_ _d"> </span><span class="ff5">trunk.x<span class="_ _a"> </span></span>ﬁle<span class="_ _d"> </span>by<span class="_ _2"> </span>inv<span class="_ _8"></span>oking<span class="_ _d"> </span>the<span class="_ _d"> </span>linker.<span class="_ _e"> </span>Then,<span class="_ _d"> </span>we<span class="_ _2"> </span>insp<span class="_ _4"></span>ect</div><div class="t m0 x13 h7 y846 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span>con<span class="_ _1"></span>ten<span class="_ _1"></span>ts<span class="_ _2"> </span>of<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">trunk.x<span class="_ _2"> </span></span>ﬁle<span class="_ _2"> </span>b<span class="_ _1"></span>y<span class="_ _2"> </span>using<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">riscv64-unknown-elf-objdump<span class="_ _2"> </span></span>to<span class="_ _4"></span>ol.</div><div class="t m0 x13 h8 y847 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _11"> </span>riscv64-unknown-elf-ld<span class="_ _e"> </span>-m<span class="_ _e"> </span>elf32lriscv<span class="_ _e"> </span>trunk.o<span class="_ _11"> </span>-o<span class="_ _e"> </span>trunk.x</div><div class="t m0 x13 h8 y848 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _11"> </span>riscv64-unknown-elf-objdump<span class="_ _e"> </span>-D<span class="_ _e"> </span>trunk.x</div><div class="t m0 x13 h8 y849 ff5 fs4 fc0 sc0 ls0 ws0">trunk.x:<span class="_ _88"> </span>file<span class="_ _11"> </span>format<span class="_ _e"> </span>elf32-littleriscv</div><div class="t m0 x13 h8 y84a ff5 fs4 fc0 sc0 ls0 ws0">Disassembly<span class="_ _11"> </span>of<span class="_ _e"> </span>section<span class="_ _e"> </span>.text:</div><div class="t m0 x13 h8 y84b ff5 fs4 fc0 sc0 ls0 ws0">00010054<span class="_ _11"> </span>&lt;trunk42&gt;:</div><div class="t m0 x14 h8 y84c ff5 fs4 fc0 sc0 ls0 ws0">10054:<span class="_ _11"> </span>02a00313<span class="_ _89"> </span>li<span class="_ _11"> </span>t1,42</div><div class="t m0 x14 h8 y84d ff5 fs4 fc0 sc0 ls0 ws0">10058:<span class="_ _11"> </span>00a35463<span class="_ _89"> </span>bge<span class="_ _11"> </span>t1,a0,10060<span class="_ _e"> </span>&lt;done&gt;</div><div class="t m0 x14 h8 y84e ff5 fs4 fc0 sc0 ls0 ws0">1005c:<span class="_ _11"> </span>00030513<span class="_ _89"> </span>mv<span class="_ _11"> </span>a0,t1</div><div class="t m0 x13 h8 y84f ff5 fs4 fc0 sc0 ls0 ws0">00010060<span class="_ _11"> </span>&lt;done&gt;:</div><div class="t m0 x14 h8 y850 ff5 fs4 fc0 sc0 ls0 ws0">10060:<span class="_ _11"> </span>00008067<span class="_ _89"> </span>ret</div><div class="t m0 x14 h8 y851 ff5 fs4 fc0 sc0 ls0 ws0">...</div><div class="t m0 x14 h7 y852 ff3 fs4 fc0 sc0 ls0 ws0">Notice<span class="_ _a"> </span>that<span class="_ _a"> </span>the<span class="_ _3"> </span>co<span class="_ _4"></span>de<span class="_ _d"> </span>on<span class="_ _3"> </span>the<span class="_ _a"> </span><span class="ff5">trunk.x<span class="_ _3"> </span></span>program<span class="_ _a"> </span>was<span class="_ _d"> </span>relo<span class="_ _4"></span>cated,<span class="_ _3"> </span><span class="ff8">i.e.</span>,<span class="_ _3"> </span>assigned<span class="_ _a"> </span>new</div><div class="t m0 x13 h7 y853 ff3 fs4 fc0 sc0 ls0 ws0">addresses.<span class="_ _f"> </span>In<span class="_ _d"> </span>this<span class="_ _2"> </span>example,<span class="_ _d"> </span>the<span class="_ _d"> </span>co<span class="_ _4"></span>de<span class="_ _5"> </span>of<span class="_ _d"> </span>the<span class="_ _d"> </span><span class="ff5">trunk42<span class="_ _2"> </span></span>routine<span class="_ _d"> </span>starts<span class="_ _2"> </span>at<span class="_ _d"> </span>address<span class="_ _2"> </span><span class="ff5">10054</span></div><div class="t m0 x13 h7 y854 ff3 fs4 fc0 sc0 ls0 ws0">and<span class="_ _3"> </span>the<span class="_ _a"> </span><span class="ff5">bge<span class="_ _3"> </span></span>instruction<span class="_ _3"> </span>jumps<span class="_ _3"> </span>to<span class="_ _3"> </span>address<span class="_ _3"> </span><span class="ff5">10060<span class="_ _3"> </span></span>in<span class="_ _a"> </span>case<span class="_ _3"> </span>the<span class="_ _3"> </span>v<span class="_ _8"></span>alue<span class="_ _3"> </span>in<span class="_ _3"> </span>register<span class="_ _3"> </span><span class="ff5">t1<span class="_ _3"> </span></span>is</div><div class="t m0 x13 h7 y855 ff3 fs4 fc0 sc0 ls0 ws0">greater<span class="_ _2"> </span>or<span class="_ _2"> </span>equal<span class="_ _2"> </span>to<span class="_ _2"> </span>the<span class="_ _2"> </span>v<span class="_ _8"></span>alue<span class="_ _2"> </span>in<span class="_ _2"> </span>register<span class="_ _2"> </span><span class="ff5">a0</span>.</div><div class="t m0 x13 ha y856 ff6 fs6 fc0 sc0 ls0 ws0">3.2.3<span class="_ _17"> </span>Undeﬁned<span class="_ _c"> </span>references</div><div class="t m0 x13 h7 y857 ff3 fs4 fc0 sc0 ls0 ws0">As<span class="_ _2"> </span>discussed<span class="_ _d"> </span>in<span class="_ _d"> </span>previous<span class="_ _2"> </span>se<span class="_ _4"></span>ctions,<span class="_ _2"> </span>assem<span class="_ _1"></span>bly<span class="_ _2"> </span>co<span class="_ _4"></span>de<span class="_ _2"> </span>relies<span class="_ _d"> </span>on<span class="_ _d"> </span>lab<span class="_ _4"></span>els<span class="_ _2"> </span>to<span class="_ _d"> </span>refer<span class="_ _2"> </span>to<span class="_ _d"> </span>program</div><div class="t m0 x13 h7 y858 ff3 fs4 fc0 sc0 ls0 ws0">lo<span class="_ _4"></span>cations.<span class="_ _3"> </span>In<span class="_ _5"> </span>some<span class="_ _2"> </span>cases,<span class="_ _5"> </span>an<span class="_ _2"> </span>assembly co<span class="_ _4"></span>de<span class="_ _5"> </span>refers<span class="_ _2"> </span>to<span class="_ _5"> </span>a<span class="_ _2"> </span>lab<span class="_ _4"></span>el<span class="_ _5"> </span>that<span class="_ _5"> </span>is<span class="_ _2"> </span>not<span class="_ _2"> </span>deﬁned<span class="_ _5"> </span>in<span class="_ _2"> </span>the</div><div class="t m0 x13 h7 y859 ff3 fs4 fc0 sc0 ls0 ws0">same<span class="_ _d"> </span>ﬁle.<span class="_ _e"> </span>This<span class="_ _d"> </span>is<span class="_ _d"> </span>common<span class="_ _a"> </span>when<span class="_ _d"> </span>inv<span class="_ _8"></span>oking<span class="_ _d"> </span>a<span class="_ _d"> </span>routine<span class="_ _d"> </span>that<span class="_ _d"> </span>is<span class="_ _d"> </span>implemented<span class="_ _d"> </span>on<span class="_ _d"> </span>another</div><div class="t m0 x13 h7 y85a ff3 fs4 fc0 sc0 ls0 ws0">ﬁle<span class="_ _5"> </span>or<span class="_ _5"> </span>when<span class="_ _5"> </span>accessing<span class="_ _5"> </span>a<span class="_ _5"> </span>global<span class="_ _5"> </span>v<span class="_ _8"></span>ariable<span class="_ _5"> </span>that<span class="_ _5"> </span>is<span class="_ _5"> </span>declared<span class="_ _5"> </span>on<span class="_ _5"> </span>another<span class="_ _5"> </span>ﬁle.<span class="_ _3"> </span>The<span class="_ _5"> </span>following</div><div class="t m0 x13 h7 y85b ff3 fs4 fc0 sc0 ls0 ws0">example shows an assem<span class="_ _1"></span>bly co<span class="_ _4"></span>de that refers to a<span class="_ _5"> </span>lab<span class="_ _4"></span>el that is not deﬁned<span class="_ _5"> </span>on the same</div><div class="t m0 x13 h7 y85c ff3 fs4 fc0 sc0 ls0 ws0">ﬁle,<span class="_ _2"> </span>called<span class="_ _d"> </span><span class="ff5">main.s</span>.<span class="_ _f"> </span>The<span class="_ _d"> </span><span class="ff5">exit<span class="_ _2"> </span></span>lab<span class="_ _4"></span>el<span class="_ _2"> </span>is<span class="_ _d"> </span>used<span class="_ _2"> </span>on<span class="_ _d"> </span>instruction<span class="_ _2"> </span><span class="ff5">jal<span class="_ _d"> </span></span>(line<span class="_ _2"> </span>4),<span class="_ _d"> </span>how<span class="_ _8"></span>ever,<span class="_ _2"> </span>it<span class="_ _2"> </span>is</div><div class="t m0 x13 h7 y85d ff3 fs4 fc0 sc0 ls0 ws0">not<span class="_ _2"> </span>deﬁned<span class="_ _2"> </span>in<span class="_ _2"> </span>this<span class="_ _2"> </span>ﬁle</div><div class="t m0 x68 h11 y85e ffc fs7 fc0 sc0 ls0 ws0">9</div><div class="t m0 x8a h7 y85d ff3 fs4 fc0 sc0 ls0 ws0">.</div><div class="t m0 xd5 h8 y85f ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>Contents<span class="_ _11"> </span>of<span class="_ _e"> </span>the<span class="_ _e"> </span>main.s<span class="_ _e"> </span>file</span></div><div class="t m0 xd5 h8 y860 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _1f"> </span><span class="ff5 fs4">start:</span></div><div class="t m0 xd5 h8 y861 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _36"> </span><span class="ff5 fs4">li<span class="_ _85"> </span>a0,<span class="_ _11"> </span>10</span></div><div class="t m0 xd5 h8 y862 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _36"> </span><span class="ff5 fs4">li<span class="_ _85"> </span>a1,<span class="_ _11"> </span>20</span></div><div class="t m0 xd5 h8 y863 ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _36"> </span><span class="ff5 fs4">jal<span class="_ _11"> </span>exit</span></div><div class="t m0 x14 h7 y864 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _2"> </span>assembler<span class="_ _5"> </span>assembles<span class="_ _2"> </span>this<span class="_ _2"> </span>program<span class="_ _2"> </span>and<span class="_ _d"> </span>register<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _d"> </span></span>lab<span class="_ _4"></span>el<span class="_ _5"> </span>on<span class="_ _d"> </span>the<span class="_ _2"> </span>symbol</div><div class="t m0 x13 h7 y865 ff3 fs4 fc0 sc0 ls0 ws0">table<span class="_ _2"> </span>as<span class="_ _d"> </span>an<span class="_ _2"> </span>undeﬁned<span class="_ _d"> </span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ol.<span class="_ _c"> </span>The<span class="_ _d"> </span><span class="ff5">riscv64-unknown-elf-nm<span class="_ _2"> </span></span>to<span class="_ _4"></span>ol<span class="_ _2"> </span>identiﬁes<span class="_ _2"> </span>the<span class="_ _2"> </span>un-</div><div class="t m0 x13 h7 y866 ff3 fs4 fc0 sc0 ls0 ws0">deﬁned<span class="_ _2"> </span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ols<span class="_ _5"> </span>by<span class="_ _5"> </span>placing<span class="_ _2"> </span>the<span class="_ _2"> </span>‘U’<span class="_ _2"> </span>c<span class="_ _1"></span>haracter<span class="_ _2"> </span>b<span class="_ _4"></span>efore<span class="_ _5"> </span>the<span class="_ _2"> </span>symbol<span class="_ _2"> </span>name.<span class="_ _c"> </span>Assuming<span class="_ _2"> </span>the</div><div class="t m0 x13 h7 y867 ff3 fs4 fc0 sc0 ls0 ws0">previous<span class="_ _5"> </span>co<span class="_ _4"></span>de<span class="_ _5"> </span>was<span class="_ _5"> </span>assembled<span class="_ _5"> </span>in<span class="_ _1"></span>to<span class="_ _5"> </span>the<span class="_ _2"> </span><span class="ff5">main.o<span class="_ _2"> </span></span>ob<span class="_ _4"></span>ject<span class="_ _5"> </span>ﬁle,<span class="_ _2"> </span>we<span class="_ _5"> </span>can<span class="_ _5"> </span>insp<span class="_ _4"></span>ect<span class="_ _5"> </span>the<span class="_ _2"> </span>conten<span class="_ _8"></span>ts</div><div class="t m0 x13 h7 y868 ff3 fs4 fc0 sc0 ls0 ws0">of<span class="_ _2"> </span>its<span class="_ _2"> </span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ol<span class="_ _5"> </span>table<span class="_ _2"> </span>as<span class="_ _2"> </span>follows:</div><div class="t m0 x13 h8 y869 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _11"> </span>riscv64-unknown-elf-nm<span class="_ _e"> </span>main.o</div><div class="t m0 x13 h8 y86a ff5 fs4 fc0 sc0 ls0 ws0">00000000<span class="_ _11"> </span>t<span class="_ _e"> </span>start</div><div class="t m0 x51 h8 y86b ff5 fs4 fc0 sc0 ls0 ws0">U<span class="_ _11"> </span>exit</div><div class="t m0 x14 h7 y86c ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _d"> </span>assembler<span class="_ _d"> </span>also<span class="_ _a"> </span>register<span class="_ _a"> </span>the<span class="_ _d"> </span>reference<span class="_ _a"> </span>to<span class="_ _a"> </span>this<span class="_ _a"> </span>symbol<span class="_ _a"> </span>on<span class="_ _d"> </span>the<span class="_ _a"> </span>relo<span class="_ _4"></span>cation<span class="_ _d"> </span>table.</div><div class="t m0 x13 h7 y86d ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _2"> </span><span class="ff5">riscv64-unknown-elf-objdump<span class="_ _2"> </span></span>to<span class="_ _4"></span>ol<span class="_ _5"> </span>shows<span class="_ _5"> </span>that<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">main.o<span class="_ _2"> </span></span>ob<span class="_ _4"></span>jec<span class="_ _4"></span>t<span class="_ _5"> </span>ﬁle<span class="_ _2"> </span>includes</div><div class="t m0 x13 h7 y86e ff3 fs4 fc0 sc0 ls0 ws0">a<span class="_ _2"> </span>relo<span class="_ _4"></span>cation<span class="_ _5"> </span>record<span class="_ _2"> </span>for<span class="_ _2"> </span>the<span class="_ _2"> </span>reference<span class="_ _2"> </span>to<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _2"> </span></span>lab<span class="_ _4"></span>el<span class="_ _5"> </span>on<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">jal<span class="_ _2"> </span></span>instruction.</div><div class="t m0 x42 h1e y21b ff12 fse fc0 sc0 ls0 ws0">9</div><div class="t m0 x14 h1f y21c ff13 fsf fc0 sc0 ls0 ws0">The <span class="ff28">jal<span class="_ _13"> </span></span>instruction<span class="_ _38"> </span>is used<span class="_ _38"> </span>to invok<span class="_ _8"></span>e<span class="_ _13"> </span>routines.<span class="_ _d"> </span>In<span class="_ _13"> </span>this<span class="_ _38"> </span>case,<span class="_ _13"> </span>it<span class="_ _13"> </span>is<span class="_ _13"> </span>invoking the <span class="ff28">exit<span class="_ _13"> </span></span>routine.<span class="_ _a"> </span>This</div><div class="t m0 x13 h1f y61 ff13 fsf fc0 sc0 ls0 ws0">instruction<span class="_ _38"> </span>will<span class="_ _38"> </span>b<span class="_ _4"></span>e<span class="_ _13"> </span>further<span class="_ _5"> </span>discussed<span class="_ _38"> </span>in<span class="_ _38"> </span>Section<span class="_ _38"> </span>6.7.3.</div><div class="t m0 x43 h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _c"> </span>August<span class="_ _5"> </span>26,<span class="_ _d"> </span>2021)<span class="_ _6f"> </span>30</span></div><a class="l" href="#pf2c" data-dest-detail='[44,"XYZ",151.306,89.795,null]'><div class="d m1" style="border-style:none;position:absolute;left:230.874000px;bottom:333.120000px;width:6.462000px;height:10.102000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pf56" data-dest-detail='[86,"XYZ",136.063,139.477,null]'><div class="d m1" style="border-style:none;position:absolute;left:310.289000px;bottom:67.030000px;width:19.399000px;height:10.367000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:185.308000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

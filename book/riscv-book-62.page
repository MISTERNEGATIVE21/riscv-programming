<div id="pf3e" class="pf w0 h0" data-page-no="3e"><div class="pc pc3e w0 h0"><img class="bi x15 yb2d w2 h84" alt="" src="bg3e.png"/><div class="t m0 x15 h7 y147 ff3 fs4 fc0 sc0 ls0 ws0">4.7.<span class="_ _19"> </span>ASSEMBL<span class="_ _7"></span>Y<span class="_ _2"> </span>DIRECTIVES</div><div class="t m0 x111 h8 y1e ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _32"> </span><span class="ff5 fs4">li<span class="_ _3b"> </span>t1,<span class="_ _31"> </span>max_value</span></div><div class="t m0 x111 h8 yd4 ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _32"> </span><span class="ff5 fs4">ble<span class="_ _82"> </span>a0,<span class="_ _9"> </span>t1,<span class="_ _31"> </span>ok</span></div><div class="t m0 x111 h8 yd5 ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _32"> </span><span class="ff5 fs4">mv<span class="_ _3b"> </span>a0,<span class="_ _31"> </span>t1</span></div><div class="t m0 x111 h8 yfd ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _16"> </span><span class="ff5 fs4">ok:</span></div><div class="t m0 x111 h8 y28a ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _32"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xd h7 yb2e ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _2"> </span><span class="ff5">.equ<span class="_ _2"> </span></span>directiv<span class="_ _1"></span>e<span class="_ _2"> </span>p<span class="_ _4"></span>erforms<span class="_ _5"> </span>the<span class="_ _2"> </span>same<span class="_ _2"> </span>task<span class="_ _2"> </span>as<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">.set<span class="_ _2"> </span></span>directive.</div><div class="t m0 x15 ha yb2f ff7 fs6 fc0 sc0 ls0 ws0">4.7.5<span class="_ _e"> </span>The<span class="_ _a"> </span><span class="ff2">.globl<span class="_ _a"> </span></span>directiv<span class="_ _8"></span>e</div><div class="t m0 x15 h7 yb30 ff3 fs4 fc0 sc0 ls0 ws0">As<span class="_ _30"> </span>discussed in<span class="_ _30"> </span>Section<span class="_ _30"> </span>3.2.4, these<span class="_ _30"> </span>program<span class="_ _2f"> </span>sym<span class="_ _8"></span>b<span class="_ _4"></span>ols<span class="_ _30"> </span>can be<span class="_ _2f"> </span>classiÔ¨Åed<span class="_ _30"> </span>as<span class="_ _2f"> </span>local or<span class="_ _30"> </span>global</div><div class="t m0 x15 h7 yb31 ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _4"></span>ols.<span class="_ _26"> </span>By<span class="_ _b"> </span>default,<span class="_ _3"> </span>symbols<span class="_ _3"> </span>automatically<span class="_ _b"> </span>created<span class="_ _3"> </span>for<span class="_ _b"> </span>lab<span class="_ _4"></span>els<span class="_ _b"> </span>or<span class="_ _3"> </span>explicitly<span class="_ _3"> </span>created</div><div class="t m0 x15 h7 yb32 ff3 fs4 fc0 sc0 ls0 ws0">b<span class="_ _1"></span>y<span class="_ _b"> </span>the<span class="_ _2"> </span>program<span class="_ _b"> </span>using<span class="_ _2"> </span>the<span class="_ _b"> </span><span class="ff5">.set<span class="_ _2"> </span></span>or<span class="_ _b"> </span><span class="ff5">.equ<span class="_ _2"> </span></span>directives<span class="_ _2"> </span>are<span class="_ _b"> </span>stored<span class="_ _2"> </span>on<span class="_ _b"> </span>the<span class="_ _2"> </span>symbol<span class="_ _b"> </span>table<span class="_ _2"> </span>as</div><div class="t m0 x15 h7 yb33 ff3 fs4 fc0 sc0 ls0 ws0">lo<span class="_ _4"></span>cal<span class="_ _b"> </span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ols.<span class="_ _26"> </span>The<span class="_ _b"> </span><span class="ff5">.globl<span class="_ _3"> </span></span>directiv<span class="_ _8"></span>e<span class="_ _3"> </span>can<span class="_ _3"> </span>be<span class="_ _3"> </span>used<span class="_ _3"> </span>to<span class="_ _b"> </span>turn<span class="_ _3"> </span>local<span class="_ _3"> </span>symbols<span class="_ _3"> </span>in<span class="_ _8"></span>to<span class="_ _3"> </span>global</div><div class="t m0 x15 h7 yb34 ff3 fs4 fc0 sc0 ls0 ws0">ones.<span class="_ _12"> </span>The<span class="_ _b"> </span>follo<span class="_ _1"></span>wing<span class="_ _b"> </span>co<span class="_ _4"></span>de<span class="_ _b"> </span>sho<span class="_ _8"></span>ws<span class="_ _b"> </span>an<span class="_ _b"> </span>example<span class="_ _3"> </span>in<span class="_ _b"> </span>whic<span class="_ _8"></span>h<span class="_ _3"> </span>the<span class="_ _0"> </span><span class="ff5">start<span class="_ _b"> </span></span>and<span class="_ _b"> </span>the<span class="_ _b"> </span><span class="ff5">max<span class="_ _b"> </span>temp</span></div><div class="t m0 x15 h7 yb35 ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _4"></span>ols<span class="_ _5"> </span>are<span class="_ _2"> </span>conv<span class="_ _8"></span>erted<span class="_ _2"> </span>into<span class="_ _5"> </span>global<span class="_ _2"> </span>symbols<span class="_ _2"> </span>by<span class="_ _5"> </span>the<span class="_ _2"> </span><span class="ff5">.globl<span class="_ _2"> </span></span>directive.</div><div class="t m0 x111 h8 yb36 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">.globl<span class="_ _31"> </span>max_value</span></div><div class="t m0 x111 h8 yb37 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">.globl<span class="_ _31"> </span>_start</span></div><div class="t m0 x111 h38 yb38 ff24 fs12 fc0 sc0 ls0 ws0">3</div><div class="t m0 x111 h8 yb39 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _16"> </span><span class="ff5 fs4">.set<span class="_ _31"> </span>max_value,<span class="_ _31"> </span>42</span></div><div class="t m0 x111 h38 yb3a ff24 fs12 fc0 sc0 ls0 ws0">5</div><div class="t m0 x111 h8 yb3b ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _16"> </span><span class="ff5 fs4">_start:</span></div><div class="t m0 x111 h8 yb3c ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _32"> </span><span class="ff5 fs4">li<span class="_ _82"> </span>a0,<span class="_ _9"> </span>max_value</span></div><div class="t m0 x111 h8 yb3d ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _32"> </span><span class="ff5 fs4">jal<span class="_ _9"> </span>process_temp</span></div><div class="t m0 x111 h8 yb3e ff24 fs12 fc0 sc0 ls0 ws0">9<span class="_ _32"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x15 ha yb3f ff7 fs6 fc0 sc0 ls0 ws0">4.7.6<span class="_ _e"> </span>The<span class="_ _a"> </span><span class="ff2">.align<span class="_ _a"> </span></span>directiv<span class="_ _8"></span>e</div><div class="t m0 x15 h7 yb40 ff3 fs4 fc0 sc0 ls0 ws0">Some<span class="_ _30"> </span>Instruction<span class="_ _30"> </span>Set<span class="_ _2f"> </span>Arc<span class="_ _8"></span>hitectures<span class="_ _2f"> </span>require<span class="_ _30"> </span>instructions<span class="_ _30"> </span>or<span class="_ _2f"> </span>m<span class="_ _8"></span>ulti-byte<span class="_ _30"> </span>data<span class="_ _30"> </span>to<span class="_ _2f"> </span>be<span class="_ _2f"> </span>stored</div><div class="t m0 x15 h7 yb41 ff3 fs4 fc0 sc0 ls0 ws0">on<span class="_ _30"> </span>addresses<span class="_ _30"> </span>that<span class="_ _2f"> </span>are<span class="_ _30"> </span>multiple<span class="_ _30"> </span>of<span class="_ _30"> </span>a<span class="_ _30"> </span>given<span class="_ _30"> </span>num<span class="_ _8"></span>b<span class="_ _4"></span>er.<span class="_ _b"> </span>F<span class="_ _7"></span>or<span class="_ _30"> </span>example, the<span class="_ _30"> </span>R<span class="_ _23"></span>V32I<span class="_ _2f"> </span>ISA<span class="_ _30"> </span>requires</div><div class="t m0 x15 h7 yb42 ff3 fs4 fc0 sc0 ls0 ws0">instructions<span class="_ _2"> </span>to<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>stored<span class="_ _2"> </span>on<span class="_ _2"> </span>addresses<span class="_ _2"> </span>that<span class="_ _2"> </span>are<span class="_ _2"> </span>multiple<span class="_ _5"> </span>of<span class="_ _2"> </span>four.</div><div class="t m0 xd h7 yb43 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _5"> </span>GNU<span class="_ _2"> </span>assembler<span class="_ _5"> </span>do<span class="_ _4"></span>es<span class="_ _5"> </span>not<span class="_ _2"> </span>v<span class="_ _1"></span>erify<span class="_ _5"> </span>automatically<span class="_ _2"> </span>whether<span class="_ _2"> </span>or<span class="_ _5"> </span>not<span class="_ _2"> </span>R<span class="_ _7"></span>V32I<span class="_ _5"> </span>instruc-</div><div class="t m0 x15 h7 yb44 ff3 fs4 fc0 sc0 ls0 ws0">tions<span class="_ _a"> </span>are<span class="_ _a"> </span>assigned<span class="_ _a"> </span>to<span class="_ _25"> </span>addresses<span class="_ _a"> </span>that<span class="_ _a"> </span>are<span class="_ _a"> </span>multiple<span class="_ _a"> </span>of<span class="_ _a"> </span>four.<span class="_ _1a"> </span>The<span class="_ _3"> </span>following<span class="_ _a"> </span>co<span class="_ _4"></span>de,<span class="_ _a"> </span>for</div><div class="t m0 x15 h7 yb45 ff3 fs4 fc0 sc0 ls0 ws0">example, is assembled without errors by the GNU assem<span class="_ _8"></span>bler.<span class="_ _3"> </span>In<span class="_ _5"> </span>this case, the <span class="ff5">j<span class="_ _31"> </span>next</span></div><div class="t m0 x15 h7 yb46 ff3 fs4 fc0 sc0 ls0 ws0">instruction is stored at<span class="_ _5"> </span>addresses <span class="ff5">0x0</span>,<span class="_ _37"> </span><span class="ff5">0x1</span>,<span class="_ _5"> </span><span class="ff5">0x2</span>,<span class="_ _5"> </span>and <span class="ff5">0x3</span>,<span class="_ _5"> </span>the 8-bit v<span class="_ _8"></span>alue<span class="_ _5"> </span><span class="ff5">0xa<span class="_ _37"> </span></span>is stored</div><div class="t m0 x15 h7 yb47 ff3 fs4 fc0 sc0 ls0 ws0">at address <span class="ff5">0x4</span>,<span class="_ _5"> </span>and<span class="_ _5"> </span>the <span class="ff5">ret<span class="_ _5"> </span></span>instruction is stored<span class="_ _5"> </span>at addresses<span class="_ _5"> </span><span class="ff5">0x5</span>,<span class="_ _5"> </span><span class="ff5">0x6</span>, <span class="ff5">0x7</span>,<span class="_ _5"> </span>and<span class="_ _5"> </span><span class="ff5">0x8</span>.</div><div class="t m0 x111 h8 yb48 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 x111 h8 yb49 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">foo:</span></div><div class="t m0 x111 h8 yb4a ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _32"> </span><span class="ff5 fs4">j<span class="_ _9"> </span>next</span></div><div class="t m0 x111 h8 yb4b ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _32"> </span><span class="ff5 fs4">.byte<span class="_ _9"> </span>0xa</span></div><div class="t m0 x111 h8 yb4c ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _16"> </span><span class="ff5 fs4">next:</span></div><div class="t m0 x111 h8 yb4d ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _32"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xd h7 yb4e ff3 fs4 fc0 sc0 ls0 ws0">Ev<span class="_ _1"></span>en though the previous<span class="_ _2f"> </span>program w<span class="_ _8"></span>as assembled b<span class="_ _8"></span>y the assem<span class="_ _8"></span>bler, a R<span class="_ _7"></span>V32I CPU</div><div class="t m0 x15 h7 yb4f ff3 fs4 fc0 sc0 ls0 ws0">will fail when trying to execute<span class="_ _5"> </span>the <span class="ff5">ret<span class="_ _37"> </span></span>instruction b<span class="_ _4"></span>ecause it requires all instructions</div><div class="t m0 x15 h7 yb50 ff3 fs4 fc0 sc0 ls0 ws0">to<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>stored<span class="_ _2"> </span>starting<span class="_ _2"> </span>at<span class="_ _2"> </span>addresses<span class="_ _2"> </span>that<span class="_ _2"> </span>are<span class="_ _2"> </span>multiple<span class="_ _5"> </span>of<span class="_ _2"> </span>four.</div><div class="t m0 xd h7 yb51 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _b"> </span>programmer<span class="_ _b"> </span>(or<span class="_ _b"> </span>the<span class="_ _b"> </span>compiler)<span class="_ _b"> </span>is<span class="_ _b"> </span>responsible<span class="_ _b"> </span>for<span class="_ _b"> </span>keeping<span class="_ _b"> </span>R<span class="_ _23"></span>V32I<span class="_ _b"> </span>instructions</div><div class="t m0 x15 h7 yb52 ff3 fs4 fc0 sc0 ls0 ws0">aligned<span class="_ _25"> </span>to<span class="_ _25"> </span>4-byte<span class="_ _a"> </span>b<span class="_ _4"></span>oundaries,<span class="_ _9"> </span><span class="ff8">i.e.</span>,<span class="_ _9"> </span>at<span class="_ _9"> </span>addresses<span class="_ _25"> </span>that<span class="_ _25"> </span>are<span class="_ _25"> </span>multiple<span class="_ _a"> </span>of<span class="_ _9"> </span>four.<span class="_ _2b"> </span>In<span class="_ _a"> </span>the</div><div class="t m0 x15 h7 yb53 ff3 fs4 fc0 sc0 ls0 ws0">previous<span class="_ _2"> </span>example,<span class="_ _2"> </span>it<span class="_ _2"> </span>could<span class="_ _b"> </span>be<span class="_ _2"> </span>done<span class="_ _2"> </span>by<span class="_ _5"> </span>adv<span class="_ _8"></span>ancing<span class="_ _b"> </span>the<span class="_ _5"> </span>lo<span class="_ _4"></span>cation<span class="_ _2"> </span>coun<span class="_ _1"></span>ter<span class="_ _2"> </span>by<span class="_ _5"> </span>three<span class="_ _2"> </span>units</div><div class="t m0 x15 h7 yb54 ff3 fs4 fc0 sc0 ls0 ws0">righ<span class="_ _1"></span>t<span class="_ _2f"> </span>after<span class="_ _30"> </span>adding the<span class="_ _30"> </span>8-bit v<span class="_ _7"></span>alue to<span class="_ _30"> </span>the<span class="_ _2f"> </span>program<span class="_ _2f"> </span>(line<span class="_ _30"> </span>4).<span class="_ _3"> </span>In this<span class="_ _30"> </span>context,<span class="_ _2f"> </span>the<span class="_ _30"> </span>following</div><div class="t m0 x15 h7 yb55 ff3 fs4 fc0 sc0 ls0 ws0">co<span class="_ _4"></span>de<span class="_ _5"> </span>would<span class="_ _5"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>executed<span class="_ _2"> </span>correctly<span class="_ _2"> </span>by<span class="_ _5"> </span>a<span class="_ _2"> </span>R<span class="_ _7"></span>V32I<span class="_ _2"> </span>CPU.</div><div class="t m0 x111 h8 yd3 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 x111 h8 y48 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">foo:</span></div><div class="t m0 x1f h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _a"> </span>Marc<span class="_ _8"></span>h<span class="_ _2"> </span>29,<span class="_ _2"> </span>2021)<span class="_ _4e"> </span>49</span></div><a class="l" href="#pf2c" data-dest-detail='[44,"XYZ",90.709,481.85,null]'><div class="d m1" style="border-style:none;position:absolute;left:190.357000px;bottom:635.975000px;width:22.472000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",136.063,113.65,null]'><div class="d m1" style="border-style:none;position:absolute;left:115.217000px;bottom:397.260000px;width:126.533000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,506.875,null]'><div class="d m1" style="border-style:none;position:absolute;left:405.191000px;bottom:385.305000px;width:18.597000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,590.644,null]'><div class="d m1" style="border-style:none;position:absolute;left:363.244000px;bottom:325.387000px;width:14.169000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,552.703,null]'><div class="d m1" style="border-style:none;position:absolute;left:436.769000px;bottom:195.167000px;width:23.440000px;height:10.849000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,590.644,null]'><div class="d m1" style="border-style:none;position:absolute;left:191.957000px;bottom:122.741000px;width:14.169000px;height:11.955000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,552.703,null]'><div class="d m1" style="border-style:none;position:absolute;left:290.543000px;bottom:111.339000px;width:23.440000px;height:10.849000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:141.766000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

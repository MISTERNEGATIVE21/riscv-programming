<div id="pf3f" class="pf w0 h0" data-page-no="3f"><div class="pc pc3f w0 h0"><img class="bi x18 yb3f w2 h83" alt="" src="bg3f.png"/><div class="t m0 x18 h7 y15a ff3 fs4 fc0 sc0 ls0 ws0">4.7.<span class="_ _22"> </span>ASSEMBL<span class="_ _7"></span>Y<span class="_ _2"> </span>DIRECTIVES</div><div class="t m0 x112 h8 y38 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _36"> </span><span class="ff5 fs4">li<span class="_ _3f"> </span>t1,<span class="_ _11"> </span>max_value</span></div><div class="t m0 x112 h8 yed ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _36"> </span><span class="ff5 fs4">ble<span class="_ _85"> </span>a0,<span class="_ _11"> </span>t1,<span class="_ _e"> </span>ok</span></div><div class="t m0 x112 h8 yee ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _36"> </span><span class="ff5 fs4">mv<span class="_ _3f"> </span>a0,<span class="_ _11"> </span>t1</span></div><div class="t m0 x112 h8 y116 ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _1f"> </span><span class="ff5 fs4">ok:</span></div><div class="t m0 x112 h8 y29d ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _36"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xd h7 yb40 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _2"> </span><span class="ff5">.equ<span class="_ _2"> </span></span>directiv<span class="_ _1"></span>e<span class="_ _2"> </span>p<span class="_ _4"></span>erforms<span class="_ _5"> </span>the<span class="_ _2"> </span>same<span class="_ _2"> </span>task<span class="_ _2"> </span>as<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">.set<span class="_ _2"> </span></span>directive.</div><div class="t m0 x18 ha yb41 ff6 fs6 fc0 sc0 ls0 ws0">4.7.5<span class="_ _17"> </span>The<span class="_ _c"> </span><span class="ff2">.globl<span class="_ _c"> </span></span>directiv<span class="_ _8"></span>e</div><div class="t m0 x18 h7 yb42 ff3 fs4 fc0 sc0 ls0 ws0">As<span class="_ _12"> </span>discussed<span class="_ _13"> </span>in<span class="_ _12"> </span>Section<span class="_ _13"> </span>3.2.4,<span class="_ _13"> </span>these<span class="_ _12"> </span>program<span class="_ _13"> </span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ols<span class="_ _12"> </span>can<span class="_ _12"> </span>b<span class="_ _4"></span>e<span class="_ _12"> </span>classiÔ¨Åed<span class="_ _12"> </span>as<span class="_ _13"> </span>lo<span class="_ _4"></span>cal<span class="_ _12"> </span>or<span class="_ _12"> </span>global</div><div class="t m0 x18 h7 yb43 ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _4"></span>ols.<span class="_ _2d"> </span>By<span class="_ _a"> </span>default,<span class="_ _3"> </span>symbols<span class="_ _3"> </span>automatically<span class="_ _a"> </span>created<span class="_ _3"> </span>for<span class="_ _a"> </span>lab<span class="_ _4"></span>els<span class="_ _a"> </span>or<span class="_ _3"> </span>explicitly<span class="_ _a"> </span>created</div><div class="t m0 x18 h7 yb44 ff3 fs4 fc0 sc0 ls0 ws0">b<span class="_ _1"></span>y<span class="_ _d"> </span>the<span class="_ _2"> </span>program<span class="_ _d"> </span>using<span class="_ _d"> </span>the<span class="_ _d"> </span><span class="ff5">.set<span class="_ _d"> </span></span>or<span class="_ _d"> </span><span class="ff5">.equ<span class="_ _d"> </span></span>directives<span class="_ _2"> </span>are<span class="_ _d"> </span>stored<span class="_ _2"> </span>on<span class="_ _d"> </span>the<span class="_ _d"> </span>symbol<span class="_ _d"> </span>table<span class="_ _d"> </span>as</div><div class="t m0 x18 h7 yb45 ff3 fs4 fc0 sc0 ls0 ws0">lo<span class="_ _4"></span>cal<span class="_ _d"> </span>symbols.<span class="_ _10"> </span>The<span class="_ _3"> </span><span class="ff5">.globl<span class="_ _a"> </span></span>directive<span class="_ _a"> </span>can<span class="_ _a"> </span>b<span class="_ _4"></span>e<span class="_ _a"> </span>used<span class="_ _3"> </span>to<span class="_ _a"> </span>turn<span class="_ _3"> </span>lo<span class="_ _4"></span>cal<span class="_ _d"> </span>symbols<span class="_ _3"> </span>into<span class="_ _a"> </span>global</div><div class="t m0 x18 h7 yb46 ff3 fs4 fc0 sc0 ls0 ws0">ones.<span class="_ _1b"> </span>The<span class="_ _d"> </span>following<span class="_ _d"> </span>co<span class="_ _4"></span>de<span class="_ _d"> </span>shows<span class="_ _d"> </span>an<span class="_ _a"> </span>example<span class="_ _a"> </span>in<span class="_ _a"> </span>which<span class="_ _d"> </span>the<span class="_ _22"> </span><span class="ff5">start<span class="_ _d"> </span></span>and<span class="_ _a"> </span>the<span class="_ _a"> </span><span class="ff5">max<span class="_ _a"> </span>temp</span></div><div class="t m0 x18 h7 yb47 ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _4"></span>ols<span class="_ _5"> </span>are<span class="_ _2"> </span>conv<span class="_ _8"></span>erted<span class="_ _2"> </span>into<span class="_ _5"> </span>global<span class="_ _2"> </span>symbols<span class="_ _2"> </span>by<span class="_ _5"> </span>the<span class="_ _2"> </span><span class="ff5">.globl<span class="_ _2"> </span></span>directive.</div><div class="t m0 x112 h8 yb48 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">.globl<span class="_ _e"> </span>max_value</span></div><div class="t m0 x112 h8 yb49 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _1f"> </span><span class="ff5 fs4">.globl<span class="_ _e"> </span>_start</span></div><div class="t m0 x112 h38 yb4a ff24 fs12 fc0 sc0 ls0 ws0">3</div><div class="t m0 x112 h8 yb4b ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _1f"> </span><span class="ff5 fs4">.set<span class="_ _e"> </span>max_value,<span class="_ _11"> </span>42</span></div><div class="t m0 x112 h38 yb4c ff24 fs12 fc0 sc0 ls0 ws0">5</div><div class="t m0 x112 h8 yb4d ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _1f"> </span><span class="ff5 fs4">_start:</span></div><div class="t m0 x112 h8 yb4e ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _36"> </span><span class="ff5 fs4">li<span class="_ _85"> </span>a0,<span class="_ _11"> </span>max_value</span></div><div class="t m0 x112 h8 yb4f ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _36"> </span><span class="ff5 fs4">jal<span class="_ _11"> </span>process_temp</span></div><div class="t m0 x112 h8 yb50 ff24 fs12 fc0 sc0 ls0 ws0">9<span class="_ _36"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x18 ha yb51 ff6 fs6 fc0 sc0 ls0 ws0">4.7.6<span class="_ _17"> </span>The<span class="_ _c"> </span><span class="ff2">.align<span class="_ _c"> </span></span>directiv<span class="_ _8"></span>e</div><div class="t m0 x18 h7 yb52 ff3 fs4 fc0 sc0 ls0 ws0">Some<span class="_ _12"> </span>Instruction<span class="_ _12"> </span>Set<span class="_ _12"> </span>Architectures<span class="_ _12"> </span>require<span class="_ _12"> </span>instructions<span class="_ _12"> </span>or<span class="_ _12"> </span>multi-b<span class="_ _8"></span>yte<span class="_ _12"> </span>data<span class="_ _13"> </span>to<span class="_ _12"> </span>b<span class="_ _4"></span>e<span class="_ _12"> </span>stored</div><div class="t m0 x18 h7 yb53 ff3 fs4 fc0 sc0 ls0 ws0">on<span class="_ _12"> </span>addresses<span class="_ _12"> </span>that<span class="_ _12"> </span>are<span class="_ _13"> </span>m<span class="_ _1"></span>ultiple<span class="_ _12"> </span>of<span class="_ _12"> </span>a<span class="_ _12"> </span>given<span class="_ _12"> </span>n<span class="_ _1"></span>um<span class="_ _1"></span>b<span class="_ _4"></span>er.<span class="_ _a"> </span>F<span class="_ _7"></span>or<span class="_ _12"> </span>example, the<span class="_ _12"> </span>R<span class="_ _2c"></span>V32I<span class="_ _12"> </span>ISA<span class="_ _12"> </span>requires</div><div class="t m0 x18 h7 yb54 ff3 fs4 fc0 sc0 ls0 ws0">instructions<span class="_ _2"> </span>to<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>stored<span class="_ _2"> </span>on<span class="_ _2"> </span>addresses<span class="_ _2"> </span>that<span class="_ _2"> </span>are<span class="_ _2"> </span>multiples<span class="_ _5"> </span>of<span class="_ _2"> </span>four.</div><div class="t m0 xd h7 yb55 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _5"> </span>GNU<span class="_ _2"> </span>assembler<span class="_ _5"> </span>do<span class="_ _4"></span>es<span class="_ _5"> </span>not<span class="_ _2"> </span>v<span class="_ _1"></span>erify<span class="_ _5"> </span>automatically<span class="_ _2"> </span>whether<span class="_ _2"> </span>or<span class="_ _5"> </span>not<span class="_ _2"> </span>R<span class="_ _2c"></span>V32I<span class="_ _2"> </span>instruc-</div><div class="t m0 x18 h7 yb56 ff3 fs4 fc0 sc0 ls0 ws0">tions<span class="_ _c"> </span>are<span class="_ _c"> </span>assigned<span class="_ _c"> </span>to<span class="_ _c"> </span>addresses<span class="_ _c"> </span>that<span class="_ _f"> </span>are<span class="_ _c"> </span>multiple<span class="_ _3"> </span>of<span class="_ _c"> </span>four.<span class="_ _23"> </span>The<span class="_ _c"> </span>following<span class="_ _3"> </span>co<span class="_ _4"></span>de,<span class="_ _f"> </span>for</div><div class="t m0 x18 h7 yb57 ff3 fs4 fc0 sc0 ls0 ws0">example, is assembled without errors by the GNU assem<span class="_ _8"></span>bler.<span class="_ _3"> </span>In<span class="_ _5"> </span>this case, the <span class="ff5">j<span class="_ _e"> </span>next</span></div><div class="t m0 x18 h7 yb58 ff3 fs4 fc0 sc0 ls0 ws0">instruction is stored at<span class="_ _5"> </span>addresses <span class="ff5">0x0</span>,<span class="_ _5"> </span><span class="ff5">0x1</span>, <span class="ff5">0x2</span>,<span class="_ _5"> </span>and <span class="ff5">0x3</span>,<span class="_ _5"> </span>the 8-bit v<span class="_ _8"></span>alue<span class="_ _5"> </span><span class="ff5">0xa<span class="_ _38"> </span></span>is stored</div><div class="t m0 x18 h7 yb59 ff3 fs4 fc0 sc0 ls0 ws0">at address <span class="ff5">0x4</span>,<span class="_ _5"> </span>and<span class="_ _5"> </span>the <span class="ff5">ret<span class="_ _5"> </span></span>instruction is stored<span class="_ _5"> </span>at addresses<span class="_ _5"> </span><span class="ff5">0x5</span>,<span class="_ _5"> </span><span class="ff5">0x6</span>, <span class="ff5">0x7</span>,<span class="_ _5"> </span>and<span class="_ _5"> </span><span class="ff5">0x8</span>.</div><div class="t m0 x112 h8 yb5a ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 x112 h8 yb5b ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _1f"> </span><span class="ff5 fs4">foo:</span></div><div class="t m0 x112 h8 yb5c ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _36"> </span><span class="ff5 fs4">j<span class="_ _11"> </span>next</span></div><div class="t m0 x112 h8 yb5d ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _36"> </span><span class="ff5 fs4">.byte<span class="_ _11"> </span>0xa</span></div><div class="t m0 x112 h8 yb5e ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _1f"> </span><span class="ff5 fs4">next:</span></div><div class="t m0 x112 h8 yb5f ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _36"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xd h7 yb60 ff3 fs4 fc0 sc0 ls0 ws0">Ev<span class="_ _1"></span>en though the previous<span class="_ _13"> </span>program w<span class="_ _8"></span>as assembled b<span class="_ _8"></span>y the assem<span class="_ _8"></span>bler,<span class="_ _5"> </span>a R<span class="_ _2c"></span>V32I CPU</div><div class="t m0 x18 h7 yb61 ff3 fs4 fc0 sc0 ls0 ws0">will fail when trying to execute<span class="_ _5"> </span>the <span class="ff5">ret<span class="_ _38"> </span></span>instruction b<span class="_ _4"></span>ecause it requires all instructions</div><div class="t m0 x18 h7 yb62 ff3 fs4 fc0 sc0 ls0 ws0">to<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>stored<span class="_ _2"> </span>starting<span class="_ _2"> </span>at<span class="_ _2"> </span>addresses<span class="_ _2"> </span>that<span class="_ _2"> </span>are<span class="_ _2"> </span>multiple<span class="_ _5"> </span>of<span class="_ _2"> </span>four.</div><div class="t m0 xd h7 yb63 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _d"> </span>programmer<span class="_ _a"> </span>(or<span class="_ _a"> </span>the<span class="_ _d"> </span>compiler)<span class="_ _a"> </span>is<span class="_ _a"> </span>resp<span class="_ _4"></span>onsible<span class="_ _d"> </span>for<span class="_ _d"> </span>keeping<span class="_ _d"> </span>R<span class="_ _2c"></span>V32I<span class="_ _a"> </span>instructions</div><div class="t m0 x18 h7 yb64 ff3 fs4 fc0 sc0 ls0 ws0">aligned<span class="_ _f"> </span>to<span class="_ _f"> </span>4-byte<span class="_ _c"> </span>b<span class="_ _4"></span>oundaries,<span class="_ _11"> </span><span class="ff8">i.e.</span>,<span class="_ _11"> </span>at<span class="_ _f"> </span>addresses<span class="_ _f"> </span>that<span class="_ _f"> </span>are<span class="_ _f"> </span>multiple<span class="_ _c"> </span>of<span class="_ _11"> </span>four.<span class="_ _24"> </span>In<span class="_ _11"> </span>the</div><div class="t m0 x18 h7 yb65 ff3 fs4 fc0 sc0 ls0 ws0">previous<span class="_ _2"> </span>example,<span class="_ _2"> </span>it<span class="_ _2"> </span>could<span class="_ _d"> </span>be<span class="_ _d"> </span>done<span class="_ _2"> </span>by<span class="_ _5"> </span>adv<span class="_ _8"></span>ancing<span class="_ _2"> </span>the<span class="_ _d"> </span>lo<span class="_ _4"></span>cation<span class="_ _5"> </span>counter<span class="_ _5"> </span>by<span class="_ _2"> </span>three<span class="_ _2"> </span>units</div><div class="t m0 x18 h7 yb66 ff3 fs4 fc0 sc0 ls0 ws0">righ<span class="_ _1"></span>t<span class="_ _12"> </span>after adding<span class="_ _12"> </span>the 8-bit<span class="_ _12"> </span>v<span class="_ _8"></span>alue<span class="_ _13"> </span>to<span class="_ _12"> </span>the program<span class="_ _12"> </span>(line 4).<span class="_ _a"> </span>In<span class="_ _13"> </span>this<span class="_ _12"> </span>context, the<span class="_ _12"> </span>following</div><div class="t m0 x18 h7 yb67 ff3 fs4 fc0 sc0 ls0 ws0">co<span class="_ _4"></span>de<span class="_ _5"> </span>would<span class="_ _5"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>executed<span class="_ _2"> </span>correctly<span class="_ _2"> </span>by<span class="_ _5"> </span>a<span class="_ _2"> </span>R<span class="_ _2c"></span>V32I<span class="_ _2"> </span>CPU.</div><div class="t m0 x112 h8 yec ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 x112 h8 y61 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _1f"> </span><span class="ff5 fs4">foo:</span></div><div class="t m0 x32 h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _3"> </span>August<span class="_ _2"> </span>26,<span class="_ _d"> </span>2021)<span class="_ _6f"> </span>49</span></div><a class="l" href="#pf2d" data-dest-detail='[45,"XYZ",90.709,481.85,null]'><div class="d m1" style="border-style:none;position:absolute;left:190.357000px;bottom:635.975000px;width:22.472000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfb" data-dest-detail='[11,"XYZ",90.709,113.65,null]'><div class="d m1" style="border-style:none;position:absolute;left:115.217000px;bottom:397.260000px;width:126.533000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,506.875,null]'><div class="d m1" style="border-style:none;position:absolute;left:405.191000px;bottom:385.305000px;width:18.597000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,590.644,null]'><div class="d m1" style="border-style:none;position:absolute;left:363.244000px;bottom:325.387000px;width:14.169000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,552.703,null]'><div class="d m1" style="border-style:none;position:absolute;left:436.769000px;bottom:195.167000px;width:23.440000px;height:10.849000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,590.644,null]'><div class="d m1" style="border-style:none;position:absolute;left:191.957000px;bottom:122.741000px;width:14.169000px;height:11.955000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,552.703,null]'><div class="d m1" style="border-style:none;position:absolute;left:290.543000px;bottom:111.339000px;width:23.440000px;height:10.849000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:139.954000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

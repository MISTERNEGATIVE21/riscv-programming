<div id="pf3d" class="pf w0 h0" data-page-no="3d"><div class="pc pc3d w0 h0"><img class="bi x17 yb06 we h83" alt="" src="bg3d.png"/><div class="t m0 x17 h7 y147 ff3 fs4 fc0 sc0 ls0 ws0">CHAPTER<span class="_ _2"> </span>4.<span class="_ _19"> </span>ASSEMBL<span class="_ _7"></span>Y<span class="_ _2"> </span>LANGUAGE</div><div class="t m0 x13 h7 y1e ff3 fs4 fc0 sc0 ls0 ws0">Since<span class="_ _2"> </span>no<span class="_ _b"> </span>information<span class="_ _5"> </span>is<span class="_ _b"> </span>stored<span class="_ _5"> </span>on<span class="_ _b"> </span>the<span class="_ _2"> </span><span class="ff5">.bss<span class="_ _2"> </span></span>section<span class="_ _b"> </span>in<span class="_ _5"> </span>ob<span class="_ _1d"></span>ject<span class="_ _2"> </span>and<span class="_ _b"> </span>executable<span class="_ _5"> </span>ﬁles,</div><div class="t m0 x17 h7 yd4 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2f"> </span>GNU<span class="_ _30"> </span>assembler<span class="_ _30"> </span>do<span class="_ _4"></span>es<span class="_ _2f"> </span>not<span class="_ _30"> </span>allow<span class="_ _30"> </span>assembly<span class="_ _30"> </span>programs to<span class="_ _30"> </span>add data<span class="_ _30"> </span>to the<span class="_ _30"> </span><span class="ff5">.bss<span class="_ _2f"> </span></span>section.</div><div class="t m0 x17 h7 yd5 ff3 fs4 fc0 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _5"> </span>illustrate<span class="_ _2"> </span>this<span class="_ _2"> </span>situation,<span class="_ _2"> </span>let<span class="_ _2"> </span>us<span class="_ _2"> </span>consider<span class="_ _5"> </span>the<span class="_ _2"> </span>following<span class="_ _5"> </span>co<span class="_ _4"></span>de<span class="_ _5"> </span>and<span class="_ _2"> </span>assume<span class="_ _2"> </span>it<span class="_ _2"> </span>is<span class="_ _2"> </span>stored</div><div class="t m0 x17 h7 yfd ff3 fs4 fc0 sc0 ls0 ws0">on<span class="_ _2"> </span>a<span class="_ _2"> </span>ﬁle<span class="_ _2"> </span>named<span class="_ _2"> </span><span class="ff5">data-on-bss.s</span>:</div><div class="t m0 xd5 h8 yb07 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">.section<span class="_ _31"> </span>.bss</span></div><div class="t m0 xd5 h8 yb08 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">x:<span class="_ _31"> </span>.word<span class="_ _31"> </span>10</span></div><div class="t m0 xd5 h8 yb09 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _16"> </span><span class="ff5 fs4">.section<span class="_ _31"> </span>.text</span></div><div class="t m0 xd5 h8 yb0a ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _16"> </span><span class="ff5 fs4">set_x:</span></div><div class="t m0 xd5 h8 yb0b ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _32"> </span><span class="ff5 fs4">la<span class="_ _9"> </span>t1,<span class="_ _31"> </span>x</span></div><div class="t m0 xd5 h8 yb0c ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _32"> </span><span class="ff5 fs4">sw<span class="_ _9"> </span>a0,<span class="_ _31"> </span>(t1)</span></div><div class="t m0 xd5 h8 yb0d ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _32"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x13 h7 yb0e ff3 fs4 fc0 sc0 ls0 ws0">This co<span class="_ _4"></span>de is trying to use the <span class="ff5">.word<span class="_ _9"> </span>10<span class="_ _37"> </span></span>directive to add a 32-bit v<span class="_ _8"></span>alue to the <span class="ff5">.bss</span></div><div class="t m0 x17 h7 yb0f ff3 fs4 fc0 sc0 ls0 ws0">section.<span class="_ _3"> </span>How<span class="_ _8"></span>ever,<span class="_ _5"> </span>when<span class="_ _5"> </span>pro<span class="_ _4"></span>cessing<span class="_ _5"> </span>the<span class="_ _5"> </span><span class="ff5">.word<span class="_ _31"> </span>10<span class="_ _5"> </span></span>directive,<span class="_ _5"> </span>the<span class="_ _5"> </span>GNU<span class="_ _5"> </span>assembler<span class="_ _5"> </span>stops</div><div class="t m0 x17 h7 yb10 ff3 fs4 fc0 sc0 ls0 ws0">assem<span class="_ _1"></span>bling<span class="_ _2"> </span>the<span class="_ _2"> </span>co<span class="_ _4"></span>de<span class="_ _5"> </span>and<span class="_ _2"> </span>emits<span class="_ _2"> </span>the<span class="_ _2"> </span>following<span class="_ _5"> </span>error<span class="_ _2"> </span>message:</div><div class="t m0 xd5 h8 yb11 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">$<span class="_ _31"> </span>riscv64-unknown-elf-as<span class="_ _31"> </span>-march=rv32im<span class="_ _9"> </span>data-on-bss.s<span class="_ _31"> </span>-o<span class="_ _31"> </span>data-on-bss.o</span></div><div class="t m0 xd5 h8 yb12 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">data-on-bss.s:<span class="_ _31"> </span>Assembler<span class="_ _31"> </span>messages:</span></div><div class="t m0 xd5 h8 yb13 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _16"> </span><span class="ff5 fs4">data-on-bss.s:2:<span class="_ _31"> </span>Error:<span class="_ _31"> </span>attempt<span class="_ _9"> </span>to<span class="_ _31"> </span>store<span class="_ _31"> </span>non-zero<span class="_ _31"> </span>value<span class="_ _31"> </span>in<span class="_ _9"> </span>section<span class="_ _31"> </span>‘.bss’</span></div><div class="t m0 x13 h7 yb14 ff3 fs4 fc0 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _2f"> </span>allo<span class="_ _4"></span>cate<span class="_ _30"> </span>v<span class="_ _8"></span>ariables on<span class="_ _30"> </span>the <span class="ff5">.bss<span class="_ _2f"> </span></span>section<span class="_ _2f"> </span>it<span class="_ _2f"> </span>suﬃces<span class="_ _2f"> </span>to<span class="_ _2f"> </span>declare<span class="_ _2f"> </span>a<span class="_ _2f"> </span>label to<span class="_ _2f"> </span>iden<span class="_ _8"></span>tify the</div><div class="t m0 x17 h7 yb15 ff3 fs4 fc0 sc0 ls0 ws0">v<span class="_ _8"></span>ariable<span class="_ _2"> </span>and<span class="_ _b"> </span>adv<span class="_ _7"></span>ance<span class="_ _b"> </span>the<span class="_ _2"> </span><span class="ff5">.bss<span class="_ _b"> </span></span>location<span class="_ _b"> </span>coun<span class="_ _8"></span>ter<span class="_ _b"> </span>b<span class="_ _8"></span>y<span class="_ _b"> </span>the<span class="_ _2"> </span>amount<span class="_ _2"> </span>of<span class="_ _b"> </span>b<span class="_ _8"></span>ytes<span class="_ _b"> </span>the<span class="_ _2"> </span>v<span class="_ _8"></span>ariable</div><div class="t m0 x17 h7 yb16 ff3 fs4 fc0 sc0 ls0 ws0">require,<span class="_ _2"> </span>so<span class="_ _2"> </span>further<span class="_ _2"> </span>v<span class="_ _8"></span>ariables<span class="_ _2"> </span>are<span class="_ _2"> </span>allo<span class="_ _4"></span>cated<span class="_ _5"> </span>on<span class="_ _2"> </span>other<span class="_ _2"> </span>address.</div><div class="t m0 x13 h7 yb17 ff3 fs4 fc0 sc0 ls0 ws0">The <span class="ff5">.skip<span class="_ _31"> </span>N<span class="_ _5"> </span></span>directive is<span class="_ _5"> </span>a directive that<span class="_ _5"> </span>adv<span class="_ _8"></span>ances<span class="_ _5"> </span>the<span class="_ _5"> </span>lo<span class="_ _4"></span>cation counter b<span class="_ _1"></span>y<span class="_ _5"> </span><span class="ff5">N<span class="_ _5"> </span></span>units</div><div class="t m0 x17 h7 yb18 ff3 fs4 fc0 sc0 ls0 ws0">and<span class="_ _b"> </span>can<span class="_ _3"> </span>b<span class="_ _4"></span>e<span class="_ _b"> </span>used<span class="_ _b"> </span>to<span class="_ _3"> </span>allocate<span class="_ _3"> </span>space<span class="_ _b"> </span>for<span class="_ _3"> </span>v<span class="_ _8"></span>ariables<span class="_ _b"> </span>on<span class="_ _3"> </span>the<span class="_ _b"> </span><span class="ff5">.bss<span class="_ _3"> </span></span>section.<span class="_ _26"> </span>The<span class="_ _b"> </span>following</div><div class="t m0 x17 h7 yb19 ff3 fs4 fc0 sc0 ls0 ws0">co<span class="_ _4"></span>de<span class="_ _b"> </span>shows<span class="_ _b"> </span>ho<span class="_ _1"></span>w<span class="_ _3"> </span>the<span class="_ _b"> </span><span class="ff5">.skip<span class="_ _3"> </span></span>directive<span class="_ _b"> </span>can<span class="_ _3"> </span>be<span class="_ _3"> </span>combined<span class="_ _b"> </span>with<span class="_ _3"> </span>labels<span class="_ _3"> </span>to<span class="_ _3"> </span>allocate<span class="_ _3"> </span>space</div><div class="t m0 x17 h7 yb1a ff3 fs4 fc0 sc0 ls0 ws0">for<span class="_ _2"> </span>three<span class="_ _2"> </span>distinct<span class="_ _2"> </span>v<span class="_ _8"></span>ariables:<span class="_ _a"> </span><span class="ff5">x</span>,<span class="_ _2"> </span><span class="ff5">V</span>,<span class="_ _2"> </span>and<span class="_ _b"> </span><span class="ff5">y</span>.<span class="_ _3"> </span>In<span class="_ _2"> </span>this<span class="_ _2"> </span>example,<span class="_ _b"> </span>the<span class="_ _5"> </span>program<span class="_ _2"> </span>is<span class="_ _2"> </span>allo<span class="_ _4"></span>cating<span class="_ _2"> </span>4</div><div class="t m0 x17 h7 yb1b ff3 fs4 fc0 sc0 ls0 ws0">b<span class="_ _1"></span>ytes<span class="_ _b"> </span>for<span class="_ _b"> </span>v<span class="_ _7"></span>ariables<span class="_ _b"> </span>x<span class="_ _b"> </span>and<span class="_ _b"> </span>y<span class="_ _2"> </span>and<span class="_ _b"> </span>80<span class="_ _b"> </span>b<span class="_ _8"></span>ytes<span class="_ _b"> </span>for<span class="_ _b"> </span>v<span class="_ _8"></span>ariable<span class="_ _b"> </span>V.<span class="_ _b"> </span>As<span class="_ _2"> </span>a<span class="_ _b"> </span>consequence,<span class="_ _b"> </span>lab<span class="_ _4"></span>els<span class="_ _b"> </span><span class="ff5">x</span>,</div><div class="t m0 x17 h7 yb1c ff5 fs4 fc0 sc0 ls0 ws0">V<span class="ff3">,<span class="_ _2"> </span>and<span class="_ _2"> </span></span>y<span class="_ _2"> </span><span class="ff3">will<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>asso<span class="_ _4"></span>ciated<span class="_ _5"> </span>with<span class="_ _2"> </span>addresses<span class="_ _2"> </span></span>0x0<span class="ff3">,<span class="_ _2"> </span></span>0x4<span class="ff3">,<span class="_ _2"> </span>and<span class="_ _2"> </span></span>0x54<span class="ff3">,<span class="_ _2"> </span>resp<span class="_ _4"></span>ectiv<span class="_ _1"></span>ely<span class="_ _7"></span>.</span></div><div class="t m0 xd5 h8 yb1d ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">.section<span class="_ _31"> </span>.bss</span></div><div class="t m0 xd5 h8 yb1e ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">x:<span class="_ _31"> </span>.skip<span class="_ _31"> </span>4</span></div><div class="t m0 xd5 h8 yb1f ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _16"> </span><span class="ff5 fs4">V:<span class="_ _31"> </span>.skip<span class="_ _31"> </span>80</span></div><div class="t m0 xd5 h8 yb20 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _16"> </span><span class="ff5 fs4">y:<span class="_ _31"> </span>.skip<span class="_ _31"> </span>4</span></div><div class="t m0 x13 h7 yb21 ff6 fs4 fc0 sc0 ls0 ws0">NOTE:<span class="_ _11"> </span><span class="ff3">Some<span class="_ _b"> </span>systems<span class="_ _3"> </span>initialize<span class="_ _3"> </span>the<span class="_ _3"> </span>memory<span class="_ _3"> </span>words<span class="_ _3"> </span>dedicated<span class="_ _3"> </span>to<span class="_ _3"> </span>the<span class="_ _3"> </span><span class="ff5">.bss</span></span></div><div class="t m0 x13 h7 yb22 ff3 fs4 fc0 sc0 ls0 ws0">section with<span class="_ _5"> </span>zeros when<span class="_ _5"> </span>loading the<span class="_ _5"> </span>program into the main<span class="_ _5"> </span>memory for<span class="_ _5"> </span>execu-</div><div class="t m0 x13 h7 yb23 ff3 fs4 fc0 sc0 ls0 ws0">tion.<span class="_ _16"> </span>Nonetheless,<span class="_ _b"> </span>the<span class="_ _b"> </span>programmer<span class="_ _b"> </span>should<span class="_ _2"> </span>not<span class="_ _b"> </span>assume<span class="_ _b"> </span>v<span class="_ _8"></span>ariables<span class="_ _b"> </span>on<span class="_ _b"> </span>the<span class="_ _b"> </span><span class="ff5">.bss</span></div><div class="t m0 x13 h7 yb24 ff3 fs4 fc0 sc0 ls0 ws0">section<span class="_ _2"> </span>will<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>initialized<span class="_ _2"> </span>with<span class="_ _2"> </span>zeros.</div><div class="t m0 x17 ha yb25 ff7 fs6 fc0 sc0 ls0 ws0">4.7.4<span class="_ _e"> </span>The<span class="_ _a"> </span><span class="ff2">.set<span class="_ _a"> </span></span>and<span class="_ _a"> </span><span class="ff2">.equ<span class="_ _a"> </span></span>directiv<span class="_ _8"></span>es</div><div class="t m0 x17 h7 yb26 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _b"> </span><span class="ff5">.set<span class="_ _9"> </span>name,<span class="_ _31"> </span>expression<span class="_ _2"> </span></span>directive<span class="_ _2"> </span>adds<span class="_ _b"> </span>a<span class="_ _b"> </span>sym<span class="_ _8"></span>b<span class="_ _4"></span>ol<span class="_ _2"> </span>to<span class="_ _b"> </span>the<span class="_ _2"> </span>symbol<span class="_ _b"> </span>table.<span class="_ _9"> </span>It<span class="_ _b"> </span>tak<span class="_ _1"></span>es</div><div class="t m0 x17 h7 yb27 ff3 fs4 fc0 sc0 ls0 ws0">a<span class="_ _5"> </span>name<span class="_ _5"> </span>and<span class="_ _2"> </span>an<span class="_ _5"> </span>expression<span class="_ _2"> </span>as<span class="_ _5"> </span>arguments, ev<span class="_ _8"></span>aluates<span class="_ _2"> </span>an<span class="_ _5"> </span>expression<span class="_ _5"> </span>to<span class="_ _2"> </span>a<span class="_ _5"> </span>v<span class="_ _8"></span>alue<span class="_ _2"> </span>and<span class="_ _5"> </span>store</div><div class="t m0 x17 h7 yb28 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _b"> </span>name<span class="_ _3"> </span>and<span class="_ _b"> </span>the<span class="_ _3"> </span>resulting<span class="_ _3"> </span>v<span class="_ _7"></span>alue<span class="_ _3"> </span>in<span class="_ _1"></span>to<span class="_ _b"> </span>the<span class="_ _3"> </span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ol<span class="_ _b"> </span>table.<span class="_ _26"> </span>The<span class="_ _b"> </span>following<span class="_ _b"> </span>co<span class="_ _4"></span>de<span class="_ _b"> </span>shows</div><div class="t m0 x17 h7 yb29 ff3 fs4 fc0 sc0 ls0 ws0">ho<span class="_ _1"></span>w<span class="_ _b"> </span>the<span class="_ _2"> </span><span class="ff5">.set<span class="_ _b"> </span></span>directiv<span class="_ _1"></span>e<span class="_ _b"> </span>can<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _2"> </span>used<span class="_ _b"> </span>to<span class="_ _b"> </span>associate<span class="_ _b"> </span>v<span class="_ _8"></span>alues<span class="_ _b"> </span>to<span class="_ _2"> </span>symbols<span class="_ _b"> </span>and<span class="_ _b"> </span>use<span class="_ _2"> </span>them<span class="_ _b"> </span>on</div><div class="t m0 x17 h7 yb2a ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _3"> </span>program.<span class="_ _15"> </span>In<span class="_ _3"> </span>this<span class="_ _3"> </span>case,<span class="_ _a"> </span>the<span class="_ _3"> </span>program<span class="_ _3"> </span>ﬁrst<span class="_ _3"> </span>deﬁnes<span class="_ _3"> </span>the<span class="_ _3"> </span>symbol<span class="_ _3"> </span>named<span class="_ _3"> </span><span class="ff5">max<span class="_ _b"> </span>value</span></div><div class="t m0 x17 h7 yb2b ff3 fs4 fc0 sc0 ls0 ws0">and<span class="_ _b"> </span>associates<span class="_ _b"> </span>it<span class="_ _2"> </span>with<span class="_ _b"> </span>v<span class="_ _8"></span>alue<span class="_ _b"> </span>42<span class="_ _2"> </span>(line<span class="_ _b"> </span>1).<span class="_ _9"> </span>Then,<span class="_ _b"> </span>it<span class="_ _b"> </span>uses<span class="_ _2"> </span>the<span class="_ _b"> </span><span class="ff5">max<span class="_ _b"> </span>value<span class="_ _b"> </span></span>sym<span class="_ _8"></span>b<span class="_ _4"></span>ol<span class="_ _2"> </span>on<span class="_ _b"> </span>the</div><div class="t m0 x17 h7 yb2c ff5 fs4 fc0 sc0 ls0 ws0">li<span class="_ _2"> </span><span class="ff3">instruction<span class="_ _2"> </span>(line<span class="_ _2"> </span>4).</span></div><div class="t m0 xd5 h8 yd2 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">.set<span class="_ _31"> </span>max_value,<span class="_ _31"> </span>42</span></div><div class="t m0 xd5 h38 yd3 ff24 fs12 fc0 sc0 ls0 ws0">2</div><div class="t m0 xd5 h8 y48 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _16"> </span><span class="ff5 fs4">truncates_value_to_max:</span></div><div class="t m0 x42 h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _3"> </span>March<span class="_ _2"> </span>29,<span class="_ _2"> </span>2021)<span class="_ _85"> </span>48</span></div><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,590.644,null]'><div class="d m1" style="border-style:none;position:absolute;left:414.226000px;bottom:594.146000px;width:14.169000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfb" data-dest-detail='[11,"XYZ",90.709,465.032,null]'><div class="d m1" style="border-style:none;position:absolute;left:383.178000px;bottom:276.892000px;width:61.658000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:187.121000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

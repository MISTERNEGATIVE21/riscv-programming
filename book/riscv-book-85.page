<div id="pf55" class="pf w0 h0" data-page-no="55"><div class="pc pc55 w0 h0"><img class="bi x18 y194 we h20" alt="" src="bg55.png"/><div class="t m0 x18 h7 y15a ff3 fs4 fc0 sc0 ls0 ws0">6.7.<span class="_ _22"> </span>CONTROL-FLO<span class="_ _8"></span>W<span class="_ _2"> </span>INSTRUCTIONS</div><div class="t m0 xd h7 y38 ff7 fs4 fc0 sc0 ls0 ws0">Conditional<span class="_ _e"> </span>control-ﬂo<span class="_ _8"></span>w<span class="_ _e"> </span>instructions<span class="_ _1f"> </span>are<span class="_ _e"> </span>usually<span class="_ _1f"> </span>emplo<span class="_ _8"></span>yed<span class="_ _e"> </span>to<span class="_ _e"> </span>imple-</div><div class="t m0 x18 h7 yed ff7 fs4 fc0 sc0 ls0 ws0">men<span class="_ _8"></span>t<span class="_ _d"> </span>if<span class="_ _d"> </span>and<span class="_ _d"> </span>conditional<span class="_ _d"> </span>lo<span class="_ _4"></span>op<span class="_ _2"> </span>statements<span class="ff3">.<span class="_ _3"> </span>The<span class="_ _5"> </span>following co<span class="_ _4"></span>de<span class="_ _5"> </span>shows an<span class="_ _5"> </span>example</span></div><div class="t m0 x18 h7 yee ff3 fs4 fc0 sc0 ls0 ws0">in which the branc<span class="_ _1"></span>h not equal<span class="_ _5"> </span>instruction (<span class="ff5">bne</span>) is<span class="_ _5"> </span>used to implement a lo<span class="_ _4"></span>op that iter-</div><div class="t m0 x18 h7 y116 ff3 fs4 fc0 sc0 ls0 ws0">ates 10<span class="_ _13"> </span>times.<span class="_ _3"> </span>In this<span class="_ _13"> </span>example, register <span class="ff5">a0<span class="_ _12"> </span></span>is used as the<span class="_ _12"> </span>lo<span class="_ _4"></span>op coun<span class="_ _8"></span>ter and is<span class="_ _13"> </span>initialized</div><div class="t m0 x18 h7 y29d ff3 fs4 fc0 sc0 ls0 ws0">with<span class="_ _2"> </span>the<span class="_ _d"> </span>v<span class="_ _8"></span>alue<span class="_ _2"> </span>ten<span class="_ _d"> </span>(line<span class="_ _2"> </span>2).<span class="_ _f"> </span>After<span class="_ _d"> </span>each<span class="_ _5"> </span>lo<span class="_ _4"></span>op<span class="_ _2"> </span>iteration,<span class="_ _d"> </span>the<span class="_ _2"> </span>counter<span class="_ _2"> </span>is<span class="_ _2"> </span>decremented<span class="_ _2"> </span>b<span class="_ _1"></span>y</div><div class="t m0 x18 h7 y49d ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _5"> </span>subtract<span class="_ _2"> </span>(<span class="ff5">sub</span>)<span class="_ _5"> </span>instruction<span class="_ _2"> </span>(line<span class="_ _5"> </span>7),<span class="_ _2"> </span>and<span class="_ _5"> </span>the<span class="_ _2"> </span>counter is<span class="_ _2"> </span>compared<span class="_ _5"> </span>with<span class="_ _2"> </span>zero<span class="_ _5"> </span>by<span class="_ _5"> </span>the</div><div class="t m0 x18 h7 y49e ff5 fs4 fc0 sc0 ls0 ws0">bne<span class="_ _2"> </span><span class="ff3">instruction</span></div><div class="t m0 x78 h11 yebb ffc fs7 fc0 sc0 ls0 ws0">14</div><div class="t m0 x104 h7 y49e ff3 fs4 fc0 sc0 ls0 ws0">(line<span class="_ _2"> </span>8).<span class="_ _c"> </span>If<span class="_ _2"> </span>the<span class="_ _2"> </span>counter<span class="_ _5"> </span>is<span class="_ _d"> </span>not<span class="_ _2"> </span>zero,<span class="_ _2"> </span>the<span class="_ _2"> </span>control-ﬂo<span class="_ _8"></span>w<span class="_ _2"> </span>is<span class="_ _2"> </span>redirected<span class="_ _2"> </span>to</div><div class="t m0 x18 h7 y49f ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _13"> </span>LOOP<span class="_ _13"> </span>label and<span class="_ _12"> </span>the loop is<span class="_ _12"> </span>executed again, otherwise,<span class="_ _13"> </span>the<span class="_ _12"> </span>execution ﬂo<span class="_ _8"></span>w proceeds</div><div class="t m0 x18 h7 y94d ff3 fs4 fc0 sc0 ls0 ws0">normally<span class="_ _7"></span>,<span class="_ _2"> </span>and<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">add<span class="_ _2"> </span></span>instruction<span class="_ _2"> </span>(placed<span class="_ _2"> </span>after<span class="_ _2"> </span>the<span class="_ _2"> </span>lo<span class="_ _4"></span>op)<span class="_ _5"> </span>is<span class="_ _2"> </span>executed<span class="_ _2"> </span>(line<span class="_ _2"> </span>9).</div><div class="t m0 x112 h8 yebc ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _7c"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>Initializes<span class="_ _e"> </span>the<span class="_ _11"> </span>counter</span></div><div class="t m0 x112 h8 yebd ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _7c"> </span><span class="ff5 fs4">mov<span class="_ _e"> </span>a0,<span class="_ _e"> </span>10</span></div><div class="t m0 x112 h8 yebe ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _1f"> </span><span class="ff5 fs4">LOOP:</span></div><div class="t m0 x112 h8 yebf ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _7c"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>Do<span class="_ _e"> </span>something</span></div><div class="t m0 x112 h8 yec0 ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _7c"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>...</span></div><div class="t m0 x112 h8 yec1 ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _7c"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>Decrements<span class="_ _e"> </span>the<span class="_ _11"> </span>counter<span class="_ _e"> </span>and<span class="_ _e"> </span>loop<span class="_ _e"> </span>back</span></div><div class="t m0 x112 h8 yec2 ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _7c"> </span><span class="ff5 fs4">sub<span class="_ _e"> </span>a0,<span class="_ _e"> </span>a0,<span class="_ _11"> </span>1</span></div><div class="t m0 x112 h8 yec3 ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _7c"> </span><span class="ff5 fs4">bne<span class="_ _e"> </span>a0,<span class="_ _e"> </span>zero,<span class="_ _11"> </span>LOOP</span></div><div class="t m0 x112 h8 yec4 ff24 fs12 fc0 sc0 ls0 ws0">9<span class="_ _7c"> </span><span class="ff5 fs4">add<span class="_ _e"> </span>a1,<span class="_ _e"> </span>a1,<span class="_ _11"> </span>a1<span class="_ _5a"> </span>#<span class="_ _11"> </span>Instruction<span class="_ _e"> </span>after<span class="_ _e"> </span>the<span class="_ _e"> </span>loop</span></div><div class="t m0 xd h7 yec5 ff3 fs4 fc0 sc0 ls0 ws0">Chapter<span class="_ _5"> </span>7<span class="_ _5"> </span>discusses<span class="_ _5"> </span>how<span class="_ _5"> </span>con<span class="_ _1"></span>trol-ﬂo<span class="_ _1"></span>w<span class="_ _5"> </span>instructions<span class="_ _5"> </span>can<span class="_ _5"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>used<span class="_ _5"> </span>to<span class="_ _5"> </span>implement<span class="_ _5"> </span>high-</div><div class="t m0 x18 h7 yec6 ff3 fs4 fc0 sc0 ls0 ws0">lev<span class="_ _1"></span>el<span class="_ _a"> </span>language<span class="_ _3"> </span>conditional<span class="_ _a"> </span>and<span class="_ _3"> </span>lo<span class="_ _4"></span>op<span class="_ _a"> </span>statements,<span class="_ _a"> </span>such<span class="_ _a"> </span>as<span class="_ _a"> </span>C<span class="_ _3"> </span>and<span class="_ _3"> </span>C++<span class="_ _a"> </span><span class="ff5">if-then</span>,<span class="_ _3"> </span>and</div><div class="t m0 x18 h7 yec7 ff5 fs4 fc0 sc0 ls0 ws0">if-then-else<span class="_ _2"> </span><span class="ff3">statemen<span class="_ _1"></span>ts<span class="_ _2"> </span>and<span class="_ _2"> </span><span class="ff5">while<span class="_ _2"> </span></span>and<span class="_ _2"> </span><span class="ff5">for<span class="_ _2"> </span></span>lo<span class="_ _4"></span>ops.</span></div><div class="t m0 xd h7 yec8 ff7 fs4 fc0 sc0 ls0 ws0">NOTE:<span class="_ _1a"> </span><span class="ff3">In<span class="_ _a"> </span>the<span class="_ _c"> </span>RISC-V<span class="_ _3"> </span>ISA<span class="_ _c"> </span>manual<span class="_ _3"> </span>[4],<span class="_ _c"> </span>W<span class="_ _7"></span>aterman<span class="_ _3"> </span>and<span class="_ _c"> </span>Asanovi<span class="_ _8"></span>´<span class="_ _7b"></span>c<span class="_ _c"> </span>use<span class="_ _3"> </span>the</span></div><div class="t m0 xd h7 yec9 ff3 fs4 fc0 sc0 ls0 ws0">term<span class="_ _2"> </span>conditional<span class="_ _d"> </span>branch<span class="_ _2"> </span>to<span class="_ _2"> </span>refer<span class="_ _d"> </span>to<span class="_ _2"> </span>conditional<span class="_ _d"> </span>control-ﬂo<span class="_ _8"></span>w<span class="_ _d"> </span>instructions.<span class="_ _f"> </span>No-</div><div class="t m0 xd h7 yeca ff3 fs4 fc0 sc0 ls0 ws0">tice<span class="_ _a"> </span>that<span class="_ _a"> </span>the<span class="_ _a"> </span>term<span class="_ _a"> </span>“branch”<span class="_ _d"> </span>suggests<span class="_ _a"> </span>that<span class="_ _a"> </span>the<span class="_ _3"> </span>execution<span class="_ _a"> </span>ma<span class="_ _1"></span>y<span class="_ _a"> </span>diverge<span class="_ _d"> </span>to<span class="_ _a"> </span>tw<span class="_ _8"></span>o</div><div class="t m0 xd h7 yecb ff3 fs4 fc0 sc0 ls0 ws0">diﬀeren<span class="_ _1"></span>t<span class="_ _5"> </span>paths,<span class="_ _2"> </span>which<span class="_ _5"> </span>is<span class="_ _2"> </span>the<span class="_ _5"> </span>case<span class="_ _2"> </span>for<span class="_ _2"> </span>RISC-V<span class="_ _2"> </span>conditional<span class="_ _5"> </span>control-ﬂo<span class="_ _8"></span>w<span class="_ _2"> </span>instruc-</div><div class="t m0 xd h7 yecc ff3 fs4 fc0 sc0 ls0 ws0">tions.<span class="_ _3"> </span>The authors<span class="_ _5"> </span>use the<span class="_ _5"> </span>term unconditional<span class="_ _5"> </span>jumps to<span class="_ _5"> </span>refer to unconditional</div><div class="t m0 xd h7 yecd ff3 fs4 fc0 sc0 ls0 ws0">con<span class="_ _1"></span>trol-ﬂo<span class="_ _1"></span>w<span class="_ _2"> </span>instructions.</div><div class="t m0 x18 ha yece ff6 fs6 fc0 sc0 ls0 ws0">6.7.2<span class="_ _17"> </span>Direct<span class="_ _c"> </span>vs<span class="_ _c"> </span>indirect<span class="_ _c"> </span>con<span class="_ _8"></span>trol-ﬂow<span class="_ _3"> </span>instructions</div><div class="t m0 x18 h7 yecf ff7 fs4 fc0 sc0 ls0 ws0">A<span class="_ _a"> </span>direct<span class="_ _3"> </span>con<span class="_ _8"></span>trol-ﬂow<span class="_ _a"> </span>instruction<span class="_ _a"> </span>is<span class="_ _3"> </span>an<span class="_ _a"> </span>instruction<span class="_ _a"> </span>that<span class="_ _3"> </span>has<span class="_ _a"> </span>the<span class="_ _3"> </span>target<span class="_ _a"> </span>ad-</div><div class="t m0 x18 h7 yed0 ff7 fs4 fc0 sc0 ls0 ws0">dress<span class="_ _11"> </span>enco<span class="_ _4"></span>ded<span class="_ _f"> </span>directly<span class="_ _11"> </span>into<span class="_ _f"> </span>the<span class="_ _e"> </span>instruction<span class="_ _11"> </span>itself<span class="ff3">.<span class="_ _22"> </span>F<span class="_ _7"></span>or<span class="_ _3"> </span>example,<span class="_ _f"> </span>instruction</span></div><div class="t m0 x18 h7 yed1 ff5 fs4 fc0 sc0 ls0 ws0">beq<span class="_ _11"> </span>a0,<span class="_ _e"> </span>a1,<span class="_ _e"> </span>L<span class="_ _3"> </span><span class="ff3">is<span class="_ _a"> </span>a<span class="_ _3"> </span>direct<span class="_ _a"> </span>control-ﬂo<span class="_ _8"></span>w<span class="_ _3"> </span>instruction<span class="_ _3"> </span>because<span class="_ _3"> </span>the<span class="_ _3"> </span>target<span class="_ _a"> </span>address,<span class="_ _3"> </span><span class="ff8">i.e.</span>,</span></div><div class="t m0 x18 h7 yed2 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span>address<span class="_ _2"> </span>deﬁned<span class="_ _2"> </span>b<span class="_ _1"></span>y<span class="_ _2"> </span>lab<span class="_ _4"></span>el<span class="_ _5"> </span><span class="ff5">L</span>,<span class="_ _2"> </span>is<span class="_ _2"> </span>enco<span class="_ _4"></span>ded<span class="_ _5"> </span>into<span class="_ _5"> </span>the<span class="_ _2"> </span>instruction<span class="_ _2"> </span>itself.</div><div class="t m0 xd h7 yed3 ff7 fs4 fc0 sc0 ls0 ws0">An<span class="_ _f"> </span>indirect<span class="_ _11"> </span>con<span class="_ _1"></span>trol-ﬂo<span class="_ _8"></span>w<span class="_ _11"> </span>instruction<span class="_ _11"> </span>is<span class="_ _f"> </span>a<span class="_ _11"> </span>con<span class="_ _1"></span>trol-ﬂo<span class="_ _8"></span>w<span class="_ _11"> </span>instruction<span class="_ _11"> </span>that</div><div class="t m0 x18 h7 yed4 ff7 fs4 fc0 sc0 ls0 ws0">has<span class="_ _1b"> </span>the<span class="_ _1b"> </span>target<span class="_ _1b"> </span>address<span class="_ _1b"> </span>sp<span class="_ _4"></span>eciﬁed<span class="_ _1b"> </span>indirectly<span class="_ _2c"></span>,<span class="_ _10"> </span>either<span class="_ _1b"> </span>through<span class="_ _1b"> </span>memory<span class="_ _1b"> </span>or</div><div class="t m0 x18 h7 yed5 ff7 fs4 fc0 sc0 ls0 ws0">through<span class="_ _2"> </span>a<span class="_ _d"> </span>register<span class="ff3">.<span class="_ _c"> </span>F<span class="_ _2c"></span>or<span class="_ _2"> </span>example,<span class="_ _5"> </span>the<span class="_ _5"> </span><span class="ff5">jr<span class="_ _e"> </span>rs1<span class="_ _5"> </span></span>is<span class="_ _5"> </span>an<span class="_ _5"> </span>indirect<span class="_ _5"> </span>control-ﬂo<span class="_ _8"></span>w<span class="_ _5"> </span>instruction</span></div><div class="t m0 x18 h7 yed6 ff3 fs4 fc0 sc0 ls0 ws0">that jumps to an address that<span class="_ _5"> </span>is deﬁned indirectly by the con<span class="_ _8"></span>tents of the register <span class="ff5">rs1</span>.</div><div class="t m0 x18 h7 yed7 ff3 fs4 fc0 sc0 ls0 ws0">Consequen<span class="_ _1"></span>tly<span class="_ _7"></span>, the target<span class="_ _5"> </span>address of this indirect<span class="_ _5"> </span>control-ﬂo<span class="_ _8"></span>w instruction can b<span class="_ _4"></span>e easily</div><div class="t m0 x18 h7 yed8 ff3 fs4 fc0 sc0 ls0 ws0">c<span class="_ _1"></span>hanged<span class="_ _2"> </span>b<span class="_ _1"></span>y<span class="_ _2"> </span>c<span class="_ _1"></span>hanging<span class="_ _2"> </span>the<span class="_ _2"> </span>con<span class="_ _1"></span>ten<span class="_ _1"></span>t<span class="_ _2"> </span>of<span class="_ _2"> </span><span class="ff5">rs1</span>.</div><div class="t m0 xd h7 yed9 ff7 fs4 fc0 sc0 ls0 ws0">NOTE:<span class="_ _1a"> </span><span class="ff3">Indirect<span class="_ _3"> </span>con<span class="_ _1"></span>trol-ﬂo<span class="_ _1"></span>w<span class="_ _3"> </span>instructions<span class="_ _c"> </span>are<span class="_ _c"> </span>often<span class="_ _c"> </span>referred<span class="_ _3"> </span>to<span class="_ _c"> </span>as<span class="_ _c"> </span>indirect</span></div><div class="t m0 xd h7 yeda ff3 fs4 fc0 sc0 ls0 ws0">jump<span class="_ _3"> </span>instructions.<span class="_ _22"> </span>As<span class="_ _c"> </span>we<span class="_ _3"> </span>will<span class="_ _3"> </span>see<span class="_ _c"> </span>in<span class="_ _c"> </span>Section<span class="_ _3"> </span>7.3,<span class="_ _f"> </span>these<span class="_ _c"> </span>instructions<span class="_ _c"> </span>can<span class="_ _3"> </span>b<span class="_ _4"></span>e</div><div class="t m0 xd h7 yedb ff3 fs4 fc0 sc0 ls0 ws0">used<span class="_ _2"> </span>to<span class="_ _2"> </span>return<span class="_ _2"> </span>from<span class="_ _2"> </span>functions.</div><div class="t m0 x18 h7 yedc ff7 fs4 fc0 sc0 ls0 ws0">Enco<span class="_ _4"></span>ding<span class="_ _d"> </span>direct<span class="_ _a"> </span>target<span class="_ _d"> </span>addresses<span class="_ _a"> </span>in<span class="_ _a"> </span>RISC-V<span class="_ _a"> </span>con<span class="_ _8"></span>trol-ﬂow<span class="_ _d"> </span>instructions</div><div class="t m0 x18 h7 yedd ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _2"> </span>R<span class="_ _2c"></span>V32I<span class="_ _b"> </span>enco<span class="_ _4"></span>des<span class="_ _2"> </span>memory<span class="_ _d"> </span>addresses<span class="_ _2"> </span>as<span class="_ _d"> </span>32-bit<span class="_ _d"> </span>unsigned<span class="_ _2"> </span>v<span class="_ _8"></span>alues,<span class="_ _d"> </span>hence,<span class="_ _d"> </span>the<span class="_ _2"> </span><span class="ff7">target</span></div><div class="t m0 x18 h7 yede ff7 fs4 fc0 sc0 ls0 ws0">addresses are naturally 32-bit addresses<span class="ff3">.<span class="_ _c"> </span>R<span class="_ _2c"></span>V32I instructions are all enco<span class="_ _4"></span>ded us-</span></div><div class="t m0 x18 h7 yedf ff3 fs4 fc0 sc0 ls0 ws0">ing only 32-bits, hence, it would not<span class="_ _13"> </span>b<span class="_ _4"></span>e possible to enco<span class="_ _4"></span>de a<span class="_ _13"> </span>32-bit target address plus</div><div class="t m0 x4b h1e y21b ff12 fse fc0 sc0 ls0 ws0">14</div><div class="t m0 xd h1f y21c ff13 fsf fc0 sc0 ls0 ws0">The<span class="_ _38"> </span>pseudo-instruction<span class="_ _38"> </span><span class="ff28">bnez<span class="_ _3"> </span>a0,<span class="_ _3"> </span>LOOP<span class="_ _38"> </span></span>could<span class="_ _38"> </span>also<span class="_ _38"> </span>b<span class="_ _4"></span>e<span class="_ _13"> </span>used<span class="_ _38"> </span>in<span class="_ _38"> </span>this<span class="_ _5"> </span>example,<span class="_ _38"> </span>since<span class="_ _38"> </span>it<span class="_ _38"> </span>is<span class="_ _38"> </span>equiv<span class="_ _8"></span>alent</div><div class="t m0 x18 h1f y61 ff13 fsf fc0 sc0 ls0 ws0">to<span class="_ _38"> </span>the<span class="_ _38"> </span><span class="ff28">bne<span class="_ _3"> </span>a0,<span class="_ _3"> </span>zero,<span class="_ _c"> </span>LOOP<span class="_ _38"> </span></span>instruction.</div><div class="t m0 x32 h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _3"> </span>August<span class="_ _2"> </span>21,<span class="_ _d"> </span>2021)<span class="_ _6f"> </span>71</span></div><a class="l" href="#pf55" data-dest-detail='[85,"XYZ",105.952,89.795,null]'><div class="d m1" style="border-style:none;position:absolute;left:155.890000px;bottom:685.843000px;width:10.434000px;height:12.593000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pf5b" data-dest-detail='[91,"XYZ",90.709,771.024,null]'><div class="d m1" style="border-style:none;position:absolute;left:143.198000px;bottom:508.441000px;width:6.974000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pf93" data-dest-detail='[147,"XYZ",90.709,546.583,null]'><div class="d m1" style="border-style:none;position:absolute;left:281.861000px;bottom:462.212000px;width:6.974000px;height:8.413000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pf61" data-dest-detail='[97,"XYZ",90.709,122.575,null]'><div class="d m1" style="border-style:none;position:absolute;left:310.843000px;bottom:193.747000px;width:14.722000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfb" data-dest-detail='[11,"XYZ",90.709,113.65,null]'><div class="d m1" style="border-style:none;position:absolute;left:141.100000px;bottom:120.757000px;width:1.993000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:139.954000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

<div id="pf2d" class="pf w0 h0" data-page-no="2d"><div class="pc pc2d w0 h0"><img class="bi x18 y86f w2 h6b" alt="" src="bg2d.png"/><div class="t m0 x18 h7 y15a ff3 fs4 fc0 sc0 ls0 ws0">3.2.<span class="_ _22"> </span>LABELS,<span class="_ _2"> </span>SYMBOLS,<span class="_ _2"> </span>REFERENCES,<span class="_ _2"> </span>AND<span class="_ _2"> </span>RELOCA<span class="_ _7"></span>TION</div><div class="t m0 x18 h8 y38 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _11"> </span>riscv64-unknown-elf-objdump<span class="_ _e"> </span>-r<span class="_ _e"> </span>main.o</div><div class="t m0 x18 h8 yee ff5 fs4 fc0 sc0 ls0 ws0">main.o:<span class="_ _89"> </span>file<span class="_ _11"> </span>format<span class="_ _e"> </span>elf32-littleriscv</div><div class="t m0 x18 h8 y29d ff5 fs4 fc0 sc0 ls0 ws0">RELOCATION<span class="_ _11"> </span>RECORDS<span class="_ _e"> </span>FOR<span class="_ _e"> </span>[.text]:</div><div class="t m0 x18 h8 y49d ff5 fs4 fc0 sc0 ls0 ws0">OFFSET<span class="_ _40"> </span>TYPE<span class="_ _50"> </span>VALUE</div><div class="t m0 x18 h8 y49e ff5 fs4 fc0 sc0 ls0 ws0">00000008<span class="_ _11"> </span>R_RISCV_JAL<span class="_ _68"> </span>exit</div><div class="t m0 xd h7 y870 ff3 fs4 fc0 sc0 ls0 ws0">When<span class="_ _5"> </span>linking<span class="_ _2"> </span>the<span class="_ _2"> </span>ob<span class="_ _4"></span>ject<span class="_ _2"> </span>ﬁles,<span class="_ _2"> </span>the<span class="_ _2"> </span>linker<span class="_ _5"> </span>m<span class="_ _1"></span>ust<span class="_ _2"> </span>resolv<span class="_ _8"></span>e<span class="_ _2"> </span>the<span class="_ _2"> </span>undeﬁned<span class="_ _2"> </span>symbols,<span class="_ _2"> </span><span class="ff8">i.e.</span>,</div><div class="t m0 x18 h7 y871 ff3 fs4 fc0 sc0 ls0 ws0">it<span class="_ _3"> </span>must<span class="_ _3"> </span>ﬁnd<span class="_ _3"> </span>the<span class="_ _3"> </span>symbol<span class="_ _c"> </span>deﬁnition<span class="_ _3"> </span>and<span class="_ _3"> </span>adjust<span class="_ _c"> </span>the<span class="_ _3"> </span>symbol<span class="_ _c"> </span>table<span class="_ _3"> </span>and<span class="_ _3"> </span>the<span class="_ _c"> </span>co<span class="_ _4"></span>de<span class="_ _a"> </span>with</div><div class="t m0 x18 h7 y872 ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span>symbol<span class="_ _d"> </span>v<span class="_ _8"></span>alue.<span class="_ _e"> </span>In<span class="_ _d"> </span>the<span class="_ _2"> </span>previous<span class="_ _d"> </span>example,<span class="_ _d"> </span>the<span class="_ _d"> </span>linker<span class="_ _2"> </span>will<span class="_ _d"> </span>lo<span class="_ _4"></span>ok<span class="_ _2"> </span>for<span class="_ _d"> </span>the<span class="_ _d"> </span><span class="ff5">exit<span class="_ _d"> </span></span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ol</div><div class="t m0 x18 h7 y873 ff3 fs4 fc0 sc0 ls0 ws0">so<span class="_ _a"> </span>that<span class="_ _a"> </span>it<span class="_ _3"> </span>can<span class="_ _a"> </span>adjust<span class="_ _3"> </span>the<span class="_ _a"> </span><span class="ff5">jal<span class="_ _a"> </span></span>instruction<span class="_ _3"> </span>to<span class="_ _a"> </span>refer<span class="_ _a"> </span>to<span class="_ _3"> </span>the<span class="_ _a"> </span>correct<span class="_ _3"> </span>address.<span class="_ _2d"> </span>In<span class="_ _a"> </span>case<span class="_ _3"> </span>it</div><div class="t m0 x18 h7 y874 ff3 fs4 fc0 sc0 ls0 ws0">cannot<span class="_ _3"> </span>ﬁnd<span class="_ _3"> </span>the<span class="_ _3"> </span>deﬁnition<span class="_ _3"> </span>of<span class="_ _3"> </span>the<span class="_ _3"> </span>sym<span class="_ _8"></span>b<span class="_ _4"></span>ol,<span class="_ _3"> </span>it<span class="_ _3"> </span>stops<span class="_ _3"> </span>the<span class="_ _3"> </span>linking<span class="_ _3"> </span>pro<span class="_ _4"></span>cess<span class="_ _3"> </span>and<span class="_ _3"> </span>emits<span class="_ _3"> </span>an</div><div class="t m0 x18 h7 y875 ff3 fs4 fc0 sc0 ls0 ws0">error<span class="_ _d"> </span>message.<span class="_ _e"> </span>The<span class="_ _a"> </span>following<span class="_ _2"> </span>example<span class="_ _d"> </span>illustrates<span class="_ _d"> </span>this<span class="_ _a"> </span>situation.<span class="_ _e"> </span>In<span class="_ _a"> </span>this<span class="_ _d"> </span>case,<span class="_ _d"> </span>we<span class="_ _d"> </span>are</div><div class="t m0 x18 h7 y876 ff3 fs4 fc0 sc0 ls0 ws0">trying<span class="_ _a"> </span>to<span class="_ _3"> </span>link<span class="_ _a"> </span>the<span class="_ _3"> </span><span class="ff5">main.o<span class="_ _a"> </span></span>ﬁle<span class="_ _3"> </span>without<span class="_ _a"> </span>providing<span class="_ _a"> </span>another<span class="_ _a"> </span>ob<span class="_ _35"></span>ject<span class="_ _a"> </span>ﬁle<span class="_ _a"> </span>that<span class="_ _3"> </span>con<span class="_ _1"></span>tains<span class="_ _a"> </span>a</div><div class="t m0 x18 h7 y877 ff3 fs4 fc0 sc0 ls0 ws0">deﬁnition of the <span class="ff5">exit<span class="_ _13"> </span></span>label.<span class="_ _c"> </span>Notice that the<span class="_ _13"> </span>link<span class="_ _1"></span>er emits the error<span class="_ _12"> </span>mes<span class="_ _4"></span>sage<span class="_ _13"> </span><span class="ff5">undefined</span></div><div class="t m0 x18 h7 y878 ff5 fs4 fc0 sc0 ls0 ws0">reference<span class="_ _11"> </span>to<span class="_ _e"> </span>‘exit’<span class="ff3">.</span></div><div class="t m0 x18 h8 y879 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _11"> </span>riscv64-unknown-elf-ld<span class="_ _e"> </span>-m<span class="_ _e"> </span>elf32lriscv<span class="_ _e"> </span>main.o<span class="_ _11"> </span>-o<span class="_ _e"> </span>main.x</div><div class="t m0 x18 h8 y87a ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _11"> </span>warning:<span class="_ _e"> </span>cannot<span class="_ _e"> </span>find<span class="_ _e"> </span>entry<span class="_ _11"> </span>symbol<span class="_ _e"> </span>start;<span class="_ _e"> </span>...</div><div class="t m0 x18 h8 y87b ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _11"> </span>main.o:<span class="_ _e"> </span>in<span class="_ _e"> </span>function<span class="_ _e"> </span>‘start’:</div><div class="t m0 x18 h8 y87c ff5 fs4 fc0 sc0 ls0 ws0">(.text+0x8):<span class="_ _11"> </span>undefined<span class="_ _e"> </span>reference<span class="_ _e"> </span>to<span class="_ _e"> </span>‘exit’</div><div class="t m0 x18 ha y87d ff6 fs6 fc0 sc0 ls0 ws0">3.2.4<span class="_ _17"> </span>Global<span class="_ _c"> </span>vs<span class="_ _c"> </span>lo<span class="_ _4"></span>cal<span class="_ _3"> </span>symbols</div><div class="t m0 x18 h7 y87e ff3 fs4 fc0 sc0 ls0 ws0">Sym<span class="_ _1"></span>b<span class="_ _4"></span>ols<span class="_ _12"> </span>are classiﬁed<span class="_ _12"> </span>as lo<span class="_ _4"></span>cal<span class="_ _12"> </span>or global<span class="_ _12"> </span>symbols.<span class="_ _3"> </span>Lo<span class="_ _4"></span>cal sym<span class="_ _8"></span>b<span class="_ _4"></span>ols<span class="_ _12"> </span>are only<span class="_ _13"> </span>visible<span class="_ _13"> </span>on<span class="_ _13"> </span>the</div><div class="t m0 x18 h7 y87f ff3 fs4 fc0 sc0 ls0 ws0">same<span class="_ _d"> </span>ﬁle,<span class="_ _d"> </span><span class="ff8">i.e.</span>,<span class="_ _d"> </span>the<span class="_ _a"> </span>link<span class="_ _1"></span>er<span class="_ _d"> </span>do<span class="_ _4"></span>es<span class="_ _2"> </span>not<span class="_ _d"> </span>use<span class="_ _d"> </span>them<span class="_ _d"> </span>to<span class="_ _d"> </span>resolve<span class="_ _d"> </span>undeﬁned<span class="_ _d"> </span>references<span class="_ _d"> </span>on<span class="_ _d"> </span>other</div><div class="t m0 x18 h7 y880 ff3 fs4 fc0 sc0 ls0 ws0">ﬁles.<span class="_ _f"> </span>Global<span class="_ _2"> </span>symbols,<span class="_ _d"> </span>on<span class="_ _2"> </span>the<span class="_ _2"> </span>other<span class="_ _d"> </span>hand,<span class="_ _2"> </span>are<span class="_ _d"> </span>used<span class="_ _2"> </span>by<span class="_ _2"> </span>the<span class="_ _2"> </span>linker<span class="_ _2"> </span>to<span class="_ _2"> </span>resolve<span class="_ _5"> </span>undeﬁned</div><div class="t m0 x18 h7 y881 ff3 fs4 fc0 sc0 ls0 ws0">reference<span class="_ _2"> </span>on<span class="_ _2"> </span>other<span class="_ _2"> </span>ﬁles.</div><div class="t m0 xd h7 y882 ff3 fs4 fc0 sc0 ls0 ws0">By<span class="_ _2"> </span>default,<span class="_ _d"> </span>the<span class="_ _2"> </span>assembler<span class="_ _2"> </span>registers<span class="_ _2"> </span>lab<span class="_ _4"></span>els<span class="_ _2"> </span>as<span class="_ _2"> </span>lo<span class="_ _4"></span>cal<span class="_ _2"> </span>symbols.<span class="_ _11"> </span>The<span class="_ _2"> </span><span class="ff5">.globl<span class="_ _d"> </span></span>directiv<span class="_ _1"></span>e</div><div class="t m0 x18 h7 y883 ff3 fs4 fc0 sc0 ls0 ws0">is<span class="_ _a"> </span>an<span class="_ _3"> </span>assembly<span class="_ _d"> </span>directive<span class="_ _a"> </span>that<span class="_ _3"> </span>instructs<span class="_ _a"> </span>the<span class="_ _3"> </span>assem<span class="_ _1"></span>bler<span class="_ _a"> </span>to<span class="_ _3"> </span>register<span class="_ _a"> </span>a<span class="_ _3"> </span>lab<span class="_ _4"></span>el<span class="_ _a"> </span>as<span class="_ _3"> </span>a<span class="_ _a"> </span>global</div><div class="t m0 x18 h7 y884 ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _4"></span>ol.<span class="_ _22"> </span>The<span class="_ _c"> </span>following<span class="_ _c"> </span>example<span class="_ _c"> </span>sho<span class="_ _1"></span>ws<span class="_ _c"> </span>an<span class="_ _c"> </span>assembly<span class="_ _3"> </span>program<span class="_ _c"> </span>in<span class="_ _f"> </span>whic<span class="_ _1"></span>h<span class="_ _c"> </span>the<span class="_ _c"> </span><span class="ff5">.globl</span></div><div class="t m0 x18 h7 y885 ff3 fs4 fc0 sc0 ls0 ws0">directiv<span class="_ _1"></span>e is<span class="_ _13"> </span>used to<span class="_ _13"> </span>instruct the<span class="_ _13"> </span>assem<span class="_ _1"></span>bler to<span class="_ _13"> </span>register the<span class="_ _13"> </span><span class="ff5">exit<span class="_ _13"> </span></span>lab<span class="_ _4"></span>el as<span class="_ _12"> </span>a global sym<span class="_ _8"></span>b<span class="_ _4"></span>ol</div><div class="t m0 x18 h7 y886 ff3 fs4 fc0 sc0 ls0 ws0">on<span class="_ _2"> </span>the<span class="_ _2"> </span>sym<span class="_ _1"></span>b<span class="_ _4"></span>ol<span class="_ _5"> </span>table.</div><div class="t m0 x111 h8 y887 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>Contents<span class="_ _11"> </span>of<span class="_ _e"> </span>the<span class="_ _e"> </span>exit.s<span class="_ _e"> </span>file</span></div><div class="t m0 x111 h8 y888 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _1f"> </span><span class="ff5 fs4">.globl<span class="_ _e"> </span>exit</span></div><div class="t m0 x111 h8 y889 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _1f"> </span><span class="ff5 fs4">exit:</span></div><div class="t m0 x111 h8 y88a ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _36"> </span><span class="ff5 fs4">li<span class="_ _11"> </span>a0,<span class="_ _e"> </span>0</span></div><div class="t m0 x111 h8 y88b ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _36"> </span><span class="ff5 fs4">li<span class="_ _11"> </span>a7,<span class="_ _e"> </span>93</span></div><div class="t m0 x111 h8 y88c ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _36"> </span><span class="ff5 fs4">ecall</span></div><div class="t m0 xd h7 y88d ff3 fs4 fc0 sc0 ls0 ws0">Assuming<span class="_ _13"> </span>the<span class="_ _13"> </span>co<span class="_ _4"></span>de<span class="_ _12"> </span>that in<span class="_ _8"></span>vok<span class="_ _8"></span>es the<span class="_ _12"> </span><span class="ff5">exit<span class="_ _13"> </span></span>function is<span class="_ _12"> </span>lo<span class="_ _4"></span>cated<span class="_ _13"> </span>on<span class="_ _13"> </span>the <span class="ff5">main.s<span class="_ _12"> </span></span>ﬁle and</div><div class="t m0 x18 h7 y88e ff3 fs4 fc0 sc0 ls0 ws0">the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _2"> </span></span>function<span class="_ _d"> </span>is<span class="_ _2"> </span>lo<span class="_ _4"></span>cated<span class="_ _5"> </span>on<span class="_ _d"> </span>the<span class="_ _2"> </span><span class="ff5">exit.s<span class="_ _2"> </span></span>ﬁle,<span class="_ _d"> </span>the<span class="_ _2"> </span>following<span class="_ _5"> </span>sequence<span class="_ _d"> </span>of<span class="_ _2"> </span>commands</div><div class="t m0 x18 h7 y88f ff3 fs4 fc0 sc0 ls0 ws0">sho<span class="_ _1"></span>ws<span class="_ _2"> </span>ho<span class="_ _1"></span>w<span class="_ _2"> </span>to<span class="_ _2"> </span>assem<span class="_ _1"></span>ble<span class="_ _2"> </span>b<span class="_ _4"></span>oth<span class="_ _5"> </span>ﬁles<span class="_ _2"> </span>and<span class="_ _2"> </span>link<span class="_ _2"> </span>them<span class="_ _2"> </span>together.</div><div class="t m0 x18 h8 y890 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _11"> </span>riscv64-unknown-elf-as<span class="_ _e"> </span>-march=rv32im<span class="_ _e"> </span>main.s<span class="_ _e"> </span>-o<span class="_ _11"> </span>main.o</div><div class="t m0 x18 h8 y891 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _11"> </span>riscv64-unknown-elf-as<span class="_ _e"> </span>-march=rv32im<span class="_ _e"> </span>exit.s<span class="_ _e"> </span>-o<span class="_ _11"> </span>exit.o</div><div class="t m0 x18 h8 y892 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _11"> </span>riscv64-unknown-elf-ld<span class="_ _e"> </span>-m<span class="_ _e"> </span>elf32lriscv<span class="_ _e"> </span>main.o<span class="_ _11"> </span>exit.o<span class="_ _e"> </span>-o<span class="_ _e"> </span>main.x</div><div class="t m0 x18 h8 y893 ff5 fs4 fc0 sc0 ls0 ws0">riscv64-unknown-elf-ld:<span class="_ _11"> </span>warning:<span class="_ _e"> </span>cannot<span class="_ _e"> </span>find<span class="_ _e"> </span>entry<span class="_ _11"> </span>symbol<span class="_ _e"> </span>start;<span class="_ _e"> </span>...</div><div class="t m0 xd h7 yea ff3 fs4 fc0 sc0 ls0 ws0">Notice<span class="_ _f"> </span>that<span class="_ _11"> </span>the<span class="_ _f"> </span>linker<span class="_ _c"> </span>is<span class="_ _11"> </span>not<span class="_ _f"> </span>pro<span class="_ _4"></span>ducing<span class="_ _f"> </span>the<span class="_ _11"> </span><span class="ff5">undefined<span class="_ _11"> </span>reference<span class="_ _e"> </span>to<span class="_ _e"> </span>‘exit’</span></div><div class="t m0 x18 h7 yeb ff3 fs4 fc0 sc0 ls0 ws0">an<span class="_ _1"></span>ymore.<span class="_ _c"> </span>It<span class="_ _d"> </span>is<span class="_ _2"> </span>worth<span class="_ _5"> </span>noting<span class="_ _d"> </span>that,<span class="_ _2"> </span>in<span class="_ _2"> </span>case<span class="_ _d"> </span>the<span class="_ _2"> </span><span class="ff5">exit<span class="_ _2"> </span></span>lab<span class="_ _4"></span>el<span class="_ _2"> </span>is<span class="_ _2"> </span>not<span class="_ _2"> </span>registered<span class="_ _d"> </span>as<span class="_ _2"> </span>a<span class="_ _2"> </span>global</div><div class="t m0 x18 h7 yec ff3 fs4 fc0 sc0 ls0 ws0">lab<span class="_ _4"></span>el, the link<span class="_ _8"></span>er will not use<span class="_ _13"> </span>it to resolv<span class="_ _8"></span>e the undeﬁned sym<span class="_ _8"></span>b<span class="_ _4"></span>ol and the<span class="_ _13"> </span>linking process</div><div class="t m0 x18 h7 y61 ff3 fs4 fc0 sc0 ls0 ws0">will<span class="_ _2"> </span>fail.</div><div class="t m0 x3f h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _c"> </span>Ma<span class="_ _8"></span>y<span class="_ _2"> </span>9,<span class="_ _2"> </span>2022)<span class="_ _75"> </span>31</span></div><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:148.560000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

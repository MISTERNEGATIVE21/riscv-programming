<div id="pf90" class="pf w0 h0" data-page-no="90"><div class="pc pc90 w0 h0"><img class="bi x13 y17bc w2 he7" alt="" src="bg90.png"/><div class="t m0 x13 h7 y15a ff3 fs4 fc0 sc0 ls0 ws0">CHAPTER<span class="_ _2"> </span>11.<span class="_ _22"> </span>SOFTW<span class="_ _2c"></span>ARE<span class="_ _2"> </span>INTERRUPTS<span class="_ _5"> </span>AND<span class="_ _2"> </span>EXCEPTIONS</div><div class="t m0 x12e h7 y2da ff5 fs4 fc0 sc0 ls0 ws0">mcause<span class="_ _2"> </span><span class="ff3">ﬁelds</span></div><div class="t m0 x6f h7 y2d9 ff3 fs4 fc0 sc0 ls0 ws0">Cause</div><div class="t m0 x47 h7 y2db ff3 fs4 fc0 sc0 ls0 ws0">INTERR<span class="_ _1"></span>UPT<span class="_ _6c"> </span>EX<span class="_ _8"></span>CCODE</div><div class="t m0 xbd h7 y2dc ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>0<span class="_ _e3"> </span>User<span class="_ _2"> </span>soft<span class="_ _1"></span>w<span class="_ _1"></span>are<span class="_ _2"> </span>in<span class="_ _1"></span>terrupt</div><div class="t m0 xbd h7 y2de ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>1<span class="_ _3d"> </span>Supervisor<span class="_ _2"> </span>softw<span class="_ _8"></span>are<span class="_ _2"> </span>interrupt</div><div class="t m0 xbd h7 y2e0 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>2<span class="_ _63"> </span>Reserv<span class="_ _1"></span>ed<span class="_ _2"> </span>for<span class="_ _2"> </span>future<span class="_ _2"> </span>standard<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y2e2 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>3<span class="_ _85"> </span>Mac<span class="_ _8"></span>hine<span class="_ _2"> </span>softw<span class="_ _8"></span>are<span class="_ _2"> </span>interrupt</div><div class="t m0 xbd h7 y17bd ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>4<span class="_ _e4"> </span>User<span class="_ _2"> </span>timer<span class="_ _2"> </span>in<span class="_ _1"></span>terrupt</div><div class="t m0 xbd h7 y17be ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>5<span class="_ _6a"> </span>Sup<span class="_ _4"></span>ervisor<span class="_ _5"> </span>timer<span class="_ _2"> </span>interrupt</div><div class="t m0 xbd h7 y17bf ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>6<span class="_ _63"> </span>Reserv<span class="_ _1"></span>ed<span class="_ _2"> </span>for<span class="_ _2"> </span>future<span class="_ _2"> </span>standard<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17c0 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>7<span class="_ _b5"> </span>Machine<span class="_ _2"> </span>timer<span class="_ _2"> </span>in<span class="_ _8"></span>terrupt</div><div class="t m0 xbd h7 y17c1 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>8<span class="_ _4c"> </span>User<span class="_ _5"> </span>external<span class="_ _2"> </span>interrupt</div><div class="t m0 xbd h7 y17c2 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _93"> </span>9<span class="_ _44"> </span>Sup<span class="_ _4"></span>ervisor<span class="_ _2"> </span>external<span class="_ _2"> </span>in<span class="_ _8"></span>terrupt</div><div class="t m0 xbd h7 y17c3 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _ab"> </span>10<span class="_ _b3"> </span>Reserv<span class="_ _8"></span>ed<span class="_ _2"> </span>for<span class="_ _2"> </span>future<span class="_ _2"> </span>standard<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17c4 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _ab"> </span>11<span class="_ _60"> </span>Machine<span class="_ _5"> </span>external<span class="_ _2"> </span>interrupt</div><div class="t m0 xbd h7 y17c5 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _39"> </span>12-15<span class="_ _e5"> </span>Reserv<span class="_ _1"></span>ed<span class="_ _2"> </span>for<span class="_ _2"> </span>future<span class="_ _2"> </span>standard<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17c6 ff3 fs4 fc0 sc0 ls0 ws0">1<span class="_ _4a"> </span><span class="ff4">≥<span class="_ _2"> </span></span>16<span class="_ _e6"> </span>Reserv<span class="_ _1"></span>ed<span class="_ _2"> </span>for<span class="_ _2"> </span>platform<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17c7 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>0<span class="_ _e7"> </span>Instruction<span class="_ _2"> </span>address<span class="_ _2"> </span>misaligned</div><div class="t m0 xbd h7 y17c8 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>1<span class="_ _e3"> </span>Instruction<span class="_ _2"> </span>access<span class="_ _2"> </span>fault</div><div class="t m0 xbd h7 y17c9 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>2<span class="_ _94"> </span>Illegal<span class="_ _2"> </span>instruction</div><div class="t m0 xbd h7 y11f ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>3<span class="_ _e8"> </span>Breakp<span class="_ _4"></span>oin<span class="_ _8"></span>t</div><div class="t m0 xbd h7 y17ca ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>4<span class="_ _e9"> </span>Load<span class="_ _2"> </span>address<span class="_ _2"> </span>misaligned</div><div class="t m0 xbd h7 y17cb ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>5<span class="_ _ea"> </span>Load<span class="_ _2"> </span>access<span class="_ _2"> </span>fault</div><div class="t m0 xbd h7 y17cc ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>6<span class="_ _eb"> </span>Store/AMO<span class="_ _2"> </span>address<span class="_ _2"> </span>misaligned</div><div class="t m0 xbd h7 y17cd ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>7<span class="_ _91"> </span>Store/AMO<span class="_ _5"> </span>access<span class="_ _2"> </span>fault</div><div class="t m0 xbd h7 y2d ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>8<span class="_ _4d"> </span>En<span class="_ _8"></span>vironment<span class="_ _5"> </span>call<span class="_ _2"> </span>from<span class="_ _2"> </span>U-mo<span class="_ _4"></span>de</div><div class="t m0 xbd h7 y17ce ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _93"> </span>9<span class="_ _9f"> </span>Environmen<span class="_ _8"></span>t<span class="_ _2"> </span>call<span class="_ _2"> </span>from<span class="_ _2"> </span>S-mo<span class="_ _4"></span>de</div><div class="t m0 xbd h7 y17cf ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _ab"> </span>10<span class="_ _ec"> </span>Reserv<span class="_ _1"></span>ed</div><div class="t m0 xbd h7 y17d0 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _ab"> </span>11<span class="_ _cd"> </span>Environmen<span class="_ _8"></span>t<span class="_ _2"> </span>call<span class="_ _2"> </span>from<span class="_ _2"> </span>M-mo<span class="_ _4"></span>de</div><div class="t m0 xbd h7 y17d1 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _ab"> </span>12<span class="_ _4c"> </span>Instruction<span class="_ _2"> </span>page<span class="_ _2"> </span>fault</div><div class="t m0 xbd h7 y17d2 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _ab"> </span>13<span class="_ _ed"> </span>Load<span class="_ _2"> </span>page<span class="_ _2"> </span>fault</div><div class="t m0 xbd h7 y17d3 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _ab"> </span>14<span class="_ _b3"> </span>Reserv<span class="_ _8"></span>ed<span class="_ _2"> </span>for<span class="_ _2"> </span>future<span class="_ _2"> </span>standard<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17d4 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _ab"> </span>15<span class="_ _37"> </span>Store/AMO<span class="_ _2"> </span>page<span class="_ _2"> </span>fault</div><div class="t m0 xbd h7 y17d5 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _39"> </span>16-23<span class="_ _e5"> </span>Reserv<span class="_ _1"></span>ed<span class="_ _2"> </span>for<span class="_ _2"> </span>future<span class="_ _2"> </span>standard<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17d6 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _39"> </span>24-31<span class="_ _46"> </span>Reserved<span class="_ _5"> </span>for<span class="_ _2"> </span>custom<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17d7 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _39"> </span>32-47<span class="_ _e5"> </span>Reserv<span class="_ _1"></span>ed<span class="_ _2"> </span>for<span class="_ _2"> </span>future<span class="_ _2"> </span>standard<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17d8 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _39"> </span>48-63<span class="_ _46"> </span>Reserved<span class="_ _5"> </span>for<span class="_ _2"> </span>custom<span class="_ _2"> </span>use</div><div class="t m0 xbd h7 y17d9 ff3 fs4 fc0 sc0 ls0 ws0">0<span class="_ _4c"> </span><span class="ff4">≥</span>64<span class="_ _7a"> </span>Reserv<span class="_ _8"></span>ed<span class="_ _d"> </span>for<span class="_ _2"> </span>future<span class="_ _2"> </span>standard<span class="_ _2"> </span>use</div><div class="t m0 x13 h7 y17da ff3 fs4 fc0 sc0 ls0 ws0">T<span class="_ _7"></span>able 11.1:<span class="_ _c"> </span>Sources of<span class="_ _5"> </span>interrupts and<span class="_ _5"> </span>exceptions<span class="_ _5"> </span>and<span class="_ _5"> </span>their<span class="_ _5"> </span>co<span class="_ _4"></span>des on<span class="_ _5"> </span>the<span class="_ _5"> </span><span class="ff5">mcause<span class="_ _5"> </span></span>CSR.</div><div class="t m0 x13 hd y17db ff6 fs3 fc0 sc0 ls0 ws0">11.5<span class="_ _36"> </span>Protecting<span class="_ _e"> </span>RISC-V<span class="_ _e"> </span>systems</div><div class="t m0 x13 h7 y17dc ff3 fs4 fc0 sc0 ls0 ws0">The following sections<span class="_ _5"> </span>discuss<span class="_ _5"> </span>how to use<span class="_ _5"> </span>the<span class="_ _5"> </span>RISC-V<span class="_ _5"> </span>privilege mo<span class="_ _4"></span>des and<span class="_ _5"> </span>the<span class="_ _5"> </span>excep-</div><div class="t m0 x13 h7 y17dd ff3 fs4 fc0 sc0 ls0 ws0">tion<span class="_ _d"> </span>and<span class="_ _a"> </span>softw<span class="_ _8"></span>are<span class="_ _a"> </span>interrupt<span class="_ _d"> </span>handling<span class="_ _a"> </span>mec<span class="_ _1"></span>hanisms<span class="_ _d"> </span>to<span class="_ _a"> </span>protect<span class="_ _a"> </span>the<span class="_ _a"> </span>system<span class="_ _d"> </span>from<span class="_ _a"> </span>faulty</div><div class="t m0 x13 h7 y17de ff3 fs4 fc0 sc0 ls0 ws0">or<span class="_ _2"> </span>malicious<span class="_ _2"> </span>user<span class="_ _2"> </span>soft<span class="_ _1"></span>w<span class="_ _1"></span>are.</div><div class="t m0 x13 ha y17df ff6 fs6 fc0 sc0 ls0 ws0">11.5.1<span class="_ _17"> </span>Changing<span class="_ _c"> </span>the<span class="_ _c"> </span>privilege<span class="_ _c"> </span>mo<span class="_ _4"></span>de</div><div class="t m0 x13 h7 ya33 ff3 fs4 fc0 sc0 ls0 ws0">RISC-V<span class="_ _3"> </span>CPUs<span class="_ _3"> </span>store<span class="_ _c"> </span>the<span class="_ _3"> </span>current<span class="_ _a"> </span>privilege<span class="_ _3"> </span>mo<span class="_ _4"></span>de<span class="_ _3"> </span>on<span class="_ _3"> </span>an<span class="_ _c"> </span>in<span class="_ _1"></span>ternal<span class="_ _3"> </span>storage<span class="_ _3"> </span>device<span class="_ _c"> </span>that</div><div class="t m0 x13 h7 y680 ff3 fs4 fc0 sc0 ls0 ws0">is<span class="_ _d"> </span>not<span class="_ _d"> </span>directly<span class="_ _d"> </span>visible<span class="_ _d"> </span>to<span class="_ _d"> </span>softw<span class="_ _8"></span>are.<span class="_ _1f"> </span>In<span class="_ _d"> </span>other<span class="_ _d"> </span>words,<span class="_ _2"> </span>the<span class="_ _d"> </span>softw<span class="_ _8"></span>are<span class="_ _a"> </span>ma<span class="_ _1"></span>y<span class="_ _d"> </span>not<span class="_ _d"> </span>directly<span class="_ _d"> </span>in-</div><div class="t m0 x13 h7 y681 ff3 fs4 fc0 sc0 ls0 ws0">sp<span class="_ _4"></span>ect<span class="_ _a"> </span>or<span class="_ _c"> </span>mo<span class="_ _4"></span>dify<span class="_ _a"> </span>this<span class="_ _c"> </span>storage<span class="_ _3"> </span>device<span class="_ _c"> </span>to<span class="_ _3"> </span>identify<span class="_ _a"> </span>or<span class="_ _c"> </span>manipulate<span class="_ _3"> </span>the<span class="_ _3"> </span>current<span class="_ _3"> </span>privilege</div><div class="t m0 x13 h7 y682 ff3 fs4 fc0 sc0 ls0 ws0">mo<span class="_ _4"></span>de.<span class="_ _1b"> </span>The<span class="_ _a"> </span>only<span class="_ _a"> </span>wa<span class="_ _8"></span>y<span class="_ _3"> </span>to<span class="_ _a"> </span>insp<span class="_ _4"></span>ect<span class="_ _d"> </span>the<span class="_ _a"> </span>current<span class="_ _a"> </span>privilege<span class="_ _a"> </span>mo<span class="_ _4"></span>de<span class="_ _d"> </span>is<span class="_ _3"> </span>b<span class="_ _1"></span>y<span class="_ _a"> </span>generating<span class="_ _a"> </span>a<span class="_ _a"> </span>soft-</div><div class="t m0 x13 h7 y683 ff3 fs4 fc0 sc0 ls0 ws0">w<span class="_ _1"></span>are<span class="_ _d"> </span>interrupt<span class="_ _2"> </span>or<span class="_ _d"> </span>exception,<span class="_ _a"> </span>whic<span class="_ _1"></span>h<span class="_ _d"> </span>copies<span class="_ _d"> </span>the<span class="_ _d"> </span>privilege<span class="_ _d"> </span>mo<span class="_ _4"></span>de<span class="_ _d"> </span>co<span class="_ _4"></span>de<span class="_ _2"> </span>into<span class="_ _2"> </span>the<span class="_ _d"> </span><span class="ff5">mstatus</span></div><div class="t m0 x13 h7 yea ff3 fs4 fc0 sc0 ls0 ws0">Mac<span class="_ _1"></span>hine Previous<span class="_ _5"> </span>Privilege ﬁeld<span class="_ _5"> </span>(<span class="ff5">mstatus</span>.<span class="ff5">MPP</span>). Also,<span class="_ _5"> </span>the<span class="_ _5"> </span>only wa<span class="_ _8"></span>y<span class="_ _5"> </span>to<span class="_ _5"> </span>set the<span class="_ _5"> </span>current</div><div class="t m0 x13 h7 yeb ff3 fs4 fc0 sc0 ls0 ws0">privilege<span class="_ _2"> </span>mo<span class="_ _4"></span>de<span class="_ _2"> </span>is<span class="_ _d"> </span>to<span class="_ _2"> </span>mo<span class="_ _4"></span>dify<span class="_ _2"> </span>the<span class="_ _d"> </span>conten<span class="_ _8"></span>ts<span class="_ _2"> </span>of<span class="_ _d"> </span>the<span class="_ _d"> </span><span class="ff5">mstatus<span class="_ _2"> </span></span>Machine<span class="_ _2"> </span>Previous<span class="_ _2"> </span>Privilege</div><div class="t m0 x13 h7 yec ff3 fs4 fc0 sc0 ls0 ws0">ﬁeld<span class="_ _3"> </span>(<span class="ff5">mstatus</span>.<span class="ff5">MPP</span>)<span class="_ _c"> </span>and<span class="_ _c"> </span>execute<span class="_ _3"> </span>the<span class="_ _c"> </span><span class="ff5">mret<span class="_ _c"> </span></span>instruction,<span class="_ _c"> </span>which<span class="_ _3"> </span>uses<span class="_ _c"> </span>the<span class="_ _3"> </span>v<span class="_ _8"></span>alue<span class="_ _c"> </span>in<span class="_ _c"> </span>the</div><div class="t m0 x13 h7 y61 ff5 fs4 fc0 sc0 ls0 ws0">mstatus<span class="ff3">.</span>MPP<span class="_ _2"> </span><span class="ff3">CSR<span class="_ _2"> </span>ﬁeld<span class="_ _2"> </span>to<span class="_ _2"> </span>set<span class="_ _2"> </span>the<span class="_ _2"> </span>curren<span class="_ _1"></span>t<span class="_ _2"> </span>privilege<span class="_ _2"> </span>mo<span class="_ _4"></span>de.</span></div><div class="t m0 x44 h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _3"> </span>May<span class="_ _2"> </span>9,<span class="_ _2"> </span>2022)<span class="_ _c9"> </span>130</span></div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,532.778,null]'><div class="d m1" style="border-style:none;position:absolute;left:480.740000px;bottom:287.039000px;width:22.056000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",136.063,146.478,null]'><div class="d m1" style="border-style:none;position:absolute;left:370.113000px;bottom:233.697000px;width:69.250000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,552.703,null]'><div class="d m1" style="border-style:none;position:absolute;left:173.795000px;bottom:163.574000px;width:23.440000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",136.063,146.478,null]'><div class="d m1" style="border-style:none;position:absolute;left:282.553000px;bottom:163.574000px;width:66.625000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",136.063,146.478,null]'><div class="d m1" style="border-style:none;position:absolute;left:466.737000px;bottom:139.664000px;width:38.826000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",136.063,146.478,null]'><div class="d m1" style="border-style:none;position:absolute;left:135.067000px;bottom:127.709000px;width:25.515000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",136.063,146.478,null]'><div class="d m1" style="border-style:none;position:absolute;left:332.733000px;bottom:127.709000px;width:66.304000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",136.063,146.478,null]'><div class="d m1" style="border-style:none;position:absolute;left:337.982000px;bottom:115.753000px;width:66.000000px;height:10.849000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",136.063,146.478,null]'><div class="d m1" style="border-style:none;position:absolute;left:135.067000px;bottom:91.843000px;width:65.841000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,532.778,null]'><div class="d m1" style="border-style:none;position:absolute;left:193.458000px;bottom:67.933000px;width:22.057000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfc" data-dest-detail='[12,"XYZ",136.063,146.478,null]'><div class="d m1" style="border-style:none;position:absolute;left:317.964000px;bottom:67.933000px;width:65.670000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:193.915000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

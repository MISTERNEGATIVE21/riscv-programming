<div id="pf30" class="pf w0 h0" data-page-no="30"><div class="pc pc30 w0 h0"><img class="bi x15 y5ba w2 h48" alt="" src="bg30.png"/><div class="t m0 x15 h7 y147 ff3 fs4 fc0 sc0 ls0 ws0">3.3.<span class="_ _19"> </span>PROGRAM<span class="_ _5"> </span>SECTIONS</div><div class="t m0 x15 h7 y1e ff3 fs4 fc0 sc0 ls0 ws0">information<span class="_ _b"> </span>to<span class="_ _3"> </span>the<span class="_ _b"> </span><span class="ff5">.data<span class="_ _3"> </span></span>section.<span class="_ _26"> </span>Hence,<span class="_ _3"> </span>the<span class="_ _b"> </span><span class="ff5">y<span class="_ _3"> </span></span>v<span class="_ _7"></span>ariable,<span class="_ _3"> </span>created<span class="_ _3"> </span>b<span class="_ _8"></span>y<span class="_ _3"> </span>combining<span class="_ _b"> </span>the</div><div class="t m0 x15 h7 yd4 ff5 fs4 fc0 sc0 ls0 ws0">y:<span class="_ _12"> </span><span class="ff3">label<span class="_ _3"> </span>with<span class="_ _3"> </span>the<span class="_ _3"> </span></span>.word<span class="_ _b"> </span><span class="ff3">directive,<span class="_ _3"> </span>is<span class="_ _3"> </span>added<span class="_ _b"> </span>to<span class="_ _3"> </span>the<span class="_ _3"> </span></span>.data<span class="_ _3"> </span><span class="ff3">section,<span class="_ _3"> </span>righ<span class="_ _1"></span>t<span class="_ _3"> </span>after<span class="_ _b"> </span>the<span class="_ _3"> </span><span class="ff5">x</span></span></div><div class="t m0 x15 h7 yd5 ff3 fs4 fc0 sc0 ls0 ws0">v<span class="_ _8"></span>ariable.<span class="_ _16"> </span>After<span class="_ _b"> </span>this,<span class="_ _b"> </span><span class="ff5">.section<span class="_ _31"> </span>.text<span class="_ _b"> </span></span>directive<span class="_ _b"> </span>in<span class="_ _2"> </span>line<span class="_ _b"> </span>10<span class="_ _b"> </span>instructs<span class="_ _b"> </span>the<span class="_ _b"> </span>assembler<span class="_ _2"> </span>to</div><div class="t m0 x15 h7 yfd ff3 fs4 fc0 sc0 ls0 ws0">add<span class="_ _2"> </span>the<span class="_ _b"> </span>next<span class="_ _2"> </span>information<span class="_ _2"> </span>to<span class="_ _b"> </span>the<span class="_ _5"> </span><span class="ff5">.text<span class="_ _b"> </span></span>section.<span class="_ _25"> </span>Finally<span class="_ _7"></span>,<span class="_ _2"> </span>the<span class="_ _b"> </span><span class="ff5">update<span class="_ _b"> </span>y<span class="_ _2"> </span></span>label<span class="_ _b"> </span>(line<span class="_ _2"> </span>11)</div><div class="t m0 x15 h7 y28a ff3 fs4 fc0 sc0 ls0 ws0">refers<span class="_ _2"> </span>to<span class="_ _2"> </span>a<span class="_ _2"> </span>p<span class="_ _4"></span>osition<span class="_ _5"> </span>in<span class="_ _2"> </span>the<span class="_ _b"> </span><span class="ff5">.text<span class="_ _5"> </span></span>section<span class="_ _2"> </span>and<span class="_ _2"> </span>the<span class="_ _2"> </span>remaining<span class="_ _2"> </span>instructions<span class="_ _b"> </span>(lines<span class="_ _5"> </span>12-14)</div><div class="t m0 x15 h7 y48a ff3 fs4 fc0 sc0 ls0 ws0">are<span class="_ _2"> </span>added<span class="_ _2"> </span>to<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">.text<span class="_ _2"> </span></span>section.</div><div class="t m0 xd h7 y910 ff3 fs4 fc0 sc0 ls0 ws0">Assuming<span class="_ _2f"> </span>the<span class="_ _2f"> </span>previous<span class="_ _2f"> </span>co<span class="_ _4"></span>de<span class="_ _30"> </span>is stored<span class="_ _2f"> </span>on<span class="_ _30"> </span>a ﬁle<span class="_ _2f"> </span>named<span class="_ _2f"> </span><span class="ff5">prog.s</span>, w<span class="_ _8"></span>e ma<span class="_ _8"></span>y assem<span class="_ _8"></span>ble the</div><div class="t m0 x15 h7 y911 ff3 fs4 fc0 sc0 ls0 ws0">program<span class="_ _2"> </span>and<span class="_ _2"> </span>insp<span class="_ _4"></span>ect<span class="_ _5"> </span>the<span class="_ _2"> </span>conten<span class="_ _8"></span>ts<span class="_ _2"> </span>of<span class="_ _2"> </span>the<span class="_ _2"> </span>ob<span class="_ _4"></span>ject<span class="_ _2"> </span>ﬁle<span class="_ _2"> </span>using<span class="_ _2"> </span>the<span class="_ _2"> </span>following<span class="_ _5"> </span>commands</div><div class="t m0 x8 h11 y912 ffc fs7 fc0 sc0 ls0 ws0">10</div><div class="t m0 x110 h7 y911 ff3 fs4 fc0 sc0 ls0 ws0">:</div><div class="t m0 x15 h8 y913 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-as<span class="_ _31"> </span>-march=rv32im<span class="_ _31"> </span>prog.s<span class="_ _31"> </span>-o<span class="_ _31"> </span>prog.o</div><div class="t m0 x15 h8 y914 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-objdump<span class="_ _31"> </span>-D<span class="_ _31"> </span>prog.o</div><div class="t m0 x15 h8 y915 ff5 fs4 fc0 sc0 ls0 ws0">prog.o:<span class="_ _86"> </span>file<span class="_ _9"> </span>format<span class="_ _31"> </span>elf32-littleriscv</div><div class="t m0 x15 h8 y916 ff5 fs4 fc0 sc0 ls0 ws0">Disassembly<span class="_ _9"> </span>of<span class="_ _31"> </span>section<span class="_ _31"> </span>.text:</div><div class="t m0 x15 h8 y917 ff5 fs4 fc0 sc0 ls0 ws0">00000000<span class="_ _9"> </span>&lt;update_x&gt;:</div><div class="t m0 xd h8 y918 ff5 fs4 fc0 sc0 ls0 ws0">0:<span class="_ _9"> </span>00000317<span class="_ _87"> </span>auipc<span class="_ _9"> </span>t1,0x0</div><div class="t m0 xd h8 y919 ff5 fs4 fc0 sc0 ls0 ws0">4:<span class="_ _9"> </span>00030313<span class="_ _87"> </span>mv<span class="_ _9"> </span>t1,t1</div><div class="t m0 xd h8 y91a ff5 fs4 fc0 sc0 ls0 ws0">8:<span class="_ _9"> </span>00a32023<span class="_ _87"> </span>sw<span class="_ _9"> </span>a0,0(t1)<span class="_ _31"> </span>#<span class="_ _31"> </span>0<span class="_ _31"> </span>&lt;update_x&gt;</div><div class="t m0 xd h8 y91b ff5 fs4 fc0 sc0 ls0 ws0">c:<span class="_ _9"> </span>00008067<span class="_ _87"> </span>ret</div><div class="t m0 x15 h8 y91c ff5 fs4 fc0 sc0 ls0 ws0">00000010<span class="_ _9"> </span>&lt;update_y&gt;:</div><div class="t m0 x3d h8 y91d ff5 fs4 fc0 sc0 ls0 ws0">10:<span class="_ _9"> </span>00000317<span class="_ _87"> </span>auipc<span class="_ _9"> </span>t1,0x0</div><div class="t m0 x3d h8 y91e ff5 fs4 fc0 sc0 ls0 ws0">14:<span class="_ _9"> </span>00030313<span class="_ _87"> </span>mv<span class="_ _9"> </span>t1,t1</div><div class="t m0 x3d h8 y91f ff5 fs4 fc0 sc0 ls0 ws0">18:<span class="_ _9"> </span>00a32023<span class="_ _87"> </span>sw<span class="_ _9"> </span>a0,0(t1)<span class="_ _31"> </span>#<span class="_ _31"> </span>10<span class="_ _31"> </span>&lt;update_y&gt;</div><div class="t m0 x3d h8 y920 ff5 fs4 fc0 sc0 ls0 ws0">1c:<span class="_ _9"> </span>00008067<span class="_ _87"> </span>ret</div><div class="t m0 x15 h8 y921 ff5 fs4 fc0 sc0 ls0 ws0">Disassembly<span class="_ _9"> </span>of<span class="_ _31"> </span>section<span class="_ _31"> </span>.data:</div><div class="t m0 x15 h8 y922 ff5 fs4 fc0 sc0 ls0 ws0">00000000<span class="_ _9"> </span>&lt;x&gt;:</div><div class="t m0 xd h8 y923 ff5 fs4 fc0 sc0 ls0 ws0">0:<span class="_ _9"> </span>000a<span class="_ _8f"> </span>c.slli<span class="_ _9"> </span>zero,0x2</div><div class="t m0 x15 h8 y924 ff5 fs4 fc0 sc0 ls0 ws0">...</div><div class="t m0 x15 h8 y925 ff5 fs4 fc0 sc0 ls0 ws0">00000004<span class="_ _9"> </span>&lt;y&gt;:</div><div class="t m0 xd h8 y926 ff5 fs4 fc0 sc0 ls0 ws0">4:<span class="_ _9"> </span>000c<span class="_ _8f"> </span>0xc</div><div class="t m0 x15 h8 y927 ff5 fs4 fc0 sc0 ls0 ws0">...</div><div class="t m0 xd h7 y928 ff3 fs4 fc0 sc0 ls0 ws0">Notice<span class="_ _25"> </span>that<span class="_ _25"> </span>the<span class="_ _25"> </span>program<span class="_ _9"> </span>routines,<span class="_ _9"> </span>represented<span class="_ _25"> </span>b<span class="_ _1"></span>y<span class="_ _25"> </span>the<span class="_ _25"> </span><span class="ff5">update<span class="_ _b"> </span>x<span class="_ _25"> </span></span>and<span class="_ _9"> </span><span class="ff5">update<span class="_ _b"> </span>y</span></div><div class="t m0 x15 h7 y929 ff3 fs4 fc0 sc0 ls0 ws0">lab<span class="_ _4"></span>els,<span class="_ _b"> </span>and<span class="_ _b"> </span>the<span class="_ _3"> </span>program<span class="_ _b"> </span>instructions<span class="_ _b"> </span>are<span class="_ _3"> </span>all<span class="_ _b"> </span>lo<span class="_ _4"></span>cated<span class="_ _b"> </span>on<span class="_ _b"> </span>the<span class="_ _3"> </span><span class="ff5">.text<span class="_ _b"> </span></span>section<span class="_ _b"> </span>while<span class="_ _3"> </span>the</div><div class="t m0 x15 h7 y92a ff3 fs4 fc0 sc0 ls0 ws0">global<span class="_ _b"> </span>v<span class="_ _8"></span>ariables,<span class="_ _3"> </span>represen<span class="_ _8"></span>ted<span class="_ _3"> </span>b<span class="_ _8"></span>y<span class="_ _3"> </span>the<span class="_ _b"> </span><span class="ff5">x<span class="_ _b"> </span></span>and<span class="_ _3"> </span><span class="ff5">y<span class="_ _b"> </span></span>lab<span class="_ _4"></span>els,<span class="_ _b"> </span>and<span class="_ _b"> </span>the<span class="_ _b"> </span>32-bit<span class="_ _3"> </span>v<span class="_ _7"></span>alues<span class="_ _3"> </span><span class="ff5">000a<span class="_ _b"> </span></span>and</div><div class="t m0 x15 h7 y92b ff5 fs4 fc0 sc0 ls0 ws0">000c<span class="ff3">, are<span class="_ _5"> </span>lo<span class="_ _4"></span>cated on<span class="_ _5"> </span>the </span>.data<span class="_ _5"> </span><span class="ff3">section.<span class="_ _3"> </span>Also,<span class="_ _5"> </span>notice<span class="_ _5"> </span>that the<span class="_ _5"> </span>elements of each section</span></div><div class="t m0 x15 h7 y92c ff3 fs4 fc0 sc0 ls0 ws0">are<span class="_ _a"> </span>assigned<span class="_ _25"> </span>addresses<span class="_ _a"> </span>starting<span class="_ _25"> </span>at<span class="_ _a"> </span>zero.<span class="_ _1b"> </span>Ho<span class="_ _8"></span>wev<span class="_ _8"></span>er,<span class="_ _9"> </span>since<span class="_ _25"> </span>instructions<span class="_ _a"> </span>and<span class="_ _25"> </span>data<span class="_ _25"> </span>are</div><div class="t m0 x15 h7 y92d ff3 fs4 fc0 sc0 ls0 ws0">stored<span class="_ _b"> </span>on<span class="_ _b"> </span>the<span class="_ _3"> </span>same<span class="_ _b"> </span>memory<span class="_ _7"></span>,<span class="_ _3"> </span>the<span class="_ _b"> </span>main<span class="_ _b"> </span>memory,<span class="_ _3"> </span>we<span class="_ _b"> </span>ma<span class="_ _8"></span>y<span class="_ _3"> </span>not<span class="_ _b"> </span>load<span class="_ _b"> </span>the<span class="_ _b"> </span>v<span class="_ _8"></span>ariables<span class="_ _3"> </span>and</div><div class="t m0 x15 h7 y92e ff3 fs4 fc0 sc0 ls0 ws0">the instruction<span class="_ _5"> </span>into the same<span class="_ _5"> </span>memory<span class="_ _5"> </span>addresses.<span class="_ _3"> </span>The<span class="_ _5"> </span>linker prev<span class="_ _8"></span>ents this<span class="_ _5"> </span>problem by</div><div class="t m0 x15 h7 y92f ff3 fs4 fc0 sc0 ls0 ws0">relo<span class="_ _4"></span>cating<span class="_ _b"> </span>the<span class="_ _b"> </span>instructions<span class="_ _3"> </span>and<span class="_ _3"> </span>data<span class="_ _b"> </span>so<span class="_ _3"> </span>they<span class="_ _b"> </span>are<span class="_ _3"> </span>assigned<span class="_ _b"> </span>non-conﬂicting<span class="_ _3"> </span>addresses.</div><div class="t m0 x15 h7 y930 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _5"> </span>following commands<span class="_ _2"> </span>show how<span class="_ _5"> </span>to<span class="_ _5"> </span>inv<span class="_ _8"></span>oke<span class="_ _5"> </span>the<span class="_ _5"> </span>linker to<span class="_ _2"> </span>pro<span class="_ _4"></span>duce an<span class="_ _2"> </span>executable<span class="_ _5"> </span>ﬁle</div><div class="t m0 x15 h7 y931 ff3 fs4 fc0 sc0 ls0 ws0">named<span class="_ _2"> </span><span class="ff5">prog.x<span class="_ _2"> </span></span>and<span class="_ _2"> </span>ho<span class="_ _1"></span>w<span class="_ _2"> </span>to<span class="_ _2"> </span>in<span class="_ _1"></span>v<span class="_ _1"></span>ok<span class="_ _1"></span>e<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">objdump<span class="_ _2"> </span></span>to<span class="_ _4"></span>ol<span class="_ _5"> </span>to<span class="_ _2"> </span>insp<span class="_ _4"></span>ect<span class="_ _5"> </span>its<span class="_ _2"> </span>conten<span class="_ _8"></span>ts:</div><div class="t m0 x15 h8 y932 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-ld<span class="_ _31"> </span>-m<span class="_ _31"> </span>elf32lriscv<span class="_ _31"> </span>prog.o<span class="_ _31"> </span>-o<span class="_ _31"> </span>prog.x</div><div class="t m0 x15 h8 y933 ff5 fs4 fc0 sc0 ls0 ws0">$<span class="_ _9"> </span>riscv64-unknown-elf-objdump<span class="_ _31"> </span>-D<span class="_ _31"> </span>prog.x</div><div class="t m0 x15 h8 y934 ff5 fs4 fc0 sc0 ls0 ws0">prog.x:<span class="_ _86"> </span>file<span class="_ _9"> </span>format<span class="_ _31"> </span>elf32-littleriscv</div><div class="t m0 x15 h8 y935 ff5 fs4 fc0 sc0 ls0 ws0">Disassembly<span class="_ _9"> </span>of<span class="_ _31"> </span>section<span class="_ _31"> </span>.text:</div><div class="t m0 x4a h1e y936 ff12 fse fc0 sc0 ls0 ws0">10</div><div class="t m0 xd h1f y4c3 ff13 fsf fc0 sc0 ls0 ws0">In<span class="_ _2"> </span>this<span class="_ _b"> </span>example,<span class="_ _b"> </span>the<span class="_ _2"> </span><span class="ff28">la<span class="_ _b"> </span></span>assem<span class="_ _1"></span>bly<span class="_ _2"> </span>instruction<span class="_ _b"> </span>is<span class="_ _2"> </span>a<span class="_ _b"> </span>pseudo-instruction<span class="_ _2"> </span>that<span class="_ _b"> </span>is<span class="_ _2"> </span>conv<span class="_ _1"></span>erted<span class="_ _b"> </span>b<span class="_ _8"></span>y<span class="_ _b"> </span>the</div><div class="t m0 x15 h1f y4c4 ff13 fsf fc0 sc0 ls0 ws0">assembler in<span class="_ _8"></span>to tw<span class="_ _1"></span>o machine instructions:<span class="_ _2"> </span><span class="ff28">auipc<span class="_ _2f"> </span></span>and <span class="ff28">mv</span>.<span class="_ _b"> </span>These tw<span class="_ _8"></span>o instructions will<span class="_ _2f"> </span>b<span class="_ _4"></span>e later up<span class="_ _4"></span>dated</div><div class="t m0 x15 h1f y209 ff13 fsf fc0 sc0 ls0 ws0">by<span class="_ _30"> </span>the link<span class="_ _8"></span>er so that they<span class="_ _30"> </span>load the address<span class="_ _30"> </span>of the<span class="_ _30"> </span>respective label in<span class="_ _1"></span>to the target<span class="_ _30"> </span>register, <span class="ff14">i.e.</span>, register</div><div class="t m0 x15 h1f y48 ff28 fsf fc0 sc0 ls0 ws0">t1<span class="ff13">.</span></div><div class="t m0 x1f h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _a"> </span>Marc<span class="_ _8"></span>h<span class="_ _2"> </span>29,<span class="_ _2"> </span>2021)<span class="_ _4e"> </span>35</span></div><a class="l" href="#pf30" data-dest-detail='[48,"XYZ",105.952,108.724,null]'><div class="d m1" style="border-style:none;position:absolute;left:445.601000px;bottom:674.212000px;width:10.433000px;height:12.040000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfd" data-dest-detail='[13,"XYZ",90.709,590.644,null]'><div class="d m1" style="border-style:none;position:absolute;left:370.979000px;bottom:281.337000px;width:14.169000px;height:11.125000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfb" data-dest-detail='[11,"XYZ",90.709,465.032,null]'><div class="d m1" style="border-style:none;position:absolute;left:236.998000px;bottom:245.749000px;width:62.676000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:141.766000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

<div id="pf38" class="pf w0 h0" data-page-no="38"><div class="pc pc38 w0 h0"><img class="bi x13 ya34 w2 h79" alt="" src="bg38.png"/><div class="t m0 x13 h7 y15a ff3 fs4 fc0 sc0 ls0 ws0">CHAPTER<span class="_ _2"> </span>4.<span class="_ _22"> </span>ASSEMBL<span class="_ _7"></span>Y<span class="_ _2"> </span>LANGUAGE</div><div class="t m0 x13 h7 y38 ff3 fs4 fc0 sc0 ls0 ws0">executed<span class="_ _5"> </span>when<span class="_ _2"> </span>the<span class="_ _2"> </span>execution<span class="_ _5"> </span>ﬂow<span class="_ _5"> </span>leav<span class="_ _8"></span>es<span class="_ _2"> </span>the<span class="_ _5"> </span>lo<span class="_ _4"></span>op.<span class="_ _3"> </span>The<span class="_ _2"> </span>instruction<span class="_ _2"> </span>at<span class="_ _5"> </span>line<span class="_ _2"> </span>8<span class="_ _5"> </span>jumps<span class="_ _2"> </span>to</div><div class="t m0 x13 h7 yed ff3 fs4 fc0 sc0 ls0 ws0">this numeric lab<span class="_ _4"></span>el when<span class="_ _5"> </span>the<span class="_ _5"> </span>v<span class="_ _8"></span>alue<span class="_ _5"> </span>of<span class="_ _5"> </span>register <span class="ff5">a1<span class="_ _5"> </span></span>is<span class="_ _5"> </span>equal<span class="_ _5"> </span>to<span class="_ _5"> </span>zero<span class="_ _5"> </span>–<span class="_ _5"> </span>notice the<span class="_ _5"> </span>reference</div><div class="t m0 x13 h7 yee ff5 fs4 fc0 sc0 ls0 ws0">1f<span class="ff3">,<span class="_ _2"> </span>whic<span class="_ _1"></span>h<span class="_ _2"> </span>refers<span class="_ _2"> </span>to<span class="_ _2"> </span>the<span class="_ _2"> </span>n<span class="_ _1"></span>umeric<span class="_ _2"> </span>lab<span class="_ _4"></span>el<span class="_ _5"> </span>‘<span class="ff5">1</span>’<span class="_ _2"> </span>p<span class="_ _4"></span>ositioned<span class="_ _5"> </span>after<span class="_ _2"> </span>the<span class="_ _2"> </span>reference.</span></div><div class="t m0 xd5 h8 ya35 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>Pow<span class="_ _11"> </span>function<span class="_ _e"> </span>--<span class="_ _e"> </span>computes<span class="_ _e"> </span>a^b</span></div><div class="t m0 xd5 h8 ya36 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _1f"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>Inputs:<span class="_ _11"> </span>a0=a,<span class="_ _e"> </span>a1=b</span></div><div class="t m0 xd5 h8 ya37 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _1f"> </span><span class="ff5 fs4">#<span class="_ _e"> </span>Output:<span class="_ _11"> </span>a0=a^b</span></div><div class="t m0 xd5 h8 ya38 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _1f"> </span><span class="ff5 fs4">pow:</span></div><div class="t m0 xd5 h8 ya39 ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _36"> </span><span class="ff5 fs4">mv<span class="_ _3f"> </span>a2,<span class="_ _11"> </span>a0<span class="_ _88"> </span>#<span class="_ _e"> </span>Saves<span class="_ _e"> </span>a0<span class="_ _e"> </span>in<span class="_ _11"> </span>a2</span></div><div class="t m0 xd5 h8 ya3a ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _36"> </span><span class="ff5 fs4">li<span class="_ _3f"> </span>a0,<span class="_ _11"> </span>1<span class="_ _5a"> </span>#<span class="_ _11"> </span>Sets<span class="_ _e"> </span>a0<span class="_ _e"> </span>to<span class="_ _e"> </span>1</span></div><div class="t m0 xd5 h8 ya3b ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _1f"> </span><span class="ff5 fs4">1:</span></div><div class="t m0 xd5 h8 ya3c ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _36"> </span><span class="ff5 fs4">beqz<span class="_ _11"> </span>a1,<span class="_ _e"> </span>1f<span class="_ _88"> </span>#<span class="_ _e"> </span>If<span class="_ _e"> </span>a1<span class="_ _11"> </span>=<span class="_ _e"> </span>0<span class="_ _e"> </span>then<span class="_ _e"> </span>done</span></div><div class="t m0 xd5 h8 ya3d ff24 fs12 fc0 sc0 ls0 ws0">9<span class="_ _36"> </span><span class="ff5 fs4">mul<span class="_ _85"> </span>a0,<span class="_ _11"> </span>a0,<span class="_ _e"> </span>a2<span class="_ _e"> </span>#<span class="_ _e"> </span>Else,<span class="_ _11"> </span>multiply</span></div><div class="t m0 x7c h8 ya3e ff24 fs12 fc0 sc0 ls0 ws0">10<span class="_ _36"> </span><span class="ff5 fs4">addi<span class="_ _11"> </span>a1,<span class="_ _e"> </span>a1,<span class="_ _e"> </span>-1<span class="_ _e"> </span>#<span class="_ _11"> </span>Decrements<span class="_ _e"> </span>the<span class="_ _e"> </span>counter</span></div><div class="t m0 x7c h8 ya3f ff24 fs12 fc0 sc0 ls0 ws0">11<span class="_ _36"> </span><span class="ff5 fs4">j<span class="_ _86"> </span>1b<span class="_ _91"> </span>#<span class="_ _11"> </span>Repeat</span></div><div class="t m0 x7c h8 ya40 ff24 fs12 fc0 sc0 ls0 ws0">12<span class="_ _1f"> </span><span class="ff5 fs4">1:</span></div><div class="t m0 x7c h8 ya41 ff24 fs12 fc0 sc0 ls0 ws0">13<span class="_ _36"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x13 hd ya42 ff6 fs3 fc0 sc0 ls0 ws0">4.6<span class="_ _36"> </span>The<span class="_ _b"> </span>lo<span class="_ _4"></span>cation<span class="_ _b"> </span>coun<span class="_ _1"></span>ter<span class="_ _b"> </span>and<span class="_ _b"> </span>the<span class="_ _0"> </span>assem<span class="_ _7"></span>bling<span class="_ _0"> </span>pro-</div><div class="t m0 xa hd ya43 ff6 fs3 fc0 sc0 ls0 ws0">cess</div><div class="t m0 x13 h7 ya44 ff7 fs4 fc0 sc0 ls0 ws0">The<span class="_ _a"> </span>lo<span class="_ _4"></span>cation<span class="_ _a"> </span>counter<span class="_ _d"> </span>is<span class="_ _3"> </span>an<span class="_ _a"> </span>internal<span class="_ _a"> </span>assem<span class="_ _8"></span>bler<span class="_ _3"> </span>coun<span class="_ _1"></span>ter<span class="_ _a"> </span>that<span class="_ _3"> </span>k<span class="_ _8"></span>eeps<span class="_ _3"> </span>trac<span class="_ _1"></span>k<span class="_ _a"> </span>of</div><div class="t m0 x13 h7 ya45 ff7 fs4 fc0 sc0 ls0 ws0">addresses<span class="_ _a"> </span>when<span class="_ _3"> </span>a<span class="_ _3"> </span>program<span class="_ _a"> </span>is<span class="_ _3"> </span>b<span class="_ _4"></span>eing<span class="_ _a"> </span>assembled<span class="ff3">.<span class="_ _11"> </span>More<span class="_ _2"> </span>sp<span class="_ _4"></span>eciﬁcally<span class="_ _7"></span>,<span class="_ _d"> </span>it<span class="_ _d"> </span>k<span class="_ _1"></span>eeps<span class="_ _2"> </span>the</span></div><div class="t m0 x13 h7 ya46 ff3 fs4 fc0 sc0 ls0 ws0">address<span class="_ _c"> </span>of<span class="_ _3"> </span>the<span class="_ _c"> </span>next<span class="_ _c"> </span>av<span class="_ _7"></span>ailable<span class="_ _c"> </span>memory<span class="_ _c"> </span>p<span class="_ _4"></span>osition.<span class="_ _0"> </span>Each<span class="_ _3"> </span>section<span class="_ _c"> </span>has<span class="_ _c"> </span>its<span class="_ _c"> </span>own<span class="_ _3"> </span>lo<span class="_ _4"></span>cation</div><div class="t m0 x13 h7 ya47 ff3 fs4 fc0 sc0 ls0 ws0">coun<span class="_ _1"></span>ter,<span class="_ _2"> </span>and<span class="_ _2"> </span>the<span class="_ _2"> </span>activ<span class="_ _1"></span>e<span class="_ _2"> </span>lo<span class="_ _4"></span>cation<span class="_ _5"> </span>counter<span class="_ _5"> </span>is<span class="_ _2"> </span>the<span class="_ _2"> </span>lo<span class="_ _4"></span>cation<span class="_ _5"> </span>counter<span class="_ _5"> </span>of<span class="_ _2"> </span>the<span class="_ _2"> </span>active<span class="_ _2"> </span>section.</div><div class="t m0 x14 h7 ya48 ff3 fs4 fc0 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _d"> </span>discuss<span class="_ _d"> </span>how<span class="_ _d"> </span>the<span class="_ _d"> </span>lo<span class="_ _4"></span>cation<span class="_ _d"> </span>counter<span class="_ _2"> </span>is<span class="_ _a"> </span>used<span class="_ _d"> </span>and<span class="_ _d"> </span>up<span class="_ _4"></span>dated<span class="_ _d"> </span>throughout<span class="_ _d"> </span>the<span class="_ _a"> </span>assem-</div><div class="t m0 x13 h7 ya49 ff3 fs4 fc0 sc0 ls0 ws0">bling<span class="_ _2"> </span>pro<span class="_ _4"></span>cess,<span class="_ _5"> </span>we<span class="_ _5"> </span>will<span class="_ _2"> </span>assemble<span class="_ _5"> </span>the<span class="_ _2"> </span>following<span class="_ _5"> </span>assembly<span class="_ _5"> </span>program<span class="_ _2"> </span>step<span class="_ _2"> </span>by<span class="_ _5"> </span>step:</div><div class="t m0 xd5 h8 ya4a ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">sum42:</span></div><div class="t m0 xd5 h8 ya4b ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _36"> </span><span class="ff5 fs4">addi<span class="_ _11"> </span>a0,<span class="_ _e"> </span>a0,<span class="_ _e"> </span>42</span></div><div class="t m0 xd5 h8 ya4c ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _36"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x14 h7 ya4d ff3 fs4 fc0 sc0 ls0 ws0">Up<span class="_ _4"></span>on start, the GNU assembler clears the conten<span class="_ _8"></span>ts<span class="_ _5"> </span>of the sections<span class="_ _5"> </span>and the symbol</div><div class="t m0 x13 h7 ya4e ff3 fs4 fc0 sc0 ls0 ws0">table,<span class="_ _2"> </span>initializes<span class="_ _d"> </span>all<span class="_ _2"> </span>lo<span class="_ _4"></span>cation<span class="_ _2"> </span>counters<span class="_ _2"> </span>with<span class="_ _2"> </span>zero,<span class="_ _d"> </span>and<span class="_ _d"> </span>selects<span class="_ _2"> </span>the<span class="_ _d"> </span><span class="ff5">.text<span class="_ _2"> </span></span>section<span class="_ _d"> </span>as<span class="_ _2"> </span>the</div><div class="t m0 x13 h7 ya4f ff3 fs4 fc0 sc0 ls0 ws0">activ<span class="_ _1"></span>e<span class="_ _a"> </span>section.<span class="_ _2d"> </span>Figure<span class="_ _a"> </span>4.1<span class="_ _3"> </span>illustrates<span class="_ _a"> </span>the<span class="_ _a"> </span>status<span class="_ _a"> </span>of<span class="_ _3"> </span>the<span class="_ _a"> </span>internal<span class="_ _d"> </span>assembler<span class="_ _a"> </span>structures</div><div class="t m0 x13 h7 ya50 ff3 fs4 fc0 sc0 ls0 ws0">up<span class="_ _4"></span>on<span class="_ _5"> </span>start.</div><div class="c x57 ya51 w19 h7a"><div class="t m0 x26 h7b ya52 ff3d fs31 fc0 sc0 ls0 ws0">Contents<span class="_ _0"> </span>Address</div><div class="t m0 xf h7c ya53 ff3e fs31 fc0 sc0 ls0 ws0">000</div><div class="t m0 xf h7c ya54 ff3e fs31 fc0 sc0 ls0 ws0">001</div><div class="t m0 xf h7c ya55 ff3e fs31 fc0 sc0 ls0 ws0">002</div><div class="t m0 xf h7c ya56 ff3e fs31 fc0 sc0 ls0 ws0">003</div><div class="t m0 xf h7c ya57 ff3e fs31 fc0 sc0 ls0 ws0">004</div><div class="t m0 xf h7c ya58 ff3e fs31 fc0 sc0 ls0 ws0">005</div><div class="t m0 xf h7c ya59 ff3e fs31 fc0 sc0 ls0 ws0">006</div><div class="t m0 xf h7c ya5a ff3e fs31 fc0 sc0 ls0 ws0">007</div><div class="t m0 xf h7c ya5b ff3e fs31 fc0 sc0 ls0 ws0">...</div><div class="t m0 x26 h7b ya5c ff3d fs31 fc0 sc0 ls0 ws0">Location </div><div class="t m0 x26 h7b ya5d ff3d fs31 fc0 sc0 ls0 ws0">counter:</div><div class="t m0 xf h7c ya5e ff3e fs31 fc0 sc0 ls0 ws0">000</div><div class="t m0 x27 h7b ya5f ff3f fs31 fc0 sc0 ls0 ws0">.text<span class="ff3d"> section</span></div><div class="t m0 xf7 h7b ya60 ff3d fs31 fc0 sc0 ls0 ws0">Symbol table</div><div class="t m0 xf9 h7c ya61 ff3e fs31 fc0 sc0 ls0 ws0">sum42:  </div><div class="t m0 xf9 h7c ya62 ff3e fs31 fc0 sc0 ls0 ws0">  addi a0, a0, 42  </div><div class="t m0 xf9 h7c ya63 ff3e fs31 fc0 sc0 ls0 ws0">  ret</div><div class="t m0 x11b h7b ya64 ff3d fs31 fc0 sc0 ls0 ws0">Input file</div><div class="t m0 x57 h7b ya52 ff3d fs31 fc0 sc0 ls0 ws0">Contents<span class="_ _0"> </span>Address</div><div class="t m0 xe2 h7c ya53 ff3e fs31 fc0 sc0 ls0 ws0">000</div><div class="t m0 xe2 h7c ya54 ff3e fs31 fc0 sc0 ls0 ws0">001</div><div class="t m0 xe2 h7c ya55 ff3e fs31 fc0 sc0 ls0 ws0">002</div><div class="t m0 xe2 h7c ya56 ff3e fs31 fc0 sc0 ls0 ws0">003</div><div class="t m0 xe2 h7c ya57 ff3e fs31 fc0 sc0 ls0 ws0">004</div><div class="t m0 xe2 h7c ya58 ff3e fs31 fc0 sc0 ls0 ws0">005</div><div class="t m0 xe2 h7c ya59 ff3e fs31 fc0 sc0 ls0 ws0">006</div><div class="t m0 xe2 h7c ya5a ff3e fs31 fc0 sc0 ls0 ws0">007</div><div class="t m0 xe2 h7c ya5b ff3e fs31 fc0 sc0 ls0 ws0">...</div><div class="t m0 x57 h7b ya5c ff3d fs31 fc0 sc0 ls0 ws0">Location </div><div class="t m0 x48 h7b ya5d ff3d fs31 fc0 sc0 ls0 ws0">counter:</div><div class="t m0 xe2 h7c ya5e ff3e fs31 fc0 sc0 ls0 ws0">000</div><div class="t m0 x48 h7b ya5f ff3f fs31 fc0 sc0 ls0 ws0">.data<span class="ff3d"> section</span></div><div class="t m0 xa h7c ya65 ff3e fs31 fc0 sc0 ls0 ws0">...</div><div class="t m0 x27 h7b ya66 ff3d fs31 fc0 sc0 ls0 ws0">Active section</div></div><div class="t m0 x13 h7 ya67 ff3 fs4 fc0 sc0 ls0 ws0">Figure<span class="_ _2"> </span>4.1:<span class="_ _3"> </span>Assembler<span class="_ _2"> </span>in<span class="_ _8"></span>ternal<span class="_ _2"> </span>structures<span class="_ _2"> </span>up<span class="_ _4"></span>on<span class="_ _2"> </span>start.<span class="_ _c"> </span>The<span class="_ _5"> </span>sections’<span class="_ _2"> </span>conten<span class="_ _8"></span>ts<span class="_ _2"> </span>and<span class="_ _2"> </span>the</div><div class="t m0 x13 h7 ya68 ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _4"></span>ol<span class="_ _12"> </span>table are<span class="_ _12"> </span>cleared, the location coun<span class="_ _8"></span>ters are<span class="_ _12"> </span>initialized with<span class="_ _12"> </span>zero, and the<span class="_ _12"> </span><span class="ff5">.text</span></div><div class="t m0 x13 h7 ya69 ff3 fs4 fc0 sc0 ls0 ws0">section<span class="_ _2"> </span>is<span class="_ _2"> </span>set<span class="_ _2"> </span>as<span class="_ _2"> </span>the<span class="_ _2"> </span>activ<span class="_ _1"></span>e<span class="_ _2"> </span>section.</div><div class="t m0 x43 h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _c"> </span>August<span class="_ _5"> </span>26,<span class="_ _d"> </span>2021)<span class="_ _6f"> </span>42</span></div><a class="l" href="#pf38" data-dest-detail='[56,"XYZ",136.063,292.751,null]'><div class="d m1" style="border-style:none;position:absolute;left:235.690000px;bottom:310.874000px;width:14.723000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:185.308000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

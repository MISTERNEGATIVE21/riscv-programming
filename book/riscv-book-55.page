<div id="pf37" class="pf w0 h0" data-page-no="37"><div class="pc pc37 w0 h0"><img class="bi x17 ya22 w2 h7a" alt="" src="bg37.png"/><div class="t m0 x17 h7 y147 ff3 fs4 fc0 sc0 ls0 ws0">CHAPTER<span class="_ _2"> </span>4.<span class="_ _19"> </span>ASSEMBL<span class="_ _7"></span>Y<span class="_ _2"> </span>LANGUAGE</div><div class="t m0 x17 h7 y1e ff3 fs4 fc0 sc0 ls0 ws0">executed<span class="_ _5"> </span>when<span class="_ _2"> </span>the<span class="_ _2"> </span>execution<span class="_ _5"> </span>ﬂow<span class="_ _5"> </span>leav<span class="_ _8"></span>es<span class="_ _2"> </span>the<span class="_ _5"> </span>lo<span class="_ _4"></span>op.<span class="_ _3"> </span>The<span class="_ _2"> </span>instruction<span class="_ _2"> </span>at<span class="_ _5"> </span>line<span class="_ _2"> </span>8<span class="_ _5"> </span>jumps<span class="_ _2"> </span>to</div><div class="t m0 x17 h7 yd4 ff3 fs4 fc0 sc0 ls0 ws0">this numeric lab<span class="_ _4"></span>el when<span class="_ _5"> </span>the<span class="_ _5"> </span>v<span class="_ _8"></span>alue<span class="_ _5"> </span>of<span class="_ _5"> </span>register <span class="ff5">a1<span class="_ _5"> </span></span>is<span class="_ _5"> </span>equal<span class="_ _5"> </span>to<span class="_ _5"> </span>zero<span class="_ _5"> </span>–<span class="_ _5"> </span>notice the<span class="_ _5"> </span>reference</div><div class="t m0 x17 h7 yd5 ff5 fs4 fc0 sc0 ls0 ws0">1f<span class="ff3">,<span class="_ _2"> </span>whic<span class="_ _1"></span>h<span class="_ _2"> </span>refers<span class="_ _2"> </span>to<span class="_ _2"> </span>the<span class="_ _2"> </span>n<span class="_ _1"></span>umeric<span class="_ _2"> </span>lab<span class="_ _4"></span>el<span class="_ _5"> </span>‘<span class="ff5">1</span>’<span class="_ _2"> </span>p<span class="_ _4"></span>ositioned<span class="_ _5"> </span>after<span class="_ _2"> </span>the<span class="_ _2"> </span>reference.</span></div><div class="t m0 xd5 h8 ya23 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">#<span class="_ _31"> </span>Pow<span class="_ _31"> </span>function<span class="_ _9"> </span>--<span class="_ _31"> </span>computes<span class="_ _31"> </span>a^b</span></div><div class="t m0 xd5 h8 ya24 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _16"> </span><span class="ff5 fs4">#<span class="_ _31"> </span>Inputs:<span class="_ _31"> </span>a0=a,<span class="_ _9"> </span>a1=b</span></div><div class="t m0 xd5 h8 ya25 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _16"> </span><span class="ff5 fs4">#<span class="_ _31"> </span>Output:<span class="_ _31"> </span>a0=a^b</span></div><div class="t m0 xd5 h8 ya26 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _16"> </span><span class="ff5 fs4">pow:</span></div><div class="t m0 xd5 h8 ya27 ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _32"> </span><span class="ff5 fs4">mv<span class="_ _3b"> </span>a2,<span class="_ _31"> </span>a0<span class="_ _86"> </span>#<span class="_ _9"> </span>Saves<span class="_ _31"> </span>a0<span class="_ _31"> </span>in<span class="_ _31"> </span>a2</span></div><div class="t m0 xd5 h8 ya28 ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _32"> </span><span class="ff5 fs4">li<span class="_ _3b"> </span>a0,<span class="_ _31"> </span>1<span class="_ _56"> </span>#<span class="_ _9"> </span>Sets<span class="_ _31"> </span>a0<span class="_ _9"> </span>to<span class="_ _31"> </span>1</span></div><div class="t m0 xd5 h8 ya29 ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _16"> </span><span class="ff5 fs4">1:</span></div><div class="t m0 xd5 h8 ya2a ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _32"> </span><span class="ff5 fs4">beqz<span class="_ _9"> </span>a1,<span class="_ _31"> </span>1f<span class="_ _86"> </span>#<span class="_ _31"> </span>If<span class="_ _31"> </span>a1<span class="_ _31"> </span>=<span class="_ _31"> </span>0<span class="_ _9"> </span>then<span class="_ _31"> </span>done</span></div><div class="t m0 xd5 h8 ya2b ff24 fs12 fc0 sc0 ls0 ws0">9<span class="_ _32"> </span><span class="ff5 fs4">mul<span class="_ _82"> </span>a0,<span class="_ _9"> </span>a0,<span class="_ _31"> </span>a2<span class="_ _31"> </span>#<span class="_ _31"> </span>Else,<span class="_ _31"> </span>multiply</span></div><div class="t m0 x7b h8 ya2c ff24 fs12 fc0 sc0 ls0 ws0">10<span class="_ _32"> </span><span class="ff5 fs4">addi<span class="_ _9"> </span>a1,<span class="_ _31"> </span>a1,<span class="_ _31"> </span>-1<span class="_ _31"> </span>#<span class="_ _31"> </span>Decrements<span class="_ _31"> </span>the<span class="_ _9"> </span>counter</span></div><div class="t m0 x7b h8 ya2d ff24 fs12 fc0 sc0 ls0 ws0">11<span class="_ _32"> </span><span class="ff5 fs4">j<span class="_ _81"> </span>1b<span class="_ _34"> </span>#<span class="_ _9"> </span>Repeat</span></div><div class="t m0 x7b h8 ya2e ff24 fs12 fc0 sc0 ls0 ws0">12<span class="_ _16"> </span><span class="ff5 fs4">1:</span></div><div class="t m0 x7b h8 ya2f ff24 fs12 fc0 sc0 ls0 ws0">13<span class="_ _32"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x17 hd ya30 ff7 fs3 fc0 sc0 ls0 ws0">4.6<span class="_ _32"> </span>The<span class="_ _83"> </span>lo<span class="_ _4"></span>cation<span class="_ _15"> </span>coun<span class="_ _8"></span>ter<span class="_ _15"> </span>and<span class="_ _15"> </span>the<span class="_ _15"> </span>assem<span class="_ _8"></span>bling<span class="_ _15"> </span>pro-</div><div class="t m0 xa hd ya31 ff7 fs3 fc0 sc0 ls0 ws0">cess</div><div class="t m0 x17 h7 ya32 ff6 fs4 fc0 sc0 ls0 ws0">The<span class="_ _b"> </span>lo<span class="_ _4"></span>cation<span class="_ _b"> </span>counter<span class="_ _b"> </span>is<span class="_ _3"> </span>an<span class="_ _b"> </span>internal<span class="_ _b"> </span>assem<span class="_ _1"></span>bler<span class="_ _b"> </span>counter<span class="_ _b"> </span>that<span class="_ _3"> </span>k<span class="_ _8"></span>eeps<span class="_ _3"> </span>trac<span class="_ _8"></span>k<span class="_ _3"> </span>of</div><div class="t m0 x17 h7 ya33 ff6 fs4 fc0 sc0 ls0 ws0">addresses<span class="_ _3"> </span>when<span class="_ _b"> </span>a<span class="_ _3"> </span>program<span class="_ _3"> </span>is<span class="_ _3"> </span>being<span class="_ _3"> </span>assembled<span class="ff3">.<span class="_ _25"> </span>More<span class="_ _b"> </span>sp<span class="_ _4"></span>eciﬁcally<span class="_ _23"></span>,<span class="_ _b"> </span>it<span class="_ _b"> </span>k<span class="_ _8"></span>eeps<span class="_ _b"> </span>the</span></div><div class="t m0 x17 h7 ya34 ff3 fs4 fc0 sc0 ls0 ws0">address<span class="_ _a"> </span>of<span class="_ _3"> </span>the<span class="_ _a"> </span>next<span class="_ _a"> </span>av<span class="_ _7"></span>ailable<span class="_ _a"> </span>memory<span class="_ _a"> </span>p<span class="_ _4"></span>osition.<span class="_ _19"> </span>Eac<span class="_ _1"></span>h<span class="_ _3"> </span>section<span class="_ _a"> </span>has<span class="_ _a"> </span>its<span class="_ _a"> </span>own<span class="_ _3"> </span>lo<span class="_ _4"></span>cation</div><div class="t m0 x17 h7 ya35 ff3 fs4 fc0 sc0 ls0 ws0">coun<span class="_ _1"></span>ter,<span class="_ _2"> </span>and<span class="_ _2"> </span>the<span class="_ _2"> </span>activ<span class="_ _1"></span>e<span class="_ _2"> </span>lo<span class="_ _4"></span>cation<span class="_ _5"> </span>counter<span class="_ _5"> </span>is<span class="_ _2"> </span>the<span class="_ _2"> </span>lo<span class="_ _4"></span>cation<span class="_ _5"> </span>counter<span class="_ _5"> </span>of<span class="_ _2"> </span>the<span class="_ _2"> </span>active<span class="_ _2"> </span>section.</div><div class="t m0 x13 h7 ya36 ff3 fs4 fc0 sc0 ls0 ws0">T<span class="_ _7"></span>o<span class="_ _b"> </span>discuss<span class="_ _b"> </span>ho<span class="_ _8"></span>w<span class="_ _b"> </span>the<span class="_ _b"> </span>location<span class="_ _b"> </span>counter<span class="_ _2"> </span>is<span class="_ _b"> </span>used<span class="_ _b"> </span>and<span class="_ _b"> </span>updated<span class="_ _b"> </span>throughout<span class="_ _b"> </span>the<span class="_ _b"> </span>assem-</div><div class="t m0 x17 h7 ya37 ff3 fs4 fc0 sc0 ls0 ws0">bling<span class="_ _2"> </span>pro<span class="_ _4"></span>cess,<span class="_ _5"> </span>we<span class="_ _5"> </span>will<span class="_ _2"> </span>assemble<span class="_ _5"> </span>the<span class="_ _2"> </span>following<span class="_ _5"> </span>assembly<span class="_ _5"> </span>program<span class="_ _2"> </span>step<span class="_ _2"> </span>by<span class="_ _5"> </span>step:</div><div class="t m0 xd5 h8 ya38 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _16"> </span><span class="ff5 fs4">sum42:</span></div><div class="t m0 xd5 h8 ya39 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _32"> </span><span class="ff5 fs4">addi<span class="_ _9"> </span>a0,<span class="_ _31"> </span>a0,<span class="_ _31"> </span>42</span></div><div class="t m0 xd5 h8 ya3a ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _32"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x13 h7 ya3b ff3 fs4 fc0 sc0 ls0 ws0">Up<span class="_ _4"></span>on start, the GNU assembler clears the conten<span class="_ _8"></span>ts<span class="_ _5"> </span>of the sections<span class="_ _5"> </span>and the symbol</div><div class="t m0 x17 h7 ya3c ff3 fs4 fc0 sc0 ls0 ws0">table,<span class="_ _2"> </span>initializes<span class="_ _b"> </span>all<span class="_ _2"> </span>lo<span class="_ _4"></span>cation<span class="_ _2"> </span>coun<span class="_ _8"></span>ters<span class="_ _b"> </span>with<span class="_ _2"> </span>zero,<span class="_ _b"> </span>and<span class="_ _5"> </span>selects<span class="_ _b"> </span>the<span class="_ _2"> </span><span class="ff5">.text<span class="_ _2"> </span></span>section<span class="_ _b"> </span>as<span class="_ _2"> </span>the</div><div class="t m0 x17 h7 ya3d ff3 fs4 fc0 sc0 ls0 ws0">activ<span class="_ _1"></span>e<span class="_ _b"> </span>section.<span class="_ _26"> </span>Figure<span class="_ _b"> </span>4.1<span class="_ _3"> </span>illustrates<span class="_ _b"> </span>the<span class="_ _3"> </span>status<span class="_ _b"> </span>of<span class="_ _b"> </span>the<span class="_ _3"> </span>in<span class="_ _1"></span>ternal<span class="_ _b"> </span>assembler<span class="_ _b"> </span>structures</div><div class="t m0 x17 h7 ya3e ff3 fs4 fc0 sc0 ls0 ws0">up<span class="_ _4"></span>on<span class="_ _5"> </span>start.</div><div class="c x56 ya3f w19 h7b"><div class="t m0 x25 h7c ya40 ff3d fs31 fc0 sc0 ls0 ws0">Contents<span class="_ _0"> </span>Address</div><div class="t m0 xf h7d ya41 ff3e fs31 fc0 sc0 ls0 ws0">000</div><div class="t m0 xf h7d ya42 ff3e fs31 fc0 sc0 ls0 ws0">001</div><div class="t m0 xf h7d ya43 ff3e fs31 fc0 sc0 ls0 ws0">002</div><div class="t m0 xf h7d ya44 ff3e fs31 fc0 sc0 ls0 ws0">003</div><div class="t m0 xf h7d ya45 ff3e fs31 fc0 sc0 ls0 ws0">004</div><div class="t m0 xf h7d ya46 ff3e fs31 fc0 sc0 ls0 ws0">005</div><div class="t m0 xf h7d ya47 ff3e fs31 fc0 sc0 ls0 ws0">006</div><div class="t m0 xf h7d ya48 ff3e fs31 fc0 sc0 ls0 ws0">007</div><div class="t m0 xf h7d ya49 ff3e fs31 fc0 sc0 ls0 ws0">...</div><div class="t m0 x25 h7c ya4a ff3d fs31 fc0 sc0 ls0 ws0">Location </div><div class="t m0 x25 h7c ya4b ff3d fs31 fc0 sc0 ls0 ws0">counter:</div><div class="t m0 xf h7d ya4c ff3e fs31 fc0 sc0 ls0 ws0">000</div><div class="t m0 x26 h7c ya4d ff3f fs31 fc0 sc0 ls0 ws0">.text<span class="ff3d"> section</span></div><div class="t m0 xf6 h7c ya4e ff3d fs31 fc0 sc0 ls0 ws0">Symbol table</div><div class="t m0 xf8 h7d ya4f ff3e fs31 fc0 sc0 ls0 ws0">sum42:  </div><div class="t m0 xf8 h7d ya50 ff3e fs31 fc0 sc0 ls0 ws0">  addi a0, a0, 42  </div><div class="t m0 xf8 h7d ya51 ff3e fs31 fc0 sc0 ls0 ws0">  ret</div><div class="t m0 x11a h7c ya52 ff3d fs31 fc0 sc0 ls0 ws0">Input file</div><div class="t m0 x56 h7c ya40 ff3d fs31 fc0 sc0 ls0 ws0">Contents<span class="_ _0"> </span>Address</div><div class="t m0 xe1 h7d ya41 ff3e fs31 fc0 sc0 ls0 ws0">000</div><div class="t m0 xe1 h7d ya42 ff3e fs31 fc0 sc0 ls0 ws0">001</div><div class="t m0 xe1 h7d ya43 ff3e fs31 fc0 sc0 ls0 ws0">002</div><div class="t m0 xe1 h7d ya44 ff3e fs31 fc0 sc0 ls0 ws0">003</div><div class="t m0 xe1 h7d ya45 ff3e fs31 fc0 sc0 ls0 ws0">004</div><div class="t m0 xe1 h7d ya46 ff3e fs31 fc0 sc0 ls0 ws0">005</div><div class="t m0 xe1 h7d ya47 ff3e fs31 fc0 sc0 ls0 ws0">006</div><div class="t m0 xe1 h7d ya48 ff3e fs31 fc0 sc0 ls0 ws0">007</div><div class="t m0 xe1 h7d ya49 ff3e fs31 fc0 sc0 ls0 ws0">...</div><div class="t m0 x56 h7c ya4a ff3d fs31 fc0 sc0 ls0 ws0">Location </div><div class="t m0 x47 h7c ya4b ff3d fs31 fc0 sc0 ls0 ws0">counter:</div><div class="t m0 xe1 h7d ya4c ff3e fs31 fc0 sc0 ls0 ws0">000</div><div class="t m0 x47 h7c ya4d ff3f fs31 fc0 sc0 ls0 ws0">.data<span class="ff3d"> section</span></div><div class="t m0 xa h7d ya53 ff3e fs31 fc0 sc0 ls0 ws0">...</div><div class="t m0 x26 h7c ya54 ff3d fs31 fc0 sc0 ls0 ws0">Active section</div></div><div class="t m0 x17 h7 ya55 ff3 fs4 fc0 sc0 ls0 ws0">Figure<span class="_ _2"> </span>4.1:<span class="_ _3"> </span>Assembler<span class="_ _2"> </span>in<span class="_ _8"></span>ternal<span class="_ _2"> </span>structures<span class="_ _2"> </span>up<span class="_ _4"></span>on<span class="_ _2"> </span>start.<span class="_ _a"> </span>The<span class="_ _2"> </span>sections’<span class="_ _2"> </span>con<span class="_ _8"></span>tents<span class="_ _2"> </span>and<span class="_ _5"> </span>the</div><div class="t m0 x17 h7 ya56 ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _4"></span>ol<span class="_ _30"> </span>table are<span class="_ _2f"> </span>cleared, the<span class="_ _30"> </span>lo<span class="_ _4"></span>cation<span class="_ _2f"> </span>coun<span class="_ _8"></span>ters are<span class="_ _2f"> </span>initialized<span class="_ _2f"> </span>with<span class="_ _2f"> </span>zero, and<span class="_ _30"> </span>the <span class="ff5">.text</span></div><div class="t m0 x17 h7 ya57 ff3 fs4 fc0 sc0 ls0 ws0">section<span class="_ _2"> </span>is<span class="_ _2"> </span>set<span class="_ _2"> </span>as<span class="_ _2"> </span>the<span class="_ _2"> </span>activ<span class="_ _1"></span>e<span class="_ _2"> </span>section.</div><div class="t m0 x42 h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _3"> </span>March<span class="_ _2"> </span>29,<span class="_ _2"> </span>2021)<span class="_ _85"> </span>42</span></div><a class="l" href="#pf37" data-dest-detail='[55,"XYZ",136.063,292.751,null]'><div class="d m1" style="border-style:none;position:absolute;left:235.690000px;bottom:310.874000px;width:14.723000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:187.121000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

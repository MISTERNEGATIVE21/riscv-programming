<div id="pf40" class="pf w0 h0" data-page-no="40"><div class="pc pc40 w0 h0"><img class="bi xf y9dd w2 h91" alt="" src="bg40.png"/><div class="t m0 xf h8 y10b ff3 fs4 fc0 sc0 ls0 ws0">4.7.<span class="_ _1f"> </span>ASSEMBL<span class="_ _9"></span>Y<span class="_ _2"> </span>DIRECTIVES</div><div class="t m0 xf hb y57 ff6 fs6 fc0 sc0 ls0 ws0">4.7.4<span class="_ _11"> </span>The<span class="_ _7"> </span><span class="ff2">.set<span class="_ _7"> </span></span>and<span class="_ _7"> </span><span class="ff2">.equ<span class="_ _7"> </span></span>directives</div><div class="t m0 xf h8 y3ca ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _34"> </span><span class="ff5">.set<span class="_ _4"> </span>name,<span class="_ _4"> </span>expression<span class="_ _7"> </span></span>directive<span class="_ _b"> </span>adds<span class="_ _7"> </span>a<span class="_ _7"> </span>symbol<span class="_ _7"> </span>to<span class="_ _7"> </span>the<span class="_ _7"> </span>symbol<span class="_ _7"> </span>table.<span class="_ _1f"> </span>It<span class="_ _7"> </span>tak<span class="_ _1"></span>es<span class="_ _34"> </span>a<span class="_ _7"> </span>name<span class="_ _7"> </span>and<span class="_ _7"> </span>an</div><div class="t m0 xf h8 y3cb ff3 fs4 fc0 sc0 ls0 ws0">expression<span class="_ _2"> </span>as<span class="_ _2"> </span>arguments,<span class="_ _6"> </span>ev<span class="_ _27"></span>aluates<span class="_ _3"> </span>an<span class="_ _2"> </span>expression<span class="_ _2"> </span>to<span class="_ _2"> </span>a<span class="_ _3"> </span>v<span class="_ _27"></span>alue<span class="_ _2"> </span>and<span class="_ _2"> </span>store<span class="_ _2"> </span>the<span class="_ _3"> </span>name<span class="_ _2"> </span>and<span class="_ _2"> </span>the<span class="_ _2"> </span>resulting<span class="_ _3"> </span>v<span class="_ _27"></span>alue</div><div class="t m0 xf h8 y3cc ff3 fs4 fc0 sc0 ls0 ws0">in<span class="_ _1"></span>to<span class="_ _6"> </span>the<span class="_ _2"> </span>symbol<span class="_ _2"> </span>table.<span class="_ _7"> </span>The<span class="_ _2"> </span>following<span class="_ _6"> </span>co<span class="_ _5"></span>de<span class="_ _6"> </span>shows<span class="_ _6"> </span>how<span class="_ _6"> </span>the<span class="_ _2"> </span><span class="ff5">.set<span class="_ _2"> </span></span>directiv<span class="_ _1"></span>e<span class="_ _6"> </span>can<span class="_ _2"> </span>b<span class="_ _5"></span>e<span class="_ _2"> </span>used<span class="_ _2"> </span>to<span class="_ _2"> </span>asso<span class="_ _5"></span>ciate<span class="_ _6"> </span>v<span class="_ _27"></span>alues</div><div class="t m0 xf h8 y3cf ff3 fs4 fc0 sc0 ls0 ws0">to sym<span class="_ _1"></span>b<span class="_ _5"></span>ols and use them on the program.<span class="_ _b"> </span>In this case, the program ﬁrst deﬁnes the symbol named <span class="ff5">max<span class="_ _3"> </span>-</span></div><div class="t m0 xf h8 y3d0 ff5 fs4 fc0 sc0 ls0 ws0">value<span class="_ _38"> </span><span class="ff3">and<span class="_ _6"> </span>asso<span class="_ _5"></span>ciates<span class="_ _6"> </span>it with<span class="_ _6"> </span>v<span class="_ _27"></span>alue<span class="_ _6"> </span>42<span class="_ _38"> </span>(line<span class="_ _6"> </span>1).<span class="_ _7"> </span>Then,<span class="_ _6"> </span>it uses<span class="_ _6"> </span>the<span class="_ _6"> </span><span class="ff5">max<span class="_ _3"> </span>value<span class="_ _6"> </span></span>symbol<span class="_ _6"> </span>on<span class="_ _38"> </span>the<span class="_ _6"> </span><span class="ff5">li<span class="_ _6"> </span></span>instruction</span></div><div class="t m0 xf h8 y3d1 ff3 fs4 fc0 sc0 ls0 ws0">(line<span class="_ _2"> </span>4).</div><div class="t m0 x114 h9 y9de ff22 fs11 fc0 sc0 ls0 ws0">1<span class="_ _2a"> </span><span class="ff5 fs4">.set<span class="_ _4"> </span>max_value,<span class="_ _18"> </span>42</span></div><div class="t m0 x114 h39 y9df ff22 fs11 fc0 sc0 ls0 ws0">2</div><div class="t m0 x114 h9 y9e0 ff22 fs11 fc0 sc0 ls0 ws0">3<span class="_ _2a"> </span><span class="ff5 fs4">truncates_value_to_max:</span></div><div class="t m0 x114 h9 y9e1 ff22 fs11 fc0 sc0 ls0 ws0">4<span class="_ _37"> </span><span class="ff5 fs4">li<span class="_ _3f"> </span>t1,<span class="_ _4"> </span>max_value</span></div><div class="t m0 x114 h9 y9e2 ff22 fs11 fc0 sc0 ls0 ws0">5<span class="_ _37"> </span><span class="ff5 fs4">ble<span class="_ _7a"> </span>a0,<span class="_ _18"> </span>t1,<span class="_ _4"> </span>ok</span></div><div class="t m0 x114 h9 y9e3 ff22 fs11 fc0 sc0 ls0 ws0">6<span class="_ _37"> </span><span class="ff5 fs4">mv<span class="_ _3f"> </span>a0,<span class="_ _4"> </span>t1</span></div><div class="t m0 x114 h9 y9e4 ff22 fs11 fc0 sc0 ls0 ws0">7<span class="_ _2a"> </span><span class="ff5 fs4">ok:</span></div><div class="t m0 x114 h9 y9e5 ff22 fs11 fc0 sc0 ls0 ws0">8<span class="_ _37"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xc h8 y9e6 ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _2"> </span><span class="ff5">.equ<span class="_ _2"> </span></span>directiv<span class="_ _1"></span>e<span class="_ _2"> </span>p<span class="_ _5"></span>erforms<span class="_ _6"> </span>the<span class="_ _2"> </span>same<span class="_ _2"> </span>task<span class="_ _2"> </span>as<span class="_ _2"> </span>the<span class="_ _2"> </span><span class="ff5">.set<span class="_ _2"> </span></span>directive.</div><div class="t m0 xf hb y9e7 ff6 fs6 fc0 sc0 ls0 ws0">4.7.5<span class="_ _11"> </span>The<span class="_ _7"> </span><span class="ff2">.globl<span class="_ _7"> </span></span>directiv<span class="_ _1"></span>e</div><div class="t m0 xf h8 y9e8 ff3 fs4 fc0 sc0 ls0 ws0">As<span class="_ _2"> </span>discussed<span class="_ _2"> </span>in<span class="_ _2"> </span>Section<span class="_ _2"> </span>3.2.4,<span class="_ _3"> </span>program<span class="_ _2"> </span>symbols<span class="_ _2"> </span>can<span class="_ _2"> </span>b<span class="_ _5"></span>e<span class="_ _2"> </span>classiﬁed<span class="_ _2"> </span>as<span class="_ _3"> </span>lo<span class="_ _5"></span>cal<span class="_ _2"> </span>or<span class="_ _2"> </span>global<span class="_ _2"> </span>symbols.<span class="_ _24"> </span>By<span class="_ _2"> </span>default,</div><div class="t m0 xf h8 y9e9 ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _5"></span>ols<span class="_ _b"> </span>automatically<span class="_ _b"> </span>created<span class="_ _34"> </span>for<span class="_ _b"> </span>lab<span class="_ _5"></span>els<span class="_ _b"> </span>or<span class="_ _34"> </span>explicitly<span class="_ _b"> </span>created<span class="_ _34"> </span>by<span class="_ _3"> </span>the<span class="_ _34"> </span>program<span class="_ _b"> </span>using<span class="_ _b"> </span>the<span class="_ _34"> </span><span class="ff5">.set<span class="_ _b"> </span></span>or<span class="_ _34"> </span><span class="ff5">.equ</span></div><div class="t m0 xf h8 y9ea ff3 fs4 fc0 sc0 ls0 ws0">directiv<span class="_ _1"></span>es are<span class="_ _a"> </span>stored on the<span class="_ _a"> </span>symbol table as local sym<span class="_ _27"></span>b<span class="_ _5"></span>ols.<span class="_ _34"> </span>The <span class="ff5">.globl<span class="_ _89"> </span></span>directive<span class="_ _a"> </span>can b<span class="_ _5"></span>e used<span class="_ _a"> </span>to turn local</div><div class="t m0 xf h8 y9eb ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _5"></span>ols<span class="_ _3"> </span>into<span class="_ _2"> </span>global<span class="_ _b"> </span>ones.<span class="_ _2a"> </span>The<span class="_ _3"> </span>following<span class="_ _2"> </span>co<span class="_ _5"></span>de<span class="_ _3"> </span>shows<span class="_ _3"> </span>an<span class="_ _3"> </span>example<span class="_ _b"> </span>in<span class="_ _3"> </span>which<span class="_ _2"> </span>the<span class="_ _b"> </span><span class="ff5">start<span class="_ _3"> </span></span>and<span class="_ _3"> </span>the<span class="_ _b"> </span><span class="ff5">max<span class="_ _3"> </span>temp</span></div><div class="t m0 xf h8 y9ec ff3 fs4 fc0 sc0 ls0 ws0">sym<span class="_ _1"></span>b<span class="_ _5"></span>ols<span class="_ _6"> </span>are<span class="_ _2"> </span>conv<span class="_ _27"></span>erted<span class="_ _2"> </span>into<span class="_ _6"> </span>global<span class="_ _2"> </span>symbols<span class="_ _2"> </span>by<span class="_ _6"> </span>the<span class="_ _2"> </span><span class="ff5">.globl<span class="_ _2"> </span></span>directive.</div><div class="t m0 x114 h9 y9ed ff22 fs11 fc0 sc0 ls0 ws0">1<span class="_ _2a"> </span><span class="ff5 fs4">.globl<span class="_ _4"> </span>max_value</span></div><div class="t m0 x114 h9 y9ee ff22 fs11 fc0 sc0 ls0 ws0">2<span class="_ _2a"> </span><span class="ff5 fs4">.globl<span class="_ _4"> </span>start</span></div><div class="t m0 x114 h39 y9ef ff22 fs11 fc0 sc0 ls0 ws0">3</div><div class="t m0 x114 h9 y9f0 ff22 fs11 fc0 sc0 ls0 ws0">4<span class="_ _2a"> </span><span class="ff5 fs4">.set<span class="_ _4"> </span>max_value,<span class="_ _18"> </span>42</span></div><div class="t m0 x114 h39 y9f1 ff22 fs11 fc0 sc0 ls0 ws0">5</div><div class="t m0 x114 h9 y9f2 ff22 fs11 fc0 sc0 ls0 ws0">6<span class="_ _2a"> </span><span class="ff5 fs4">start:</span></div><div class="t m0 x114 h9 y9f3 ff22 fs11 fc0 sc0 ls0 ws0">7<span class="_ _37"> </span><span class="ff5 fs4">li<span class="_ _7a"> </span>a0,<span class="_ _18"> </span>max_value</span></div><div class="t m0 x114 h9 y9f4 ff22 fs11 fc0 sc0 ls0 ws0">8<span class="_ _37"> </span><span class="ff5 fs4">jal<span class="_ _18"> </span>process_temp</span></div><div class="t m0 x114 h9 y9f5 ff22 fs11 fc0 sc0 ls0 ws0">9<span class="_ _37"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 xf hb y9f6 ff6 fs6 fc0 sc0 ls0 ws0">4.7.6<span class="_ _11"> </span>The<span class="_ _7"> </span><span class="ff2">.align<span class="_ _7"> </span></span>directiv<span class="_ _1"></span>e</div><div class="t m0 xf h8 y9f7 ff3 fs4 fc0 sc0 ls0 ws0">Some<span class="_ _34"> </span>Instruction<span class="_ _7"> </span>Set<span class="_ _7"> </span>Arc<span class="_ _1"></span>hitectures<span class="_ _34"> </span>require<span class="_ _7"> </span>instructions<span class="_ _7"> </span>or<span class="_ _34"> </span>multi-b<span class="_ _27"></span>yte<span class="_ _7"> </span>data<span class="_ _7"> </span>to<span class="_ _34"> </span>b<span class="_ _5"></span>e<span class="_ _7"> </span>stored<span class="_ _7"> </span>on<span class="_ _7"> </span>addresses</div><div class="t m0 xf h8 y9f8 ff3 fs4 fc0 sc0 ls0 ws0">that<span class="_ _2"> </span>are<span class="_ _3"> </span>m<span class="_ _1"></span>ultiple<span class="_ _2"> </span>of<span class="_ _3"> </span>a<span class="_ _2"> </span>given<span class="_ _2"> </span>n<span class="_ _1"></span>um<span class="_ _1"></span>b<span class="_ _5"></span>er.<span class="_ _24"> </span>F<span class="_ _9"></span>or<span class="_ _3"> </span>example,<span class="_ _2"> </span>the<span class="_ _3"> </span>R<span class="_ _12"></span>V32I<span class="_ _2"> </span>ISA<span class="_ _3"> </span>requires<span class="_ _2"> </span>instructions<span class="_ _3"> </span>to<span class="_ _2"> </span>b<span class="_ _5"></span>e<span class="_ _3"> </span>stored<span class="_ _2"> </span>on</div><div class="t m0 xf h8 y9f9 ff3 fs4 fc0 sc0 ls0 ws0">addresses<span class="_ _2"> </span>that<span class="_ _2"> </span>are<span class="_ _6"> </span>multiples<span class="_ _6"> </span>of<span class="_ _2"> </span>four.</div><div class="t m0 xc h8 y9fa ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _38"> </span>GNU<span class="_ _6"> </span>assembler do<span class="_ _5"></span>es<span class="_ _6"> </span>not<span class="_ _6"> </span>verify automatically<span class="_ _38"> </span>whether<span class="_ _6"> </span>or<span class="_ _6"> </span>not<span class="_ _6"> </span>R<span class="_ _12"></span>V32I<span class="_ _6"> </span>instructions<span class="_ _6"> </span>are<span class="_ _6"> </span>assigned<span class="_ _38"> </span>to</div><div class="t m0 xf h8 y9fb ff3 fs4 fc0 sc0 ls0 ws0">addresses<span class="_ _6"> </span>that<span class="_ _2"> </span>are<span class="_ _2"> </span>m<span class="_ _1"></span>ultiple<span class="_ _6"> </span>of<span class="_ _2"> </span>four.<span class="_ _7"> </span>The<span class="_ _6"> </span>following<span class="_ _6"> </span>co<span class="_ _5"></span>de,<span class="_ _2"> </span>for<span class="_ _6"> </span>example,<span class="_ _2"> </span>is<span class="_ _2"> </span>assembled<span class="_ _38"> </span>without<span class="_ _2"> </span>errors<span class="_ _2"> </span>by<span class="_ _38"> </span>the</div><div class="t m0 xf h8 y9fc ff3 fs4 fc0 sc0 ls0 ws0">GNU<span class="_ _2"> </span>assembler.<span class="_ _7"> </span>In<span class="_ _2"> </span>this<span class="_ _2"> </span>case,<span class="_ _3"> </span>the<span class="_ _2"> </span><span class="ff5">j<span class="_ _4"> </span>next<span class="_ _2"> </span></span>instruction<span class="_ _2"> </span>is<span class="_ _2"> </span>stored<span class="_ _3"> </span>at<span class="_ _2"> </span>addresses<span class="_ _2"> </span><span class="ff5">0x0</span>,<span class="_ _3"> </span><span class="ff5">0x1</span>,<span class="_ _2"> </span><span class="ff5">0x2</span>,<span class="_ _2"> </span>and<span class="_ _3"> </span><span class="ff5">0x3</span>,<span class="_ _2"> </span>the</div><div class="t m0 xf h8 y9fd ff3 fs4 fc0 sc0 ls0 ws0">8-bit<span class="_ _3"> </span>v<span class="_ _27"></span>alue<span class="_ _b"> </span><span class="ff5">0xa<span class="_ _b"> </span></span>is<span class="_ _3"> </span>stored<span class="_ _b"> </span>at<span class="_ _b"> </span>address<span class="_ _3"> </span><span class="ff5">0x4</span>,<span class="_ _b"> </span>and<span class="_ _b"> </span>the<span class="_ _b"> </span><span class="ff5">ret<span class="_ _3"> </span></span>instruction<span class="_ _b"> </span>is<span class="_ _3"> </span>stored<span class="_ _b"> </span>at<span class="_ _b"> </span>addresses<span class="_ _3"> </span><span class="ff5">0x5</span>,<span class="_ _b"> </span><span class="ff5">0x6</span>,<span class="_ _b"> </span><span class="ff5">0x7</span>,</div><div class="t m0 xf h8 y9fe ff3 fs4 fc0 sc0 ls0 ws0">and<span class="_ _2"> </span><span class="ff5">0x8</span>.</div><div class="t m0 x2c h8 y33 ff3 fs4 fc0 sc0 ls0 ws0">Prin<span class="_ _1"></span>ted<span class="_ _2"> </span>v<span class="_ _1"></span>ersion<span class="_ _2"> </span>a<span class="_ _1"></span>v<span class="_ _27"></span>ailable<span class="_ _2"> </span>for<span class="_ _6"> </span>purchase<span class="_ _6"> </span>at<span class="_ _2"> </span>Amazon.com</div><div class="t m0 x2d h8 y141 ff3 fs4 fc0 sc0 ls0 ws0">F<span class="_ _9"></span>ree<span class="_ _2"> </span>online<span class="_ _6"> </span>version<span class="_ _6"> </span>at<span class="_ _2"> </span><span class="ff5">http://riscv-<span class="_ _22"></span>programming.org</span></div><div class="t m0 x2e h8 y142 ff3 fs4 fc0 sc0 ls0 ws0">(Generated<span class="_ _2"> </span>on<span class="_ _2"> </span>Octob<span class="_ _5"></span>er<span class="_ _6"> </span>15,<span class="_ _2"> </span>2023)</div><div class="t m0 xb8 h8 y33 ff3 fs4 fc0 sc0 ls0 ws0">51</div><a class="l" href="#pf2d" data-dest-detail='[45,"XYZ",72,399.053,null]'><div class="d m1" style="border-style:none;position:absolute;left:175.780000px;bottom:455.534000px;width:22.471000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfb" data-dest-detail='[11,"XYZ",72,150.158,null]'><div class="d m1" style="border-style:none;position:absolute;left:98.596000px;bottom:231.244000px;width:130.708000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,480.835,null]'><div class="d m1" style="border-style:none;position:absolute;left:343.402000px;bottom:219.289000px;width:18.597000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="#pfa" data-dest-detail='[10,"XYZ",72,552.649,null]'><div class="d m1" style="border-style:none;position:absolute;left:79.306000px;bottom:159.513000px;width:14.169000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="https://a.co/d/gUfKWsD"><div class="d m1" style="border-style:none;position:absolute;left:358.258000px;bottom:69.067000px;width:58.171000px;height:10.848000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:271.722000px;bottom:56.835000px;width:148.940000px;height:11.125000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

<div id="pf6c" class="pf w0 h0" data-page-no="6c"><div class="pc pc6c w0 h0"><img class="bi x13 y121c w2 ha8" alt="" src="bg6c.png"/><div class="t m0 x13 h7 y15a ff3 fs4 fc0 sc0 ls0 ws0">CHAPTER<span class="_ _2"> </span>8.<span class="_ _22"> </span>IMPLEMENTING<span class="_ _2"> </span>ROUTINES</div><div class="t m0 xd5 h8 y38 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">pow2:</span></div><div class="t m0 xd5 h8 yed ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _36"> </span><span class="ff5 fs4">mul<span class="_ _11"> </span>a0,<span class="_ _e"> </span>a0,<span class="_ _e"> </span>a0<span class="_ _e"> </span>#<span class="_ _11"> </span>a0<span class="_ _e"> </span>=<span class="_ _e"> </span>a0<span class="_ _e"> </span>*<span class="_ _11"> </span>a0</span></div><div class="t m0 xd5 h8 yee ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _36"> </span><span class="ff5 fs4">ret<span class="_ _92"> </span>#<span class="_ _11"> </span>return</span></div><div class="t m0 x14 h7 y121d ff3 fs4 fc0 sc0 ls0 ws0">The<span class="_ _2"> </span>following<span class="_ _2"> </span>co<span class="_ _4"></span>de<span class="_ _2"> </span>shows<span class="_ _5"> </span>how<span class="_ _2"> </span>to<span class="_ _d"> </span>inv<span class="_ _8"></span>ok<span class="_ _1"></span>e<span class="_ _2"> </span>the<span class="_ _d"> </span><span class="ff5">pow2<span class="_ _d"> </span></span>routine<span class="_ _2"> </span>to<span class="_ _d"> </span>compute<span class="_ _2"> </span>the<span class="_ _d"> </span>square</div><div class="t m0 x13 h7 y121e ff3 fs4 fc0 sc0 ls0 ws0">of<span class="_ _2"> </span>32.<span class="_ _3"> </span>Notice<span class="_ _2"> </span>that<span class="_ _2"> </span>the<span class="_ _2"> </span>v<span class="_ _8"></span>alue<span class="_ _2"> </span>itself<span class="_ _2"> </span>is<span class="_ _2"> </span>directly<span class="_ _2"> </span>placed<span class="_ _2"> </span>into<span class="_ _2"> </span>register<span class="_ _2"> </span><span class="ff5">a0</span>.</div><div class="t m0 xd5 h8 y121f ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">main:</span></div><div class="t m0 xd5 h8 y1220 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _36"> </span><span class="ff5 fs4">li<span class="_ _85"> </span>a0,<span class="_ _11"> </span>32<span class="_ _85"> </span>#<span class="_ _e"> </span>set<span class="_ _e"> </span>the<span class="_ _e"> </span>parameter<span class="_ _11"> </span>with<span class="_ _e"> </span>value<span class="_ _e"> </span>32</span></div><div class="t m0 xd5 h8 y1221 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _36"> </span><span class="ff5 fs4">jal<span class="_ _11"> </span>pow2<span class="_ _86"> </span>#<span class="_ _e"> </span>invoke<span class="_ _e"> </span>pow2</span></div><div class="t m0 xd5 h8 y1222 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _36"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x14 h7 y9ea ff7 fs4 fc0 sc0 ls0 ws0">Reference parameters<span class="_ _38"> </span>are parameters<span class="_ _38"> </span>that con<span class="_ _8"></span>tain a reference<span class="_ _38"> </span>to a v<span class="_ _7"></span>ari-</div><div class="t m0 x13 h7 y1223 ff7 fs4 fc0 sc0 ls0 ws0">able<span class="ff3">.<span class="_ _11"> </span>This<span class="_ _d"> </span>“reference”<span class="_ _d"> </span>is<span class="_ _d"> </span>the<span class="_ _d"> </span>v<span class="_ _8"></span>ariable<span class="_ _d"> </span>memory<span class="_ _d"> </span>address.<span class="_ _e"> </span>Hence,<span class="_ _d"> </span>the<span class="_ _d"> </span>routine<span class="_ _d"> </span>may<span class="_ _2"> </span>use</span></div><div class="t m0 x13 h7 y1224 ff3 fs4 fc0 sc0 ls0 ws0">this<span class="_ _a"> </span>address<span class="_ _a"> </span>to<span class="_ _a"> </span>read<span class="_ _a"> </span>or<span class="_ _a"> </span>up<span class="_ _4"></span>date<span class="_ _d"> </span>the<span class="_ _a"> </span>v<span class="_ _8"></span>ariable<span class="_ _a"> </span>v<span class="_ _8"></span>alue.<span class="_ _1b"> </span>The<span class="_ _a"> </span>following<span class="_ _d"> </span>co<span class="_ _4"></span>de<span class="_ _a"> </span>sho<span class="_ _1"></span>ws<span class="_ _a"> </span>a<span class="_ _a"> </span>rou-</div><div class="t m0 x13 h7 y1225 ff3 fs4 fc0 sc0 ls0 ws0">tine<span class="_ _d"> </span>that<span class="_ _d"> </span>exp<span class="_ _4"></span>ects<span class="_ _2"> </span>its<span class="_ _d"> </span>parameter<span class="_ _d"> </span>to<span class="_ _d"> </span>b<span class="_ _4"></span>e<span class="_ _d"> </span>passed<span class="_ _d"> </span>by<span class="_ _2"> </span>reference.<span class="_ _e"> </span>This<span class="_ _d"> </span>routine<span class="_ _d"> </span>up<span class="_ _4"></span>dates<span class="_ _d"> </span>the</div><div class="t m0 x13 h7 y1226 ff3 fs4 fc0 sc0 ls0 ws0">v<span class="_ _8"></span>ariable<span class="_ _2"> </span>v<span class="_ _8"></span>alue<span class="_ _2"> </span>b<span class="_ _1"></span>y<span class="_ _2"> </span>increasing<span class="_ _2"> </span>its<span class="_ _2"> </span>con<span class="_ _1"></span>ten<span class="_ _1"></span>ts<span class="_ _2"> </span>b<span class="_ _1"></span>y<span class="_ _2"> </span>one.</div><div class="t m0 xd5 h8 y1227 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">void<span class="_ _e"> </span>inc(int*<span class="_ _11"> </span>v)</span></div><div class="t m0 xd5 h8 y1228 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _1f"> </span><span class="ff5 fs4">{</span></div><div class="t m0 xd5 h8 y1229 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _7e"> </span><span class="ff5 fs4">*v<span class="_ _e"> </span>=<span class="_ _11"> </span>*v<span class="_ _e"> </span>+<span class="_ _e"> </span>1;</span></div><div class="t m0 xd5 h8 y122a ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _1f"> </span><span class="ff5 fs4">}</span></div><div class="t m0 x14 h7 y122b ff3 fs4 fc0 sc0 ls0 ws0">Again,<span class="_ _d"> </span>accordingly<span class="_ _2"> </span>to<span class="_ _d"> </span>the<span class="_ _d"> </span>RISC-V<span class="_ _d"> </span><span class="ff5">ilp32<span class="_ _d"> </span></span>ABI,<span class="_ _2"> </span>this<span class="_ _d"> </span>parameter<span class="_ _d"> </span>must<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _2"> </span>passed<span class="_ _d"> </span>in</div><div class="t m0 x13 h7 y122c ff3 fs4 fc0 sc0 ls0 ws0">register<span class="_ _2"> </span><span class="ff5">a0</span>.<span class="_ _3"> </span>Since<span class="_ _2"> </span>it<span class="_ _2"> </span>is<span class="_ _2"> </span>passed<span class="_ _2"> </span>as<span class="_ _2"> </span>reference,<span class="_ _2"> </span>register<span class="_ _2"> </span><span class="ff5">a0<span class="_ _2"> </span></span>will<span class="_ _2"> </span>con<span class="_ _1"></span>tain<span class="_ _2"> </span>the<span class="_ _5"> </span>address<span class="_ _2"> </span>of<span class="_ _2"> </span>the</div><div class="t m0 x13 h7 y122d ff3 fs4 fc0 sc0 ls0 ws0">v<span class="_ _8"></span>ariable.<span class="_ _e"> </span>The<span class="_ _a"> </span>follo<span class="_ _8"></span>w<span class="_ _4"></span>ing<span class="_ _2"> </span>co<span class="_ _4"></span>de<span class="_ _d"> </span>sho<span class="_ _1"></span>ws<span class="_ _d"> </span>the<span class="_ _d"> </span>implementation<span class="_ _2"> </span>of<span class="_ _a"> </span>the<span class="_ _d"> </span>previous<span class="_ _d"> </span>“C”<span class="_ _d"> </span>co<span class="_ _4"></span>de<span class="_ _d"> </span>in</div><div class="t m0 x13 h7 y122e ff3 fs4 fc0 sc0 ls0 ws0">assem<span class="_ _1"></span>bly<span class="_ _3"> </span>language.<span class="_ _b"> </span>Notice<span class="_ _3"> </span>that<span class="_ _3"> </span>the<span class="_ _a"> </span>co<span class="_ _4"></span>de<span class="_ _3"> </span>uses<span class="_ _3"> </span>the<span class="_ _3"> </span>address<span class="_ _a"> </span>passed<span class="_ _3"> </span>in<span class="_ _3"> </span>register<span class="_ _3"> </span><span class="ff5">a0<span class="_ _3"> </span></span>to</div><div class="t m0 x13 h7 y122f ff3 fs4 fc0 sc0 ls0 ws0">up<span class="_ _4"></span>date<span class="_ _5"> </span>the<span class="_ _2"> </span>conten<span class="_ _8"></span>ts<span class="_ _2"> </span>of<span class="_ _2"> </span>the<span class="_ _2"> </span>v<span class="_ _8"></span>ariable.</div><div class="t m0 xd5 h8 y1230 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">inc:</span></div><div class="t m0 xd5 h8 y1231 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _36"> </span><span class="ff5 fs4">lw<span class="_ _3f"> </span>a1,<span class="_ _11"> </span>(a0)<span class="_ _85"> </span>#<span class="_ _e"> </span>a1<span class="_ _e"> </span>=<span class="_ _e"> </span>*v</span></div><div class="t m0 xd5 h8 y1232 ff24 fs12 fc0 sc0 ls0 ws0">3<span class="_ _36"> </span><span class="ff5 fs4">addi<span class="_ _11"> </span>a1,<span class="_ _e"> </span>a1,<span class="_ _e"> </span>1<span class="_ _e"> </span>#<span class="_ _11"> </span>a1<span class="_ _e"> </span>=<span class="_ _e"> </span>a1<span class="_ _e"> </span>+<span class="_ _11"> </span>1</span></div><div class="t m0 xd5 h8 y1233 ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _36"> </span><span class="ff5 fs4">sw<span class="_ _3f"> </span>a1,<span class="_ _11"> </span>(a0)<span class="_ _85"> </span>#<span class="_ _e"> </span>*v<span class="_ _e"> </span>=<span class="_ _e"> </span>a1</span></div><div class="t m0 xd5 h8 y1234 ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _36"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x14 h7 y1235 ff3 fs4 fc0 sc0 ls0 ws0">The follo<span class="_ _8"></span>wing co<span class="_ _4"></span>de<span class="_ _13"> </span>sho<span class="_ _1"></span>ws ho<span class="_ _8"></span>w the <span class="ff5">inc<span class="_ _13"> </span></span>routine can be in<span class="_ _1"></span>v<span class="_ _1"></span>ok<span class="_ _1"></span>ed to<span class="_ _13"> </span>increase the v<span class="_ _7"></span>alue</div><div class="t m0 x13 h7 y1236 ff3 fs4 fc0 sc0 ls0 ws0">of v<span class="_ _8"></span>ariable<span class="_ _5"> </span><span class="ff5">y</span>.<span class="_ _c"> </span>Notice<span class="_ _5"> </span>that the<span class="_ _5"> </span>address<span class="_ _5"> </span>of<span class="_ _5"> </span>v<span class="_ _8"></span>ariable<span class="_ _5"> </span><span class="ff5">y</span>,<span class="_ _5"> </span>instead<span class="_ _5"> </span>of<span class="_ _5"> </span>its<span class="_ _5"> </span>v<span class="_ _8"></span>alue,<span class="_ _5"> </span>is<span class="_ _5"> </span>loaded<span class="_ _5"> </span>into</div><div class="t m0 x13 h7 y1237 ff3 fs4 fc0 sc0 ls0 ws0">register<span class="_ _2"> </span><span class="ff5">a0</span>.</div><div class="t m0 xd5 h8 y1238 ff24 fs12 fc0 sc0 ls0 ws0">1<span class="_ _1f"> </span><span class="ff5 fs4">.data</span></div><div class="t m0 xd5 h8 y1239 ff24 fs12 fc0 sc0 ls0 ws0">2<span class="_ _1f"> </span><span class="ff5 fs4">y:<span class="_ _e"> </span>.skip<span class="_ _11"> </span>4</span></div><div class="t m0 xd5 h38 y123a ff24 fs12 fc0 sc0 ls0 ws0">3</div><div class="t m0 xd5 h8 y123b ff24 fs12 fc0 sc0 ls0 ws0">4<span class="_ _1f"> </span><span class="ff5 fs4">.text</span></div><div class="t m0 xd5 h8 y123c ff24 fs12 fc0 sc0 ls0 ws0">5<span class="_ _1f"> </span><span class="ff5 fs4">main:</span></div><div class="t m0 xd5 h8 y123d ff24 fs12 fc0 sc0 ls0 ws0">6<span class="_ _36"> </span><span class="ff5 fs4">la<span class="_ _3f"> </span>a0,<span class="_ _11"> </span>y<span class="_ _85"> </span>#<span class="_ _e"> </span>set<span class="_ _e"> </span>the<span class="_ _e"> </span>parameter<span class="_ _11"> </span>with<span class="_ _e"> </span>the<span class="_ _e"> </span>address<span class="_ _e"> </span>of<span class="_ _11"> </span>y</span></div><div class="t m0 xd5 h8 y123e ff24 fs12 fc0 sc0 ls0 ws0">7<span class="_ _36"> </span><span class="ff5 fs4">jal<span class="_ _85"> </span>inc<span class="_ _86"> </span>#<span class="_ _11"> </span>invoke<span class="_ _e"> </span>inc</span></div><div class="t m0 xd5 h8 y123f ff24 fs12 fc0 sc0 ls0 ws0">8<span class="_ _36"> </span><span class="ff5 fs4">ret</span></div><div class="t m0 x14 h7 yeb ff3 fs4 fc0 sc0 ls0 ws0">Reference<span class="_ _13"> </span>parameters<span class="_ _12"> </span>can be used<span class="_ _12"> </span>to pass<span class="_ _12"> </span>information in<span class="_ _12"> </span>and<span class="_ _13"> </span>out<span class="_ _13"> </span>of<span class="_ _12"> </span>routines.<span class="_ _3"> </span>Since</div><div class="t m0 x13 h7 yec ff3 fs4 fc0 sc0 ls0 ws0">a<span class="_ _5"> </span>reference<span class="_ _2"> </span>is<span class="_ _2"> </span>essentially<span class="_ _5"> </span>a<span class="_ _2"> </span>memory<span class="_ _5"> </span>address,<span class="_ _2"> </span>the<span class="_ _2"> </span>information<span class="_ _2"> </span>being<span class="_ _2"> </span>passed<span class="_ _2"> </span>into<span class="_ _5"> </span>or<span class="_ _2"> </span>out</div><div class="t m0 x13 h7 y61 ff3 fs4 fc0 sc0 ls0 ws0">of<span class="_ _2"> </span>the<span class="_ _2"> </span>routine<span class="_ _2"> </span>m<span class="_ _1"></span>ust<span class="_ _2"> </span>b<span class="_ _4"></span>e<span class="_ _5"> </span>lo<span class="_ _4"></span>cated<span class="_ _5"> </span>in<span class="_ _2"> </span>the<span class="_ _2"> </span>memory<span class="_ _7"></span>.</div><div class="t m0 x43 h7 yc ff5 fs4 fc0 sc0 ls0 ws0">http://riscv-<span class="_ _4"></span>programming.org<span class="_ _2"> </span><span class="ff3">(V<span class="_ _7"></span>ersion:<span class="_ _c"> </span>August<span class="_ _5"> </span>26,<span class="_ _d"> </span>2021)<span class="_ _6f"> </span>94</span></div><a class="l" href="#pfe" data-dest-detail='[14,"XYZ",136.063,636.39,null]'><div class="d m1" style="border-style:none;position:absolute;left:332.713000px;bottom:432.140000px;width:20.119000px;height:11.125000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://riscv-programming.org"><div class="d m1" style="border-style:none;position:absolute;left:185.308000px;bottom:36.395000px;width:148.940000px;height:13.948000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
